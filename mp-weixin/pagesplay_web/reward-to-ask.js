(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesplay_web/reward-to-ask"],{"1f78":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=h(i("a34a")),s=i("2f62"),o=i("0f20"),r=h(i("7a36")),n=h(i("dc1b")),c=h(i("c939")),d=h(i("b664")),u=h(i("d654"));function h(t){return t&&t.__esModule?t:{default:t}}function p(t,e,i,a,s,o,r){try{var n=t[o](r),c=n.value}catch(d){return void i(d)}n.done?e(c):Promise.resolve(c).then(a,s)}function l(t){return function(){var e=this,i=arguments;return new Promise((function(a,s){var o=t.apply(e,i);function r(t){p(o,a,s,r,n,"next",t)}function n(t){p(o,a,s,r,n,"throw",t)}r(void 0)}))}}function f(t){return v(t)||y(t)||g(t)||m()}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(t,e){if(t){if("string"===typeof t)return _(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_(t,e):void 0}}function y(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function v(t){if(Array.isArray(t))return _(t)}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function b(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function w(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?b(Object(i),!0).forEach((function(e){I(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):b(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function I(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var S=function(){i.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(i("ba2b"))}.bind(null,i)).catch(i.oe)},k=function(){i.e("components/h5-play/now-time-picker/now-time-picker").then(function(){return resolve(i("5e65"))}.bind(null,i)).catch(i.oe)},P=null,x=null,T={name:"Post",components:{onwTimePicker:k,uniPopupDialog:S},mixins:[r.default,n.default,c.default,(0,d.default)("other.can_create_thread_question")],data:function(){return{choiceMoney:!1,geographical_location:!1,anonymity_show:!1,timeValue:"",save:!1,currentId:"",timer1:null,timer2:null,SecondaryClassification:"",isCateAxtive:-1,expired_at:"",expired_time:!1,titlexune:"已添加0个标题",secondallcategories:[],two_categoryId:"",vditor:null,navTitle:"发布",loadStatus:"",textAreaValue:"",markdownShow:!1,barStatus:!1,textAreaLength:5e3,textAnswerLength:5e3,postTitle:"",checkClassData:[],type:0,price:0,priceAsk:0,pwdVal:"",browser:0,inputPrice:"",maxLength:7,inputWord:"",operating:"",emojiShow:!1,textShow:!0,header:{},formData:{},captcha:null,captcha_ticket:"",captcha_rand_str:"",userImage:"",beUserName:"",checked:!1,watchChecked:!1,watchShow:!1,payShowStatus:!0,haveDate:0,answerIsDate:0,platformDate:0,askingPrice:!0,payNum:[{name:"￥1",pay:1},{name:"￥2",pay:2},{name:"￥5",pay:5},{name:"￥10",pay:10},{name:"￥20",pay:20},{name:"￥50",pay:50},{name:"￥88",pay:88},{name:"￥128",pay:128},{name:this.i18n.t("discuzq.post.customize"),pay:0}],payNumCheck:[{name:"",pay:0}],freepercentage:[{name:"0%",pay:0},{name:"10%",pay:.1},{name:"30%",pay:.3},{name:"50%",pay:.5},{name:"70%",pay:.7},{name:"100%",pay:1}],freewords:[],percentagedisplay:"0%",uploadFile:[],cursor:0,wordCountCheck:[{name:this.i18n.t("discuzq.post.word",{num:0}),num:0}],word:0,setType:"pay",controlsStatus:!1,videoBeforeList:[],audioBeforeList:[],fullscreenStatus:!1,videoName:"",percent:0,fileId:"",url:"",postLoading:!1,allCategories:[],categoryIndex:"",categoryId:"",threadId:"",firstPostId:"",postDetails:{},filePreview:[],uploadStatus:!0,showHidden:!0,ticket:"",randstr:"",captchaResult:{},attachmentList:[],signatureVal:"",deleteType:"",deleteId:"",deleteIndex:"",deleteTip:"确定删除吗？",wechatTip:this.i18n.t("discuzq.wechatBind"),currentPosition:{},watchMoeny:"1",beAskId:"",payTypeText:"",orderSn:"",coverLoading:!1,payStatus:!1,payTypeData:[{name:"微信支付",icon:"icon-wxPay",color:"#09bb07",value:"0"},{name:"钱包支付",icon:"icon-walletPay",color:"#1878f3",value:"1"}],chooseType:1,payType:0,showPayType:"",ioshide:!1,isShowGoods:!0,dataGoodInfo:{},dataGoodInfoPrice:0,goodsId:"",categoryid:0,categoryindex:0,postShow:!1,popupStatus:!1,canUploadAttachment:!1}},computed:w(w({},(0,s.mapState)({getAtMemberData:function(t){return t.atMember.atMemberData}})),{},{showPrice:function(){var t="";return this.priceAsk>0&&(t="￥".concat(this.priceAsk+this.i18n.t("discuzq.post.yuan"))),t},showAskPrice:function(){var t=this.i18n.t("discuzq.post.free");return t=this.priceAsk<=0?this.i18n.t("discuzq.post.free"):"￥".concat(this.priceAsk+this.i18n.t("discuzq.post.yuan")),t},currentLoginId:function(){var t=this.$store.getters["session/get"]("userId");return parseInt(t,10)}}),updated:function(){var e=this;this.geographical_location_show(),this.forums&&5===this.type&&(this.platformDate=(this.forums.set_site.site_onlooker_price*(this.forums.set_site.site_master_scale/10)).toFixed(2),this.haveDate=((this.forums.set_site.site_onlooker_price-this.platformDate)/2).toFixed(2),this.answerIsDate=(this.forums.set_site.site_onlooker_price-this.platformDate-this.haveDate).toFixed(2)),t.$on("uploadVideoOver",(function(t){e.percent=1,t.doneResult&&(e.fileId=t.doneResult.fileId),t.result&&(e.fileId=t.result.fileId)}))},mounted:function(){this.onStartSave()},beforeDestroy:function(){this.save=!0,clearInterval(this.timer1),this.timer1=null,clearInterval(this.timer2),this.timer2=null},methods:w({geographical_location_show:function(){5===this.type&&this.forums.other.can_create_thread_question_position&&(this.geographical_location=!0),5===this.type&&this.forums.other.can_create_thread_question_anonymous&&(this.anonymity_show=!0)},isTimeReasonable:function(t){var e=t.split(" "),i=e[0].split("-"),a=e[1].split(":"),s=[].concat(f(i),f(a)),o=parseInt(s[0],10),r=parseInt(s[1],10)-1,n=parseInt(s[2],10),c=parseInt(s[3],10),d=parseInt(s[4],10),u=parseInt(s[5],10),h=new Date(o,r,n,c,d,u),p=h.getTime()-Date.now(),l=82800;l>=p/1e3?this.expired_time=!1:(this.expired_time=!0,r=parseInt(r,10)+1,r=r<10?"0".concat(r):r,n=n<10?"0".concat(n):n,c=c<10?"0".concat(c):c,d=d<10?"0".concat(d):d,this.timeValue="设置时间: ".concat(o,"-").concat(r,"-").concat(n," ").concat(c,":").concat(d))},echoMoneyAndTime:function(t){var e=this;this.$store.dispatch("jv/get",["threads/".concat(t),{}]).then((function(t){console.log(t),e.priceAsk=parseInt(t.questionTypeAndMoney.money,10),e.checked=t.isAnonymous,e.isTimeReasonable(t.questionTypeAndMoney.expired_at),e.expired_at=t.questionTypeAndMoney.expired_at}))},toDraftsing:function(){var t=this;if(this.textAreaValue.length<1&&this.price<1&&!this.expired_at)return this.$refs.toast.show({message:"草稿箱内容不能为空"}),!1;if(!this.categoryId)return this.$refs.toast.show({message:"分类不能为空"}),!1;this.save=!0,clearInterval(this.timer1),this.timer1=null,clearInterval(this.timer2),this.timer2=null;var e={_jv:{type:"threads",relationships:{category:{data:{type:"categories",id:this.two_categoryId||this.categoryId}},question:{data:{type:0,expired_at:this.expired_at,be_user_id:0,order_id:this.orderSn,price:this.priceAsk,is_onlooker:this.checked}}},links:{self:"threads?include=user,category,firstPost,firstPost.images,firstPost.postGoods,question,question.beUser,question.beUser.groups,question.images"}},content:this.textAreaValue,type:this.type,price:this.price,free_words:this.word,captcha_ticket:this.ticket,captcha_rand_str:this.randstr,is_anonymous:this.checked,is_red_packet:this.is_red_packet,is_draft:1,is_old_draft:0,id:this.currentId,redPacket:{rule:+this.rule,money:+this.money,number:+this.number,condition:+this.condition,likenum:+this.likenum}};1===this.payType?(e.attachment_price=this.price,e.price=""):0===this.payType&&(e.attachment_price="",e.price=this.price);var i=this.currentPosition;e.longitude=i.longitude||"",e.latitude=i.latitude||"",e.location=i.location||"",e.address=i.address||"";var a=new Promise((function(i,a){switch(t.type){case 0:i();break;case 1:e.title=t.postTitle,e._jv.relationships.attachments={data:t.addImg().data.concat(t.addFile().data)},i();break;case 2:e.file_id=t.fileId,e.file_name=t.videoName,i();break;case 3:e._jv.relationships.attachments=t.addImg(),i();break;case 4:e.file_id=t.audioBeforeList[0].id,e.file_name=t.audioBeforeList[0].fileName,i();break;case 5:e._jv.relationships.attachments=t.addImg(),i();break;case 6:e.post_goods_id=t.dataGoodInfo._jv.id,i();break;default:a(),t.$refs.toast.show({message:t.i18n.t("core.postTypesDoNotMatch")})}}));a.then((function(){t.$store.dispatch("jv/post",e).then((function(e){t.currentId||(t.currentId=e._jv.id),t.$refs.toast.show({message:t.i18n.t("保存成功")})})).catch((function(t){console.log(t)}))}))},toDrafts:function(){var t=this;this.save=!0;var e={_jv:{type:"threads",relationships:{category:{data:{type:"categories",id:this.two_categoryId||this.categoryId}},question:{data:{type:0,expired_at:this.expired_at,be_user_id:0,order_id:this.orderSn,price:this.priceAsk,is_onlooker:this.checked}}},links:{self:"threads?include=user,category,firstPost,firstPost.images,firstPost.postGoods,question,question.beUser,question.beUser.groups,question.images"}},free_words:this.word,captcha_ticket:this.ticket,captcha_rand_str:this.randstr,is_draft:1,is_old_draft:0,id:this.currentId,price:0,attachment_price:"",title:"",type:5,content:this.textAreaValue,is_anonymous:this.checked,longitude:"",latitude:"",location:"",redPacket:{rule:+this.rule,money:+this.money,number:+this.number,condition:+this.condition,likenum:+this.likenum}};1===this.payType?(e.attachment_price=this.price,e.price=""):0===this.payType&&(e.attachment_price="",e.price=this.price);var i=this.currentPosition;e.longitude=i.longitude||"",e.latitude=i.latitude||"",e.location=i.location||"",e.address=i.address||"";var a=new Promise((function(i,a){switch(t.type){case 0:i();break;case 1:e.title=t.postTitle,e._jv.relationships.attachments={data:t.addImg().data.concat(t.addFile().data)},i();break;case 2:e.file_id=t.fileId,e.file_name=t.videoName,i();break;case 3:e._jv.relationships.attachments=t.addImg(),i();break;case 4:e.file_id=t.audioBeforeList[0].id,e.file_name=t.audioBeforeList[0].fileName,i();break;case 5:e._jv.relationships.attachments=t.addImg(),i();break;case 6:e.post_goods_id=t.dataGoodInfo._jv.id,i();break;default:a(),t.$refs.toast.show({message:t.i18n.t("core.postTypesDoNotMatch")})}}));a.then((function(){t.$store.dispatch("jv/post",[e,{custom:{loading:!1}}]).then((function(e){t.save=!1,t.currentId||(t.currentId=e._jv.id)})).catch((function(t){console.log(t)}))}))},onStartSave:function(){var t=this;this.timer1=setInterval((function(){t.categoryId&&0!==t.textAreaValue.length&&(t.startSave(),clearInterval(t.timer1),t.timer1=null)}),12e4)},startSave:function(){var t=this;this.timer2=setInterval((function(){t.save||t.toDrafts()}),12e4)},setTimes:function(t){this.timeValue=t},getTimes:function(e,i){var a=82800;if(a>=e)t.showToast({title:"设置时间不能小于24小时",icon:"none"});else{t.showToast({title:"设置时间成功",icon:"none"}),this.expired_time=!0;var s="".concat(i,":00");this.expired_at=s}},selectEndTime:function(){this.$refs.setEndTime.open()},focusEvent:function(){},addGoods:function(){"edit"===this.operating?t.redirectTo({url:"/pages/topic/parse-goods?type=".concat(this.type,"&operating=edit&threadId=").concat(this.threadId)}):t.redirectTo({url:"/pages/topic/parse-goods?type=".concat(this.type)})},deleteGoods:function(){this.dataGoodInfo=[],this.isShowGoods=!1},changeCheck:function(){},saveThread:function(){var e=this;t.removeStorageSync("current_thread"),1===this.type&&(this.textAreaValue=this.vditor.getValue());var i={},a=["postTitle","price","word","fileId","videoName","textAreaValue","categoryIndex","categoryId","checkClassData","uploadFile","videoBeforeList","audioBeforeList","checked","watchChecked","askingPrice","watchShow","priceAsk","beAskId","userImage","beUserName","type","showHidden","payType","showPayType","ioshide","dataGoodInfo"];if(a.forEach((function(t){e[t]&&(i[t]=e[t])})),this.$refs.uploadFiles){var s=this.$refs.uploadFiles.getValue(),o=[];s.forEach((function(t){o.push({fileName:t.attributes.fileName,url:t.attributes.url,_jv:{id:t.id}})})),i.attachmentList=o}if(this.$refs.upload){var r=this.$refs.upload.getValue();r.forEach((function(t,e){t.attributes&&(r[e]={path:t.attributes.thumbUrl,id:t.id,order:t.attributes.order,name:t.attributes.fileName,url:t.attributes.url})})),i.imgList=r}t.setStorageSync("current_thread",JSON.stringify(i))},choosePosition:function(){var e=this;e.currentPosition.location||t.getSetting({success:function(i){i.authSetting["scope.userLocation"]?t.chooseLocation({success:function(t){var i=t;i.location=t.name,e.currentPosition=i}}):t.authorize({scope:"scope.userLocation",success:function(){t.chooseLocation({success:function(t){var i=t;i.location=t.name,e.currentPosition=i}})}})}})},clearPosition:function(){this.currentPosition={}},checkNum:function(e){var i=this,a=e.target.value,s=a.indexOf(".");a.indexOf(".")<0&&""!==a?a.length>6?(a=a.substring(0,a.length-1),t.showToast({title:i.c.TheAmountCannotExceedOneMillion,icon:"none"})):a=parseFloat(a):0===a.indexOf(".")?(a=a.replace(/[^$#$]/g,"0."),a=a.replace(/\.{2,}/g,".")):/^(\d?)+(\.\d{0,2})?$/.test(a)||(a=a.substring(0,a.length-1)),i.$nextTick((function(){i.maxLength=-1===s?7:10,i.inputPrice=a}))},fullscreenchange:function(t){this.fullscreenStatus=t.detail.fullScreen,t.detail.fullScreen||(this.controlsStatus=!1,this.videoContext.pause())},emojiclick:function(){this.emojiShow=!this.emojiShow,this.textShow=!this.textShow},contBlur:function(t){this.cursor=t.detail.cursor},diaLogClose:function(){this.$refs.popup.close(),this.popupStatus=!1,this.textShow=!0},diaLogOk:function(){var e="".concat(this.inputPrice);if(/^\d+(\.\d{1,2})?$/.test(e)){if(""===this.forums.set_site.site_minimum_amount){if(this.inputPrice<.1)return void t.showToast({title:"悬赏金额不能少于0.1元",icon:"none"})}else if(this.inputPrice<this.forums.set_site.site_minimum_amount)return void t.showToast({title:this.i18n.t("core.TheAmountCannotBeLessThanMinMoney")+this.forums.set_site.site_minimum_amount+this.i18n.t("discuzq.post.yuan"),icon:"none"});if(this.inputPrice>=1e4)t.showToast({title:"悬赏金额应低于10000元",icon:"none"});else{if(5===this.type)return this.priceAsk=this.inputPrice,this.$refs.popup.close(),this.popupStatus=!1,this.textShow=!0,void this.postClick();"pay"===this.setType?this.price=this.inputPrice:this.word=this.inputWord,this.$refs.popup.close(),this.popupStatus=!1,this.textShow=!0}}else t.showToast({title:"只能精确到小数点后两位",icon:"none"})},percentageClick:function(t){this.word=this.freepercentage[t].pay,this.percentagedisplay=this.freepercentage[t].name,this.setType="word",this.freewords=[],this.freewords.push(this.freepercentage[t]),this.$refs.popupBtm.close()},moneyClick:function(t){var e=this;this.choiceMoney=!0,this.setType="pay",this.payNumCheck=[],this.payNumCheck.push(this.payNum[t]),this.payNumCheck[0].name===this.i18n.t("discuzq.post.customize")?(this.textShow=!1,this.$refs.popupBtm.close(),this.popupStatus=!0,this.$nextTick((function(){e.inputPrice="",e.$refs.popup.open(),e.textShow=!1}))):(this.price=this.payNumCheck[0].pay,this.priceAsk=this.payNumCheck[0].pay,this.$refs.popupBtm.close(),this.postClick(),this.textShow=!0)},lookPay:function(){this.$refs.lookPayPopup.open()},cancelLookPay:function(){this.$refs.lookPayPopup.close()},choicePayType:function(t){this.payType=t,this.$refs.lookPayPopup.close()},cellClick:function(t){this.setType=t,this.$refs.popupBtm.open(),this.textShow=!1},postAnswerClick:function(){this.$refs.popupBtm.open(),this.textShow=!1},cancel:function(){this.$refs.popupBtm.close(),this.textShow=!0},uploadClick:function(t){this.uploadStatus=t},uploadChange:function(t,e){this.uploadFile=t,this.uploadStatus=e},uploadClear:function(t,e){var i=t.id;this.deleteType=0,this.deleteId=i,this.deleteIndex=e,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteImgSure")},audioDel:function(){this.deleteType=3,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteAudioSure")},getEmojiClick:function(t){var e="";e="".concat(this.textAreaValue.slice(0,this.cursor)+t+this.textAreaValue.slice(this.cursor)),this.cursor=e.length,this.textAreaValue=e,this.emojiShow=!1,this.textShow=!0},callClick:function(){t.navigateTo({url:"/pages/user/at-member"})},topicPage:function(){t.navigateTo({url:"/pages/topic/topic"})},checkClass:function(t,e,i){this.two_categoryId="",this.checkClassData=[],+this.categoryId!==+i?(this.categoryId=i,this.checkClassData.push(t),this.secondallcategories=t.children||[]):this.categoryId=""},checkClassCh:function(t,e){this.isCateAxtive=e,this.SecondaryClassification=t.search_ids},checkClassing:function(t,e,i){+this.two_categoryId!==+i?this.two_categoryId=i:this.two_categoryId=""},payClickShow:function(){var t=this;if(this.$store.getters["session/get"]("isLogin")||this.mpLoginMode(),this.payStatus=!1,this.forums.paycenter.wxpay_close){if(!this.forums.paycenter.wxpay_close||!this.forums.other.can_create_thread_paid)return this.ioshide=!1,void(this.payShowStatus=!1);if("ios"===this.system)return this.postShow=!0,this.payShowStatus=!1,void(this.ioshide=!1);this.ioshide=!0,this.payShowStatus=!0,this.payTypeText=this.t.pay+this.t.payAskingPrice,this.priceAsk=parseFloat(this.thread.price),this.$nextTick((function(){t.$refs.payShow.payClickShow(t.payTypeVal)}))}else this.payShowStatus=!1},setThread:function(){var e=this,i=t.getStorageSync("current_thread");i&&(i=JSON.parse(i),this.dataGoodInfo=i.dataGoodInfo,Object.getOwnPropertyNames(i).forEach((function(t){if("imgList"===t){var a=i[t];a.forEach((function(t,e){a[e]={thumbUrl:t.path,_jv:{id:t.id},order:t.order,fileName:t.name,url:t.url}}));var s={firstPost:{images:[]}};s.firstPost.images=i[t],e.setAnnex("img",s)}else e[t]=i[t]})),this.videoBeforeList.length>0&&(this.percent=1),t.removeStorageSync("current_thread"))},paysureShow:function(e){if(t.setStorage({key:"page",data:"/topic/post?type=5&categoryId=".concat(this.categoryid,"&categoryIndex=").concat(this.categoryindex)}),0===e){if(void 0===this.user.wechat||this.user.wechat&&""===this.user.wechat.min_openid)return void this.$refs.wechatPopup.open();this.creatOrder(this.priceAsk,5,"",e)}},onInput:function(t){this.value=t,this.creatOrder(this.priceAsk,5,t,1)},creatOrder:function(t,e,i,a){var s=this,o=this.$store.getters["session/get"]("userId"),r={_jv:{type:"orders"},type:e,payee_id:o,amount:t,is_anonymous:this.checked?"0":"1"};this.$store.dispatch("jv/post",r).then((function(t){s.orderSn=t.order_sn,0===a?0===s.browser?s.orderPay(13,i,s.orderSn,a,"0"):s.isWeixin&&s.isPhone?s.orderPay(12,i,s.orderSn,a,"1"):s.isPhone?s.orderPay(20,i,s.orderSn,1,"2"):s.orderPay(10,i,s.orderSn,a,"3"):1===a&&s.orderPay(20,i,s.orderSn,a)})).catch((function(t){console.log(t)}))},orderPay:function(e,i,a,s,o){var r=this,n={};0===s?n={_jv:{type:"trade/pay/order/".concat(a)},payment_type:e}:1===s&&(n={_jv:{type:"trade/pay/order/".concat(a)},payment_type:e,pay_password:i}),this.$store.dispatch("jv/post",n).then((function(e){r.wxRes=e,0===s?"0"===o?r.wechatPay(e.wechat_js.timeStamp,e.wechat_js.nonceStr,e.wechat_js.package,e.wechat_js.signType,e.wechat_js.paySign):"1"===o?"undefined"===typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",r.onBridgeReady(e),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",r.onBridgeReady(e)),document.attachEvent("onWeixinJSBridgeReady",r.onBridgeReady(e))):r.onBridgeReady(e):"2"===o?r.postThread().then((function(e){r.postLoading=!1,t.hideLoading(),e&&e.isApproved,e&&e.Data&&e.Data.id&&t.redirectTo({url:"/topic/index?id=".concat(e.Data.id)})})):"3"===o&&e&&(r.codeUrl=e.wechat_qrcode,r.payShowStatus=!1,r.$refs.codePopup.open(),r.qrcodeShow=!0,P=setInterval((function(){1!==r.payStatus?(r.getOrderStatus(r.orderSn,o),t.hideLoading()):clearInterval(P)}),3e3)):1===s&&("success"===e.wallet_pay.result&&(r.$store.dispatch("jv/get",["users/".concat(r.currentLoginId),{}]),r.coverLoading=!1,r.postThread().then((function(e){r.postLoading=!1,t.hideLoading(),e&&e.Data&&e.Data.id&&t.redirectTo({url:"/topic/index?id=".concat(e.Data.id)})}))),r.coverLoading=!1)})).catch((function(t){console.log(t),r.$refs.payShow.clearPassword()}))},getOrderStatus:function(e,i){var a=this;this.$store.dispatch("jv/get",["orders/".concat(e),{custom:{loading:!1}}]).then((function(e){a.payStatus=e.status,1===a.payStatus&&("2"===i||("3"===i?(a.$refs.codePopup.close(),a.qrcodeShow=!1,a.postThread()):"0"===i?a.postThread().then((function(e){a.postLoading=!1,t.hideLoading(),e&&1===e.isApproved&&a.$u.event.$emit("refreshHome",e),e&&e.Data&&e.Data.id&&t.redirectTo({url:"/topic/index?id=".concat(e.Data.id)})})):"1"===i&&a.postThread().then((function(e){a.postLoading=!1,t.hideLoading(),e&&1===e.isApproved&&a.$u.event.$emit("refreshHome",e),e&&e.Data&&e.Data.id&&t.redirectTo({url:"/topic/index?id=".concat(e.Data.id)})}))),a.$refs.toast.show({message:a.i18n.t("pay.paySuccess")}))})).catch((function(t){console.log(t),a.coverLoading=!1,a.$refs.toast.show({message:a.i18n.t("pay.payFail")})}))},wechatPay:function(e,i,a,s,o){var r=this;t.requestPayment({provider:"wxpay",timeStamp:e,nonceStr:i,package:a,signType:s,paySign:o,success:function(){r.coverLoading=!0,P=setInterval((function(){1!==r.payStatus?r.getOrderStatus(r.orderSn,"0"):clearInterval(P)}),3e3)},fail:function(){r.payShowStatus=!1,r.coverLoading=!1,r.$refs.toast.show({message:r.p.payFail})}})},onBridgeReady:function(t){var e=this;window.WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.wechat_js.appId,timeStamp:t.wechat_js.timeStamp,nonceStr:t.wechat_js.nonceStr,package:t.wechat_js.package,signType:"MD5",paySign:t.wechat_js.paySign},(function(t){"get_brand_wcpay_request:ok"===t.err_msg||("get_brand_wcpay_request:cancel"===t.err_msg||"get_brand_wcpay_request:fail"===t.err_msg)&&clearInterval(P)})),P=setInterval((function(){1!==e.payStatus?e.getOrderStatus(e.orderSn,"1"):clearInterval(P)}),3e3)},postClick:function(){var t=this;return this.priceAsk<.1?(this.$refs.toast.show({message:"悬赏金额不能为空"}),!1):this.choiceMoney?(this.choiceMoney=!1,!1):this.categoryId?this.textAreaValue.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theContentCanNotBeBlank")}),!1):this.expired_at?this.expired_time?(this.forums.qcloud.qcloud_captcha&&this.forums.other.create_thread_with_captcha&&(this.ticket&&this.randstr||(this.toTCaptcha(),this.payShowStatus=!0)),this.$nextTick((function(){t.$refs.payShow.payClickShow()})),!!this.orderSn&&(clearInterval(this.timer1),this.timer1=null,clearInterval(this.timer2),this.timer2=null,void this.postThread())):(this.$refs.toast.show({message:"设置时间不能小于24小时"}),!1):(this.$refs.toast.show({message:"悬赏结束时间不能为空"}),!1):(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theclassifyCanNotBeBlank")}),!1)},setAnnex:function(t,e){var i=[];switch(t){case"img":e.firstPost.images.map((function(t){return i.push({path:t.thumbUrl,id:t._jv.id,order:t.order,name:t.fileName,url:t.url}),t})),this.filePreview=i;break;case"video":this.videoBeforeList.push({path:e.threadVideo.media_url});break;case"audio":this.audioBeforeList.push({fileName:e.threadAudio.file_name,url:e.threadAudio.media_url,id:e.threadAudio.file_id});break;case"goods":this.dataGoodInfo=e.firstPost.postGoods,-1!==e.firstPost.postGoods.price.indexOf("-")||Number(e.firstPost.postGoods.price)>0?this.dataGoodInfoPrice=e.firstPost.postGoods.price:Number(e.firstPost.postGoods.price)<=0&&(this.dataGoodInfoPrice="");break;default:break}},addImg:function(){var t={data:[]};return this.uploadFile.forEach((function(e){e&&t.data.push({type:"attachments",id:e.id})})),t},addFile:function(){var t={data:[]},e=this.$refs.uploadFiles.getValue();return e.forEach((function(e){e.id&&t.data.push({type:"attachments",id:e.id})})),t},addQuestion:function(){var t={data:{be_user_id:this.beAskId,price:this.priceAsk,is_onlooker:this.watchChecked,order_id:this.orderSn}};return t},deleteFile:function(t){this.deleteTip=this.i18n.t("core.deleteEnclosureSure"),this.$refs.deletePopup.open(),this.deleteType=1,this.deleteId=t},deleteFileSure:function(t){var e=this,i={_jv:{type:"attachments",id:t}};this.$store.dispatch("jv/delete",i).then((function(){e.$refs.uploadFiles.deleteSure()}))},getCategories:function(){var t=this;this.$store.dispatch("jv/get",["categories?filter[createThread]=1",{}]).then((function(e){t.allCategories=e,e.map((function(e){return e._jv&&Number(e._jv.id)===Number(t.categoryId)&&t.checkClassData.push(e),e}))}))},postThread:function(){var t=this,e="";e=this.checkClassData[0]._jv.id;var i={categoriesId:Number(e),content:this.textAreaValue,type:5,isAnonymous:this.checked?1:0,price:0,freeWords:this.word,id:this.currentId,isDraft:0,isOldDraft:this.currentId?1:0,captchaTicket:this.ticket,captchaRandStr:this.randstr,attachmentPrice:"",title:"",longitude:"",latitude:"",location:"",question:{type:0,price:Number(this.priceAsk),orderId:this.orderSn,isOnlooker:this.checked,beUserId:0,expiredAt:this.expired_at},attachments:[]},a=this.currentPosition;i.longitude=Number(a.longitude)||"",i.latitude=Number(a.latitude)||"",i.location=a.location||"",i.address=a.address||"";var s=new Promise((function(e){var a=t.addImg().data;a.forEach((function(t){i.attachments.push({id:Number(t.id),type:t.type})})),e()}));return s.then((function(){return u.default.createThread({data:i}).then((function(t){return t}))}))},handleClickOk:function(){this.$refs.deletePopup.close(),0===this.deleteType?(this.delAttachments(this.deleteId,this.deleteIndex),this.$refs.upload.clear(this.deleteIndex)):2===this.deleteType?(this.videoBeforeList=[],this.percent=0):3===this.deleteType&&(this.audioBeforeList=[])},handleClickCancel:function(){this.$refs.deletePopup.close()},handleWechatClickOk:function(){this.mpLogin()},handleWechatClickCancel:function(){this.$refs.wechatPopup.close()},delAttachments:function(t,e){if("edit"===this.operating){this.$u.event.$emit("deleteImg",{threadId:this.postDetails._jv.id,index:e});var i=this.$store.getters["jv/get"]("posts/".concat(this.postDetails.firstPost._jv.id));i.images.splice(e,1),i._jv.relationships.images.data.splice(e,1)}},getSignature:function(t){this.$store.dispatch("jv/get",["signature",{}]).then((function(e){t(e.signature)}))},postVideo:function(t){var e={_jv:{type:"thread/video"},file_id:t,type:0};this.$store.dispatch("jv/post",e)},getPostThread:function(t){var e=this,i={include:["firstPost","firstPost.images","threadVideo","threadAudio","category","firstPost.attachments","question","onlookers","question.beUser","question.images","firstPost.postGoods"]};this.$store.dispatch("jv/get",["threads/".concat(this.threadId),{params:i}]).then((function(i){switch(i.question&&(e.beUserName=i.question.beUser.username,e.beAskId=i.question.beUser.id,e.userImage=i.question.beUser.avatarUrl),e.postDetails=i,e.firstPostId=i.firstPost._jv.id,e.type=i.type,e.markdownShow=!1,e.attachmentList=i.firstPost.attachments||[],e.textAreaValue=i.firstPost.content,e.categoryId=i.category._jv.id,e.checkClassData.push(i.category),i.threadVideo&&(e.fileId=i.threadVideo.file_id,e.percent=1),i.firstPost.images&&i.firstPost.images.forEach((function(t){t&&e.uploadFile.push({type:"attachments",id:t._jv.id,order:t.order,name:t.fileName,url:t.url,path:t.thumbUrl?t.thumbUrl:""})})),6===e.type&&i.firstPost.postGoods&&(e.dataGoodInfo=i.firstPost.postGoods,-1!==i.firstPost.postGoods.price.indexOf("-")||Number(i.firstPost.postGoods.price)>0?e.dataGoodInfoPrice=i.firstPost.postGoods.price:Number(i.firstPost.postGoods.price)<=0&&(e.dataGoodInfoPrice=""),e.isShowGoods=!0),e.loadStatus=!0,Number(i.price)>0?(e.price=i.price,e.word=i.freeWords,e.freepercentage.forEach((function(t){i.freeWords===t.pay&&(e.percentagedisplay=t.name)})),e.payType=2,e.showPayType=e.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsPaid"),1===e.type&&(e.payNum[0].name="￥1",e.payNum[0].pay=1)):Number(i.attachmentPrice)>0?(e.price=i.attachmentPrice,e.payType=1,e.showPayType=e.i18n.t("discuzq.post.TheContentIsFreeAndTheAccessoriesArePaid"),e.payNum[0].name="￥1",e.payNum[0].pay=1):e.showPayType=e.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"),e.textAreaLength=1===e.type?49999:5e3,Number(i.type)){case 0:break;case 1:e.postTitle=i.title,e.setAnnex("img",i);break;case 2:e.percent=1,e.setAnnex("video",i);break;case 3:e.setAnnex("img",i);break;case 4:e.setAnnex("audio",i);break;case 5:e.setAnnex("img",i);break;case 6:e.setAnnex("goods",i);break;default:}if(t.name){var a={};a.location=t.name,a.address=t.addr,e.currentPosition=a}else e.currentPosition.longitude=i.longitude||"",e.currentPosition.latitude=i.latitude||"",e.currentPosition.location=i.location||"",e.currentPosition.address=i.address||"";"edit"===e.operating&&e.goodsId&&e.getGoodsInfo(),e.setThread()}))},getGoodsInfo:function(){var t=this;this.$store.dispatch("jv/get","goods/".concat(this.goodsId)).then((function(e){t.dataGoodInfo=e,-1!==e.price.indexOf("-")||Number(e.price)>0?t.dataGoodInfoPrice=e.price:Number(e.price)<=0&&(t.dataGoodInfoPrice=""),t.isShowGoods=!0}))},editThread:function(){var t=this;return l(a.default.mark((function e(){var i,s,o,r;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=0,s={_jv:{type:"posts",id:t.firstPostId,relationships:{},links:{self:"posts/".concat(t.firstPostId,"?include=user,thread,images")}},content:t.textAreaValue},o={_jv:{type:"threads",id:t.threadId,is_old_draft:1,relationships:{category:{data:{type:"categories",id:t.checkClassData[0]._jv.id}}}}},r=t.currentPosition,o.longitude=r.longitude||"",o.latitude=r.latitude||"",o.location=r.location||"",o.address=r.address||"",e.t0=t.type,e.next=0===e.t0?11:1===e.t0?12:2===e.t0?17:3===e.t0?21:4===e.t0?24:5===e.t0?28:6===e.t0?30:32;break;case 11:return e.abrupt("break",33);case 12:return o.title=t.postTitle,1===t.payType?(o.attachment_price=t.price,o.price=""):2===t.payType?(o.attachment_price="",o.price=t.price):0===t.payType&&(o.attachment_price="",o.price=""),o.free_words=t.word,s._jv.relationships.attachments={data:t.addImg().data.concat(t.addFile().data)},e.abrupt("break",33);case 17:return o.file_id=t.fileId,o.file_name=t.videoName,o.price=t.price,e.abrupt("break",33);case 21:return o.price=t.price,s._jv.relationships.attachments=t.addImg(),e.abrupt("break",33);case 24:return o.price=t.price,o.file_id=t.audioBeforeList[0].id,o.file_name=t.audioBeforeList[0].fileName,e.abrupt("break",33);case 28:return s._jv.relationships.attachments=t.addImg(),e.abrupt("break",33);case 30:return s.post_goods_id=t.dataGoodInfo._jv.id,e.abrupt("break",33);case 32:return e.abrupt("break",33);case 33:return e.next=35,t.$store.dispatch("jv/patch",s).then((function(t){return t._jv.json.data.id&&(i+=1),t._jv.json.data.attributes.isApproved,t}));case 35:return e.next=37,t.$store.dispatch("jv/patch",o).then((function(t){t._jv.json.data.id&&(i+=1)}));case 37:if(2!==i){e.next=39;break}return e.abrupt("return",i);case 39:throw new Error("出错了");case 40:case"end":return e.stop()}}),e)})))()},toTCaptcha:function(){var e=this;wx.navigateToMiniProgram({appId:"wx5a3a7366fd07e119",path:"/pages/captcha/index",envVersion:"release",extraData:{appId:this.forums.qcloud.qcloud_captcha_app_id},success:function(){},fail:function(){t.hideLoading(),e.postLoading=!1,e.payShowStatus=!1}})},changeAvatar:function(){t.navigateTo({url:"/pages/user/at-member?name=select"})}},(0,s.mapMutations)({setAtMember:"atMember/SET_ATMEMBER"})),onLoad:function(e){var i=this;this.setThread(),e.threadId&&(this.currentId=e.threadId,this.echoMoneyAndTime(e.threadId)),e.type,this.categoryid=e.categoryId,this.categoryindex=e.categoryIndex,t.$on("radioChange",(function(t){i.beUserName=t.username,i.beAskId=t.id,i.userImage=t.avatarUrl})),this.forums&&this.forums.other&&(this.canUploadAttachment=this.forums.other.can_upload_attachments),this.forums&&this.forums.paycenter&&("edit"!==e.operating&&this.forums.paycenter.wxpay_close?this.showPayType=this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"):this.askingPrice=!1),e.type&&(this.type=Number(e.type));var a=t.getSystemInfoSync();"ios"===a.platform&&5===this.type&&(this.askingPrice=!1),this.url=o.DISCUZ_REQUEST_HOST;var s=t.getStorageSync("access_token");if(this.header={authorization:"Bearer ".concat(s)},this.formData={type:1},this.getCategories(),e.operating&&(this.operating=e.operating),e.threadId&&(this.threadId=e.threadId),e.categoryIndex&&("0"===e.categoryIndex?this.categoryIndex="":this.categoryIndex=Number(e.categoryIndex)),e.categoryId&&(this.categoryId=0===Number(e.categoryId)?"":Number(e.categoryId)),this.textAreaLength=1===Number(e.type)?49999:5e3,"edit"===this.operating||"draft"===this.operating)this.loadStatus=!1,this.getPostThread(e);else if(this.loadStatus=!0,e.name&&e.latng){var r={};r.location=e.name,r.address=e.addr,this.currentPosition=r}try{var n=t.getSystemInfoSync();this.forums&&this.forums.paycenter.wxpay_close&&this.forums.other.can_create_thread_paid?"ios"===n.platform?this.ioshide=!1:(this.ioshide=!0,this.showHidden=!0):(this.ioshide=!1,this.showHidden=!1)}catch(d){}if(this.markdownShow=!1,this.$u.event.$on("captchaResult",(function(t){i.ticket=t.ticket,i.randstr=t.randstr,i.postClick()})),this.$u.event.$on("closeChaReault",(function(){i.postLoading=!1,i.payShowStatus=!1,t.hideLoading()})),t.$on("clickTopic",(function(t){i.textAreaValue="".concat(i.textAreaValue.slice(0,i.cursor),"  #").concat(t.keywords.replace(/\s+/g,""),"#").concat(i.textAreaValue.slice(i.cursor),"  "),i.cursor=i.textAreaValue?i.textAreaValue.length:0})),6===this.type&&(this.goodsId=e.goodsId),(6===this.type&&"edit"!==e.operating&&""!==e.threadId&&this.goodsId||6===this.type&&this.goodsId)&&this.getGoodsInfo(),2===this.type||3===this.type){var c=this.getOpenerEventChannel();c.on("acceptDataFromOpenerPage",(function(t){3===i.type&&(t.map((function(t){return i.uploadFile.push({type:"attachments",id:t.data.id,order:t.data.attributes.order,name:t.data.attributes.fileName,url:t.data.attributes.url,path:t.data.attributes.thumbUrl?t.data.attributes.thumbUrl:""}),i.filePreview.push({path:t.data.attributes.thumbUrl,id:t.data.id,order:t.data.attributes.order,name:t.data.attributes.fileName,url:t.data.attributes.url}),t})),i.addImg()),2===i.type&&t.data&&(t.data.doneResult?i.fileId=t.data.doneResult.fileId:i.fileId=t.data.result.fileId,i.videoBeforeList.push({path:t.data.uploadVideoRes.tempFilePath}),i.chooseType=0,i.percent=1)}))}},onShow:function(){var t="";this.getAtMemberData.map((function(e){return t+="@".concat(e.username," "),t})),this.textAreaValue="".concat(this.textAreaValue.slice(0,this.cursor)+t+this.textAreaValue.slice(this.cursor)),this.setAtMember([]),this.cursor=this.textAreaValue?this.textAreaValue.length:0,this.threadId},onReady:function(){this.videoContext=t.createVideoContext("video")},onUnload:function(){this.$u.event.$off("captchaResult"),this.$u.event.$off("closeChaReault"),this.$u.event.$off("radioChange"),this.$u.event.$off("radioEditChange"),this.captcha&&this.captcha.destroy(),clearInterval(P),clearInterval(x),clearInterval(this.timer1),this.timer1=null,clearInterval(this.timer2),this.timer2=null,this.save=!0}};e.default=T}).call(this,i("543d")["default"])},"374c":function(t,e,i){"use strict";i.r(e);var a=i("b61e"),s=i("fe02");for(var o in s)"default"!==o&&function(t){i.d(e,t,(function(){return s[t]}))}(o);i("f297");var r,n=i("f0c5"),c=Object(n["a"])(s["default"],a["b"],a["c"],!1,null,"2eb0030f",null,!1,a["a"],r);e["default"]=c.exports},"6b6d":function(t,e,i){"use strict";(function(t){i("8d7e");a(i("66fd"));var e=a(i("374c"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},"99fb":function(t,e,i){},b61e:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var a={quiPage:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-page/qui-page")]).then(i.bind(null,"a983"))},quiIcon:function(){return i.e("components/qui-icon/qui-icon").then(i.bind(null,"d13f"))},quiEmoji:function(){return i.e("components/qui-emoji/qui-emoji").then(i.bind(null,"0380"))},quiUploader:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-uploader/qui-uploader")]).then(i.bind(null,"bb64"))},uniPopup:function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,"78fd"))},quiCellItem:function(){return i.e("components/qui-cell-item/qui-cell-item").then(i.bind(null,"60f4"))},uSwitch:function(){return i.e("components/u-switch/u-switch").then(i.bind(null,"d6cc"))},quiPay:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-pay/qui-pay")]).then(i.bind(null,"2751"))},quiButton:function(){return i.e("components/qui-button/qui-button").then(i.bind(null,"018a"))},quiToast:function(){return i.e("components/qui-toast/qui-toast").then(i.bind(null,"b091"))},quiUploadFile:function(){return i.e("components/qui-upload-file/qui-upload-file").then(i.bind(null,"9494"))}},s=function(){var t=this,e=t.$createElement,i=(t._self._c,t.loadStatus&&5!==t.type&&t.textAreaValue.length<=t.textAreaLength?t.i18n.t("discuzq.post.note",{num:t.textAreaLength-t.textAreaValue.length}):null),a=!t.loadStatus||5===t.type||t.textAreaValue.length<=t.textAreaLength?null:t.i18n.t("discuzq.post.exceed",{num:t.textAreaValue.length-t.textAreaLength}),s=t.loadStatus&&5===t.type&&t.textAreaValue.length<=t.textAreaLength?t.i18n.t("discuzq.post.note",{num:t.textAreaLength-t.textAreaValue.length}):null,o=!t.loadStatus||5!==t.type||t.textAreaValue.length<=t.textAreaLength?null:t.i18n.t("discuzq.post.exceed",{num:t.textAreaValue.length-t.textAreaLength}),r=t.loadStatus&&5!==t.type?t.i18n.t("discuzq.post.placeholder"):null,n=t.loadStatus&&5===t.type?t.i18n.t("discuzq.post.placeholderQuestion"):null,c=t.loadStatus&&t.anonymity_show&&"edit"!==t.operating?t.i18n.t("discuzq.post.anonymity"):null,d=!t.loadStatus||!t.geographical_location||t.currentPosition&&t.currentPosition.location?null:t.i18n.t("discuzq.post.addPosition"),u=t.loadStatus&&t.payShowStatus?Number(t.user.walletBalance):null,h=t.loadStatus?t.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"):null,p=t.loadStatus&&1===t.type&&t.canUploadAttachment?t.i18n.t("discuzq.post.TheContentIsFreeAndTheAccessoriesArePaid"):null,l=t.loadStatus?t.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsPaid"):null,f=t.loadStatus?t.i18n.t("discuzq.post.cancel"):null,m=Number(t.categoryId),g=Number(t.categoryId),y=Number(t.categoryId),v=t.loadStatus?t.__map(t.allCategories,(function(e,i){var a=t.__get_orig(e),s=Number(e._jv.id),o=Number(e._jv.id),r=Number(e._jv.id);return{$orig:a,m1:s,m3:o,m5:r}})):null,_=Number(t.two_categoryId),b=Number(t.two_categoryId),w=Number(t.two_categoryId),I=t.loadStatus&&""!=t.secondallcategories?t.__map(t.secondallcategories,(function(e,i){var a=t.__get_orig(e),s=Number(e.id),o=Number(e.id),r=Number(e.id);return{$orig:a,m7:s,m9:o,m11:r}})):null,S=t.loadStatus?t.i18n.t("discuzq.post.post"):null,k=t.loadStatus?t.i18n.t("discuzq.post.cancel"):null,P=t.loadStatus&&t.popupStatus?t.i18n.t("discuzq.close"):null,x=t.loadStatus&&t.popupStatus?t.i18n.t("discuzq.ok"):null;t.$mp.data=Object.assign({},{$root:{g0:i,g1:a,g2:s,g3:o,g4:r,g5:n,g6:c,g7:d,m0:u,g8:h,g9:p,g10:l,g11:f,m2:m,m4:g,m6:y,l0:v,m8:_,m10:b,m12:w,l1:I,g12:S,g13:k,g14:P,g15:x}})},o=[]},f297:function(t,e,i){"use strict";var a=i("99fb"),s=i.n(a);s.a},fe02:function(t,e,i){"use strict";i.r(e);var a=i("1f78"),s=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=s.a}},[["6b6d","common/runtime","common/vendor"]]]);