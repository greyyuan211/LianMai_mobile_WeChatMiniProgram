(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["topic/index"],{"131d":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=S(a("a34a")),o=a("1299"),r=a("2f62"),n=a("0f20"),h=S(a("dc1b")),c=S(a("7a36")),d=S(a("76df")),u=S(a("c939")),p=a("e114"),l=S(a("5fbc")),m=S(a("d654")),f=a("cff7"),y=a("2ef0"),g=S(a("d654"));function S(t){return t&&t.__esModule?t:{default:t}}function w(t,e,s,a,i,o,r){try{var n=t[o](r),h=n.value}catch(c){return void s(c)}n.done?e(h):Promise.resolve(h).then(a,i)}function v(t){return function(){var e=this,s=arguments;return new Promise((function(a,i){var o=t.apply(e,s);function r(t){w(o,a,i,r,n,"next",t)}function n(t){w(o,a,i,r,n,"throw",t)}r(void 0)}))}}function P(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function k(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?P(Object(s),!0).forEach((function(e){T(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):P(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function T(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var C=function(){a.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(a("ba2b"))}.bind(null,a)).catch(a.oe)},x=null,b=null,_=!0,L={components:{uniPopupDialog:C},mixins:[h.default,c.default,u.default,d.default],data:function(){return{viewCount:0,number:"",timer:"",onUpdateRed:!1,redPacket:{},currentPostData:{},imageList:[],threadId:"",posts:[],splitLists:[],loadingType:"more",pageNum:1,pageSize:10,splitSize:10,payThreadTypeText:"",postIndex:"",footerShow:!0,commentPopupStatus:!1,commentWorkTips:!0,commentText:!0,maxTextLength:5e3,cursor:0,textAreaValue:"",barStatus:!1,uploadFile:[],isLiked:!1,role:"管理员",isActive:!0,shareShow:!1,beAsk:!1,answerPay:!1,payment:!1,questionId:"",beAskDate:0,beAskBeDate:0,platformDate:0,onLookformDate:0,bottomData:[{text:this.i18n.t("core.generatePoster"),icon:"icon-poster",name:"wx"},{text:this.i18n.t("core.wxShare"),icon:"icon-wx-friends",name:"wxFriends"}],seleShow:!1,selectList:[{text:this.i18n.t("topic.edit"),type:"0"},{text:this.i18n.t("topic.essence"),type:"2"},{text:this.i18n.t("topic.sticky"),type:"3"},{text:this.i18n.t("topic.delete"),type:"4"}],limitShowNum:12,paidStatus:!1,paidBtnStatus:!1,rewardBtnStatus:!1,canReward:!1,rewardStatus:!1,likedStatus:!1,commentStatus:{},commentReply:!1,commentAnser:!1,emojiShow:!1,publishClickStatus:!0,focusVal:!0,header:{},formData:{},commentId:"",isAnonymous:"0",payTypeText:"",payTypeVal:0,payNum:[{name:"￥1",pay:1},{name:"￥2",pay:2},{name:"￥5",pay:5},{name:"￥10",pay:10},{name:"￥20",pay:20},{name:"￥50",pay:50},{name:"￥88",pay:88},{name:"￥128",pay:128},{name:this.i18n.t("discuzq.post.customize"),pay:"0"}],payNumCheck:[{name:"",pay:""}],price:0,inputPrice:0,maxLength:7,payShowStatus:!0,pwdVal:"",orderSn:"",payStatus:!1,coverLoading:!1,payTypeData:[{name:"微信支付",icon:"icon-wxPay",color:"#09bb07",value:"0"},{name:"钱包支付",icon:"icon-walletPay",color:"#1878f3",value:"1"}],currentReplyPost:{},contentnomoreVal:"",url:"",customAmountStatus:!1,windowHeight:"",system:"",detectionmodel:"",paymentmodel:!1,loaded:!1,loadingStatus:!0,isWeixin:!1,isPhone:!1,qrcodeShow:!1,codeUrl:"",browser:0,wxRes:"",contentVal:"",shareLogo:"",desc:"",rewardedUsers:[],likedUsers:[],sortSeleShow:!1,sortSelectList:[{text:this.i18n.t("topic.sortTimeSequence"),type:"0",canOpera:!0},{text:this.i18n.t("topic.sortTimeReverse"),type:"1",canOpera:!0}],sortVal:"createdAt",refreshVal:!0,deleteId:"",deleteType:"",deletePostType:"",deletePostCanStatus:"",deletePostIsStatus:"",deletePost:"",deleteIndex:"",deleteTip:"确定删除吗？",wechatTip:this.i18n.t("discuzq.wechatBind"),deleteImgId:"",followStatus:"",beRewarded:!1,curUrl:"",bottom:"",moreData:[{text:this.i18n.t("topic.edit"),icon:"icon-bianji",name:"edit",type:"0",canOpera:!0},{text:this.i18n.t("topic.delete"),icon:"icon-shanchu",name:"delete",type:"4",canOpera:!0},{text:this.i18n.t("topic.essence"),icon:"icon-jinghua",name:"essence",type:"2",canOpera:!0},{text:this.i18n.t("topic.sticky"),icon:"icon-zhiding",name:"sticky",type:"3",canOpera:!0},{text:this.i18n.t("topic.collection"),icon:"icon-collection",name:"collection",type:"5",canOpera:!0},{text:this.i18n.t("topic.share"),icon:"icon-share",name:"share",type:"6",canOpera:!0},{text:this.i18n.t("core.generatePoster"),icon:"icon-poster",name:"poster",type:"7",canOpera:!0},{text:this.i18n.t("core.wxShare"),icon:"icon-wx-friends",name:"wxFriends",type:"8",canOpera:!0},{text:this.i18n.t("report.reportTitle"),icon:"icon-jubao",name:"report",type:"9",canOpera:!0}],moreDataLength:0,conversationId:"",attachmentFileList:[],refreshStatus:!0,threadIsPaidCover:!1,token:"",postGoodsStatus:!1,themeContent:"",shareAnonymous:!1}},onUnload:function(){this.$store.dispatch("forum/setError",{loading:!1}),this.posts=[],this.splitLists=[],t.$off("logind"),this.timer&&(clearInterval(this.timer),this.timer=null)},onHide:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},beforeDestroy:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},computed:k(k({},(0,r.mapState)({getAtMemberData:function(t){return t.atMember.atMemberData}})),{},{thread:function(){var t=(0,y.cloneDeep)(this.$store.getters["session/get"]("thread"));if(console.log(t,"threadDa"),t&&t.firstPost&&(this.themeContent=(0,f.modifyPostContentHtml)(t.firstPost.contentHtml)),!t)return{};var e=!1;return t.author&&t.author.groups&&t.author.groups.length>0&&(t.author.groups=t.author.groups.filter((function(t){if(!0===t.isDisplay&&!e)return e=!0,!0}))),t.rewardedUsers&&(this.rewardedUsers=t.rewardedUsers),t.likedUsers&&(this.likedUsers=t.likedUsers),t.images&&t.images.length>0&&(t.images=t.images.filter((function(e){return-1===t.firstPost.contentAttachIds.indexOf(String(e.id))}))),t.attachments&&t.attachments.length>0&&(t.attachments=t.attachments.filter((function(e){return-1===t.firstPost.contentAttachIds.indexOf(String(e.id))}))),t},t:function(){return this.i18n.t("topic")},p:function(){return this.i18n.t("pay")},c:function(){return this.i18n.t("core")},status:function(){return o.status.status},themeColor:function(){return this.theme===this.$u.light()?"#333":"#fff"},currentLoginId:function(){var t=this.$store.getters["session/get"]("userId");return parseInt(t,10)},restWord:function(){var t=5e3-this.textAreaValue.length;return t>0?t:0},restTextAreaValue:function(){var t=49999-this.textAreaValue.length;return t>0?t:0}}),onLoad:function(e){var s=this,a=t.getSystemInfoSync();if(this.system=a.platform,this.forums&&this.forums.set_site&&this.forums.set_site.site_mode&&(this.detectionmodel=this.forums.set_site.site_mode),this.forums&&this.forums.paycenter&&this.forums.paycenter.wxpay_ios&&(this.paymentmodel=this.forums.paycenter.wxpay_ios),"public"===this.detectionmodel&&"ios"===this.system&&(this.paidStatus=!1,this.paidBtnStatus=!1,this.rewardBtnStatus=!1,this.rewardStatus=!1),"pay"!==this.detectionmodel||"ios"!==this.system||this.user.paid){this.token=t.getStorageSync("access_token"),t.$on("logind",(function(){s.loadThread(),s.loadThreadPosts()})),this.threadId=e.id,this.conversationId=e.topicid||"",this.loadThread(),this.loadThreadPosts(),this.curUrl=(0,p.getCurUrl)(),this.rewardStatus=!1,this.paidStatus=!1,wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}),this.$u.event.$on("addComment",(function(t){(s.splitLists||[]).forEach((function(e){(e||[]).forEach((function(e){String(e.id)===String(t.commentId)&&(e.replyCount++,e.lastThreeComments.length>=3&&e.lastThreeComments.pop(),t.data&&e.lastThreeComments.unshift(t.data))}))}))})),this.$u.event.$on("deleteComment",(function(t){(s.splitLists||[]).forEach((function(e){(e||[]).forEach((function(e){if(String(e.id)===String(t.commentId)){var a,i,o,r,n,h;e.replyCount--,e.lastThreeComments=[];var c=(null===t||void 0===t||null===(a=t.data)||void 0===a||null===(i=a._jv)||void 0===i||null===(o=i.json)||void 0===o||null===(r=o.data)||void 0===r||null===(n=r.relationships)||void 0===n||null===(h=n.lastThreeComments)||void 0===h?void 0:h.data)||[];c&&c.length&&c.forEach((function(t){e.lastThreeComments.push(s.$store.getters["jv/get"]("".concat(t.type,"/").concat(t.id)))}))}}))}))})),this.url=n.DISCUZ_REQUEST_HOST;var i=t.getStorageSync("access_token");this.header={authorization:"Bearer ".concat(i)},this.formData={type:1},this.$u.event.$on("refreshFiles",(function(){s.loadThread()}))}else this.$store.dispatch("forum/setError",{loading:!1,code:"dataerro"})},created:function(){this.preThreadsPostsData=null,this.preThreadsPostsLoading=!1},onPullDownRefresh:function(){var e=this;e.posts=[],e.splitLists=[],e.pageNum=1,this.preThreadsPostsData=null,e.attachmentFileList=[],setTimeout((function(){_=!0,e.loadThread(),e.loadThreadPosts(),t.stopPullDownRefresh()}),1e3)},onReachBottom:function(){"more"===this.loadingType&&(this.pageNum+=1,this.loadThreadPosts())},onPageScroll:function(t){this.preLoadThreadPosts()},onShareAppMessage:function(t){if("button"===t.from){var e=this.$store.getters["jv/get"]("/threads/".concat(this.threadId));return 0===parseFloat(this.thread.thread.price)?{title:1===e.type?this.thread.thread.title:this.thread.firstPost.content}:this.thread.thread.isAnonymous?{title:"......",imageUrl:"/static/share.png"}:{title:"......",imageUrl:"/static/priceShare.png"}}if(this.thread.thread.isAnonymous&&0===parseFloat(this.thread.thread.price)&&(this.shareAnonymous=!0),0===parseFloat(this.thread.thread.price)){var s=this.$store.getters["jv/get"]("/threads/".concat(this.threadId));return{title:1===s.type?this.thread.thread.title:this.thread.firstPost.content}}return this.thread.thread.isAnonymous?{title:"......",imageUrl:"/static/share.png"}:{title:"......",imageUrl:"/static/priceShare.png"}},onShareTimeline:function(){var t=this.thread?this.thread.thread.title||this.thread.firstPost.content:"";return{title:t,query:"id=".concat(this.threadId),imageUrl:this.shareLogo}},onShow:function(){this.shareAnonymous=!1;var e=t.getSystemInfoSync();if(this.system=e.platform,this.forums&&this.forums.set_site&&this.forums.set_site.site_mode&&(this.detectionmodel=this.forums.set_site.site_mode),this.forums&&this.forums.paycenter&&this.forums.paycenter.wxpay_ios&&(this.paymentmodel=this.forums.paycenter.wxpay_ios),this.forums&&this.forums.set_site&&this.forums.set_site.site_can_reward&&(this.canReward=1===this.forums.set_site.site_can_reward),"public"===this.detectionmodel&&"ios"===this.system&&(this.paidStatus=!1,this.paidBtnStatus=!1,this.rewardBtnStatus=!1,this.rewardStatus=!1),"pay"!==this.detectionmodel||"ios"!==this.system||this.user.paid){var s="";this.getAtMemberData.map((function(t){return s+="@".concat(t.username," "),s})),this.textAreaValue="".concat(this.textAreaValue.slice(0,this.cursor)+s+this.textAreaValue.slice(this.cursor)),this.setAtMember([])}else this.$store.dispatch("forum/setError",{loading:!1,code:"dataerro"})},methods:k(k({},(0,r.mapMutations)({setAtMember:"atMember/SET_ATMEMBER",setCategoryId:"session/SET_CATEGORYID",setCategoryIndex:"session/SET_CATEGORYINDEX",setFooterIndex:"footerTab/SET_FOOTERINDEX"})),{},{touchStop:function(){},shareFun:function(){this.shareAnonymous=!1},initRedPacket:function(t){var e=this;this.redPacket.isRedPacket=t.isRedPacket,0!==this.redPacket.isRedPacket&&(this.autoUpdateRedpacketStatus(),this.timer=setInterval((function(){e.autoUpdateRedpacketStatus()}),3e3))},autoUpdateRedpacketStatus:function(){var t=this;return v(i.default.mark((function e(){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.onUpdateRed){e.next=2;break}return e.abrupt("return");case 2:if(0!==t.redPacket.remain_number){e.next=4;break}return e.abrupt("return",clearInterval(t.timer));case 4:return t.onUpdateRed=!0,e.next=7,t.$store.dispatch("jv/get",["redpacket/".concat(t.threadId),{custom:{loading:!1}}]).then((function(e){t.redPacket=Object.assign({},t.redPacket,e),t.onUpdateRed=!1}),(function(t){return console.log(t)}));case 7:case"end":return e.stop()}}),e)})))()},submitadoption:function(e,s,a){var i=this,o={_jv:{type:"posts/reward"},thread_id:a,rewards:e,post_id:s};this.$store.dispatch("jv/post",o).then((function(e){t.redirectTo({url:"/topic/index?id=".concat(i.threadId)})}))},loadThread:function(){var e=this,s={pid:Number(this.threadId)};m.default.readThreadDetail({params:s}).then((function(s){console.log(s,"readThreadDetail");var a=s.Data;e.$store.dispatch("session/setThread",a),e.themeContent=(0,f.modifyPostContentHtml)(a.firstPost.contentHtml);var i=a.thread.viewCount,o=void 0===i?0:i;if(e.viewCount=o,e.initRedPacket(a.thread),a.thread.isDeleted)e.$store.dispatch("forum/setError",{code:"thread_deleted",status:500}),e.loaded=!1;else switch(a.postGoods?e.postGoodsStatus=!0:e.postGoodsStatus=!1,1===a.thread.type?a.thread.attachmentPrice>0||a.thread.price>0&&a.thread.isPaid||a.thread.price<=0?e.threadIsPaidCover=!1:a.thread.price>0&&!a.thread.isPaid&&(e.threadIsPaidCover=!0):e.threadIsPaidCover=!1,_&&a.attachments&&a.attachments.forEach((function(t){-1===a.firstPost.contentAttachIds.indexOf(String(t.id))&&e.attachmentFileList.push(t)})),console.log(a.question,"data.question"),a.question&&(e.currentPostData=a,e.platformDate=(a.question.price*(e.forums.set_site.site_master_scale/10)).toFixed(2),e.onLookformDate=(a.question.onlookerUnitPrice*(e.forums.set_site.site_master_scale/10)).toFixed(2),e.beAskDate=(a.question.price-e.platformDate).toFixed(2),e.beAskBeDate=((a.question.onlookerUnitPrice-e.onLookformDate)/2).toFixed(2),"0.00"===a.question.price?e.user.id===a.question.beUserId&&0===a.question.isAnswer?e.beAsk=!0:e.user.id===a.author.id&&1===a.question.isAnswer||e.user.id===a.question.beUserId&&1===a.question.isAnswer?(e.beAsk=!1,e.payment=!0,e.answerPay=!1):(e.user.id!==a.question.beUserId&&e.user.id!==a.author.id&&1===a.question.isAnswer&&!0===a.question.isOnlooker||e.user.id!==a.question.beUserId&&e.user.id!==a.author.id&&1===a.question.isAnswer&&!1===a.question.isOnlooker)&&(e.beAsk=!1,e.payment=!1,e.answerPay=!0):a.question.price>"0.00"&&(e.user.id===a.question.beUserId&&0===a.question.isAnswer?e.beAsk=!0:e.user.id===a.question.beUserId&&1===a.question.isAnswer||e.user.id===a.author.id&&1===a.question.isAnswer?(e.beAsk=!1,e.answerPay=!0):e.user.id===a.question.beUserId&&1===a.question.isAnswer&&a.question.onlookerNumber>0||e.user.id===a.author.id&&1===a.question.isAnswer&&a.question.onlookerNumber>0?(e.answerPay=!0,e.beAsk=!1):(e.user.id!==a.question.beUserId&&e.user.id!==a.author.id&&1===a.question.isAnswer&&!1===a.question.isOnlooker&&!0===a.onlookerState||e.user.id!==a.author.id&&1===a.question.isAnswer&&!0===a.question.isOnlooker&&!1===a.onlookerState||e.user.id!==a.author.id&&e.user.id!==a.question.beUserId&&!0===a.question.isOnlooker&&1===a.question.isAnswer&&!0===a.onlookerState)&&(e.answerPay=!0)),e.questionId=a.question.id),e.loaded=!0,e.loadingStatus=!1,a.thread.type){case 0:e.contentVal=a.firstPost.summaryText,e.desc=a.firstPost.summaryText,e.shareLogo="";break;case 1:e.contentVal=a.thread.title,a.thread.price>0?(e.desc=a.thread.title,e.shareLogo=""):(e.desc=a.firstPost.summaryText,e.shareLogo=a.images.length>0?a.images[0].thumbUrl:"");break;case 2:e.contentVal=a.firstPost.summaryText,e.desc=a.firstPost.summaryText,e.shareLogo=a.threadVideo.coverUrl;break;case 3:e.contentVal=a.firstPost.summaryText,e.desc=a.firstPost.summaryText,e.shareLogo=0==a.price&&a.images.length>0?a.images[0].thumbUrl:"";break;case 4:e.contentVal=a.firstPost.summaryText,e.desc=a.firstPost.summaryText,e.shareLogo="";break;case 5:e.contentVal=a.firstPost.summaryText,e.desc=a.firstPost.summaryText,e.shareLogo=a.images.length>0?a.images[0].thumbUrl:"";break;case 6:e.contentVal=a.postGoods.title,e.desc=a.firstPost.summaryText,e.shareLogo=a.postGoods.imagePath;break;default:}if(e.thread.firstPost&&(e.selectList[0].canOpera=e.thread.firstPost.canEdit),e.selectList[1].canOpera=e.thread.thread.canEssence,e.selectList[2].canOpera=e.thread.thread.canSticky,e.selectList[3].canOpera=e.thread.thread.canHide,e.selectList[1].isStatus=e.thread.thread.isEssence,e.selectList[2].isStatus=e.thread.thread.isSticky,e.selectList[3].isStatus=!1,a.isEssence&&(e.selectList[1].text=e.t.cancelEssence),a.isSticky&&(e.selectList[2].text=e.t.cancelSticky),e.moreData[5].canOpera=!1,e.moreData[6].canOpera=!0,e.moreData[7].canOpera=!0,5===a.type?e.moreData[0].canOpera=!1:e.moreData[0].canOpera=e.thread.firstPost.canEdit,e.moreData[2].canOpera=e.thread.thread.canEssence,e.moreData[3].canOpera=e.thread.thread.canSticky,e.moreData[1].canOpera=e.thread.thread.canHide,e.moreData[2].isStatus=e.thread.thread.isEssence,e.moreData[3].isStatus=e.thread.thread.isSticky,e.moreData[1].isStatus=!1,e.moreData.forEach((function(t){t.canOpera&&(e.moreDataLength+=1)})),a.isFavorite&&(e.moreData[4].text=e.t.collectionAlready,e.moreData[4].icon="icon-collectioned"),a.thread.isEssence&&(e.moreData[2].text=e.t.cancelEssence,e.moreData[2].icon="icon-quxiaojinghua"),a.thread.isSticky&&(e.moreData[3].text=e.t.cancelSticky,e.moreData[3].icon="icon-quxiaozhiding"),e.isLiked=a.firstPost.isLiked,5===a.thread.type)return e.rewardStatus=!1,void(e.paidStatus=!1);if(e.forums.paycenter.wxpay_close)if(e.forums.paycenter.wxpay_close){var r=t.getSystemInfoSync();e.system=r.platform,(!a.thread.paid||a.paidUsers.length>0)&&("ios"===e.system&&!1===e.paymentmodel?(e.paidStatus=!1,e.paidBtnStatus=!1):(e.paidStatus=!0,e.paidBtnStatus=!0)),3===a.thread.type?e.payThreadTypeText=e.t.pay+a.thread.price+e.t.paymentViewPicture:2===a.thread.type?e.payThreadTypeText=e.t.pay+a.thread.price+e.t.paymentViewVideo:1===a.thread.type?a.thread.attachmentPrice>0?e.payThreadTypeText=e.t.pay+a.thread.attachmentPrice+e.t.checkTheAttachment:e.payThreadTypeText=e.t.pay+a.thread.price+e.t.paymentViewRemainingContent:5===a.thread.type?e.payThreadTypeText=e.t.pay+a.thread.price+e.t.paymentViewRemainingContent:4===a.thread.type&&(e.payThreadTypeText=e.t.pay+a.thread.price+e.t.paymentViewAudio),a.thread.price<=0?"ios"===e.system?a.thread.attachmentPrice>0&&!1===a.thread.isPaidAttachment?!1===e.paymentmodel?(e.paidStatus=!1,e.rewardStatus=!1):!0===e.paymentmodel&&(e.paidStatus=!0,e.rewardStatus=!1):a.thread.attachmentPrice>0&&!0===a.thread.isPaidAttachment?!1===e.paymentmodel?(e.paidStatus=!1,e.rewardStatus=!1):!0===e.paymentmodel&&(e.paidStatus=!0,e.paidBtnStatus=!1,e.rewardStatus=!1):!1===e.paymentmodel?(e.paidStatus=!1,e.rewardStatus=!1):!0===e.paymentmodel&&(a.thread.canBeReward?(e.paidStatus=!1,e.rewardStatus=!0,e.rewardBtnStatus=!0):(e.rewardStatus=!1,e.rewardBtnStatus=!1)):a.thread.attachmentPrice>0&&!1===a.thread.isPaidAttachment?(e.paidStatus=!0,e.paidBtnStatus=!0,e.rewardStatus=!1,e.rewardBtnStatus=!1):a.thread.attachmentPrice>0&&!0===a.thread.isPaidAttachment?(e.paidStatus=!0,e.paidBtnStatus=!1,e.rewardStatus=!1,e.rewardBtnStatus=!1):a.thread.canBeReward?(e.paidStatus=!1,e.rewardStatus=!0,e.rewardBtnStatus=!0):(e.paidStatus=!1,e.rewardStatus=!1,e.rewardBtnStatus=!1):("ios"===e.system?!1===e.paymentmodel?(e.paidStatus=!1,e.paidBtnStatus=!1):!0===e.paymentmodel&&!1===a.thread.paid?(e.paidStatus=!0,e.paidBtnStatus=!0):!0===e.paymentmodel&&!0===a.thread.paid&&(e.paidStatus=!0,e.paidBtnStatus=!1):!0===a.thread.paid?e.paidBtnStatus=!1:(e.paidStatus=!0,e.paidBtnStatus=!0),e.rewardStatus=!1,e.rewardBtnStatus=!1)}else e.rewardStatus=!1,e.paidBtnStatus=!1;else e.rewardStatus=!1,e.paidStatus=!1;a.likedUsers.length<1?e.likedStatus=!1:e.likedStatus=!0})).catch((function(t){e.loaded=!1,e.loadingStatus=!1,404===t.statusCode&&e.$store.dispatch("forum/setError",{code:"type_404",status:500})}))},postOpera:function(e,s,a,i,o){var r=this;if("1"!==s||a)if("4"!==s||a){var n={type:"posts",id:e},h={};"1"===s?h={_jv:n,isLiked:!i}:"3"===s?h={_jv:n,isDeleted:!i}:"4"===s&&(h={_jv:n,isLiked:!i}),this.$store.dispatch("jv/patch",h).then((function(e){if("1"===s)r._updateLikedUsers(e.isLiked);else if("2"===s)e.isDeleted&&t.navigateBack({delta:1});else if("3"===s){var a=o;a.isDeleted=e.isDeleted,o=a,r.thread.thread.postCount-=1}else if("4"===s){var i=o;i.isLiked=e.isLiked,i.likeCount=e.likeCount,o=i,r.loadThreadPosts()}})).catch((function(t){console.log(t)}))}else this.$refs.toast.show({message:this.t.noReplyLikePermission});else this.$refs.toast.show({message:this.t.noThreadLikePermission})},threadOpera:function(e,s,a,i){var o=this,r={type:"threads",id:e},n={};n="1"===i?{_jv:r,isFavorite:!a}:"2"===i?{_jv:r,isEssence:!a}:"3"===i?{_jv:r,isSticky:!a}:{_jv:r,isDeleted:!a},this.$store.dispatch("jv/patch",n).then((function(e){if("1"===i)o.thread.isFavorite=e.isFavorite,e.isFavorite?(o.moreData[4].text=o.t.collectionAlready,o.moreData[4].icon="icon-collectioned"):(o.moreData[4].text=o.t.collection,o.moreData[4].icon="icon-collection");else if("2"===i)o.selectList[1].isStatus=e.isEssence,o.moreData[2].isStatus=e.isEssence,console.log(e.isEssence),e.isEssence?(o.selectList[1].text=o.t.cancelEssence,o.moreData[2].text=o.t.cancelEssence,o.moreData[2].icon="icon-quxiaojinghua",o.thread.thread.isEssence=!0):(o.selectList[1].text=o.t.essence,o.moreData[2].text=o.t.essence,o.moreData[2].icon="icon-jinghua",o.thread.thread.isEssence=!1);else if("3"===i)o.selectList[2].isStatus=e.isSticky,o.moreData[3].isStatus=e.isSticky,e.isSticky?(o.selectList[2].text=o.t.cancelSticky,o.moreData[3].icon="icon-quxiaozhiding",o.moreData[3].text=o.t.cancelSticky,o.$refs.toast.show({message:o.t.stickysuccess}),o.$u.event.$emit("stickyThread",e)):(o.selectList[2].text=o.t.sticky,o.moreData[3].icon="icon-zhiding",o.moreData[3].text=o.t.sticky,o.$refs.toast.show({message:o.t.cancelStickysuccess}),o.$u.event.$emit("refreshHome",e));else if("4"===i){var s=o;if(e.isDeleted){o.$refs.toast.show({message:o.t.deleteSuccessAndJumpToBack});var a=getCurrentPages();setTimeout((function(){s.conversationId?t.redirectTo({url:"/pages/topic/content?id=".concat(s.conversationId)}):a.length<=2?t.redirectTo({url:"/pages/home/index"}):t.navigateBack({delta:1}),s.$store.dispatch("jv/get","topics/".concat(s.conversationId)).then((function(t){t&&(s.conversationId="")}))}),1e3);o.$u.event.$emit("refreshHome",o.threadId,"delete")}}})).catch((function(t){console.log(t)}))},postComment:function(){var t=this;if(this.textAreaValue.length<1)return this.$refs.toast.show({message:this.t.replyContentCannotBeEmpty}),this.publishClickStatus=!0,!1;var e={};this.commentReply?e={id:parseInt(this.threadId),content:this.textAreaValue,replyId:this.commentId,isComment:!0}:this.commentAnser||(e={id:parseInt(this.threadId),content:this.textAreaValue}),e.attachments=[],this.uploadFile&&this.uploadFile.forEach((function(t){e.attachments.push({type:"attachments",id:t.id})})),g.default.createPosts({data:e}).then((function(e){if("操作太频繁了，请稍后再试"===e.Message)return t.$refs.commentPopup.close(),t.publishClickStatus=!0,t.textAreaValue="",void(t.uploadFile="");if(t.$refs.commentPopup.close(),t.commentReply=!1,t.commentPopupStatus=!1,t.publishClickStatus=!0,1===e.Data.isApproved)if(e.Data.isComment)for(var s=0;s<t.posts.length;s++){var a=t.posts[s];if(console.log(a,"element"),a.id===t.commentId){a.lastThreeComments||(a.lastThreeComments=[]),a.lastThreeComments.unshift(e.Data),a.replyCount+=1,console.log("element11",a);break}}else{var i=!1;e.Data.user.groups=e.Data.user.groups.filter((function(t){return!0===t.isDisplay&&!i&&(i=!0,!0)})),t.posts.push(e.Data),t.thread.thread.postCount+=1}else t.$refs.toast.show({message:"您发布的内容正在审核中哦"});t.textAreaValue="",t.uploadFile="",t.loadThreadPosts()})).catch((function(e){t.publishClickStatus=!0,console.log(e)}))},handleGroup:function(t){var e=[];return t&&t.length>0&&(e=t.filter((function(t){return t.isDisplay}))),e.length>0?[e[0]]:[]},postAnswer:function(){var e=this;if(this.commentAnser=!0,this.textAreaValue.length<1)return this.$refs.toast.show({message:this.t.TheContentOfTheAnswerCannotBeEmpty}),this.publishClickStatus=!0,!1;var s={content:this.textAreaValue,type:5,_jv:{type:"answer",relationships:{},links:{self:"questions/".concat(this.questionId,"/answer")}}};s._jv.relationships.attachments={data:[]},this.uploadFile&&this.uploadFile.forEach((function(t){s._jv.relationships.attachments.data.push({type:"attachments",id:t.id})})),this.$store.dispatch("jv/post",s).then((function(t){e.$refs.commentPopup.close(),e.loadThread()})).catch((function(s){s&&s.data&&s.data.errors&&"content_banned_show_words"===s.data.errors[0].code&&t.showToast({icon:"none",title:"".concat(e.i18n.t("core.content_banned_show_words"),"[").concat(s.data.errors[0].detail.join("、"),"]"),duration:2e3})}))},preLoadThreadPosts:function(){var t=this;if(!this.preThreadsPostsData&&!this.preThreadsPostsLoading){this.preThreadsPostsLoading=!0;var e={page:this.pageNum+1,perPage:this.pageSize,"filter[thread]":this.threadId,sort:this.sortVal};m.default.readCommentList({params:e}).then((function(s){t.preThreadsPostsData=T({},e.page,s)})).catch((function(){t.preThreadsPostsData=null})).finally((function(){t.preThreadsPostsLoading=!1}))}},loadThreadPosts:function(){var t=this;return v(i.default.mark((function e(){var s,a,o,r,n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t.preThreadsPostsData),s={page:t.pageNum,perPage:t.pageSize,"filter[thread]":t.threadId,sort:t.sortVal},e.prev=2,!t.preThreadsPostsData||!t.preThreadsPostsData[t.pageNum]){e.next=8;break}a=t.preThreadsPostsData[t.pageNum],t.preThreadsPostsData=null,e.next=12;break;case 8:return t.preThreadsPostsData=null,e.next=11,m.default.readCommentList({params:s});case 11:a=e.sent;case 12:console.log(a,"readCommentList"),r=t.modifyPostCommentHtml(a.Data.pageData),n=[],r.forEach((function(t){if(!t.isDeleted){var e=t.isDeleted,s=t.id,a=t.user,i=a.id,o=a.avatar,r=a.username,h=a.isReal,c=a.groups,d=t.canLike,u=t.isLiked,p=t.createdAt,l=t.isApproved,m=t.summary,f=t.lastThreeComments,y=t.likeCount,g=t.images,S=t.replyCount,w=t.canHide,v=t.rewards,P=t.redPacketAmount,k={isDeleted:e,id:s,user:{id:i,avatar:o,username:r,isReal:h,groups:c},canLike:d,isLiked:u,createdAt:p,isApproved:l,summary:m,lastThreeComments:f,likeCount:y,images:g,replyCount:S,canHide:w,rewards:v,redPacketAmount:P};n.push(k)}})),console.log(n),(o=t.posts).push.apply(o,n),t.splitLists[t.pageNum-1]=n,t.loadingType=n.length===t.pageSize?"more":"nomore",0===n.length?t.contentnomoreVal=t.t.noComment:t.contentnomoreVal=t.t.noMoreData,e.next=26;break;case 23:e.prev=23,e.t0=e["catch"](2),console.log(e.t0);case 26:case"end":return e.stop()}}),e,null,[[2,23]])})))()},onBridgeReady:function(t){var e=this;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.wechat_js.appId,timeStamp:t.wechat_js.timeStamp,nonceStr:t.wechat_js.nonceStr,package:t.wechat_js.package,signType:"MD5",paySign:t.wechat_js.paySign},(function(t){"get_brand_wcpay_request:ok"==t.err_msg||("get_brand_wcpay_request:cancel"==t.err_msg||"get_brand_wcpay_request:fail"==t.err_msg)&&(clearInterval(x),resolve)})),x=setInterval((function(){1!==e.payStatus?e.getOrderStatus(e.orderSn):clearInterval(x)}),3e3)},creatOrder:function(t,e,s,a){var i=this,o={_jv:{type:"orders"},type:e,thread_id:this.threadId,amount:t,is_anonymous:this.isAnonymous};this.$store.dispatch("jv/post",o).then((function(t){i.orderSn=t.order_sn,0===a?0==i.browser?i.orderPay(13,s,i.orderSn,a,"0"):i.isWeixin&&i.isPhone?i.orderPay(12,s,i.orderSn,a,"1"):i.isPhone?i.orderPay(11,s,i.orderSn,a,"2"):i.orderPay(10,s,i.orderSn,a,"3"):1===a&&i.orderPay(20,s,i.orderSn,a)})).catch((function(t){console.log(t)}))},orderPay:function(e,s,a,i,o){var r=this,n={};0===i?n={_jv:{type:"trade/pay/order/".concat(a)},payment_type:e}:1===i&&(n={_jv:{type:"trade/pay/order/".concat(a)},payment_type:e,pay_password:s}),this.$store.dispatch("jv/post",n).then((function(e){r.wxRes=e,0===i?"0"===o?r.wechatPay(e.wechat_js.timeStamp,e.wechat_js.nonceStr,e.wechat_js.package,e.wechat_js.signType,e.wechat_js.paySign):"1"===o?"undefined"===typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",r.onBridgeReady(e),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",r.onBridgeReady(e)),document.attachEvent("onWeixinJSBridgeReady",r.onBridgeReady(e))):r.onBridgeReady(e):"2"===o?(b=setInterval((function(){1!==r.payStatus?r.getOrderStatus(a,o):clearInterval(b)}),3e3),window.location.href=e.wechat_h5_link):"3"===o&&e&&(r.codeUrl=e.wechat_qrcode,r.payShowStatus=!1,r.$refs.codePopup.open(),r.qrcodeShow=!0,x=setInterval((function(){1!==r.payStatus?(r.getOrderStatus(r.orderSn,o),t.hideLoading()):clearInterval(x)}),3e3)):1===i&&("success"===e.wallet_pay.result&&(r.$store.dispatch("jv/get",["users/".concat(r.currentLoginId),{}]),0===r.payTypeVal||2===r.payTypeVal||3===r.payTypeVal?(r.thread.thread.attachmentPrice>0&&(_=!1),r.loadThread(),r.$store.dispatch("jv/get",["forum",{params:{include:"users"}}])):1===r.payTypeVal&&r._updateRewardUsers(),r.payShowStatus=!1,r.coverLoading=!1),r.coverLoading=!1)})).catch((function(t){console.log(t),r.$refs.payShow.clearPassword()}))},getOrderStatus:function(t,e){var s=this;this.$store.dispatch("jv/get",["orders/".concat(t),{custom:{loading:!1}}]).then((function(t){s.payStatus=t.status,1===s.payStatus&&(s.payShowStatus=!1,s.coverLoading=!1,"2"===e||"3"===e&&(s.$refs.codePopup.close(),s.qrcodeShow=!1,_=!1,s.loadThread(),s.$store.dispatch("jv/get",["forum",{params:{include:"users"}}])),0===s.payTypeVal||2===s.payTypeVal||3===s.payTypeVal?(s.thread.thread.attachmentPrice>0&&(_=!1),s.loadThread(),s.$store.dispatch("jv/get",["forum",{params:{include:"users"}}])):1===s.payTypeVal&&s._updateRewardUsers(),s.$refs.toast.show({message:s.p.paySuccess}))})).catch((function(t){console.log(t),s.coverLoading=!1,s.$refs.toast.show({message:s.p.payFail})}))},wechatPay:function(e,s,a,i,o){var r=this;t.requestPayment({provider:"wxpay",timeStamp:e,nonceStr:s,package:a,signType:i,paySign:o,success:function(t){r.coverLoading=!0,x=setInterval((function(){1!==r.payStatus?r.getOrderStatus(r.orderSn):clearInterval(x)}),3e3)},fail:function(t){r.payShowStatus=!1,r.coverLoading=!1,r.$refs.toast.show({message:r.p.payFail})}})},onInput:function(t){this.value=t,0===this.payTypeVal?this.creatOrder(this.thread.thread.price,3,t,1):1===this.payTypeVal?this.creatOrder(this.price,2,t,1):2===this.payTypeVal?this.creatOrder(this.price,6,t,1):3===this.payTypeVal&&this.creatOrder(this.thread.thread.attachmentPrice,7,t,1)},paysureShow:function(e){if(t.setStorage({key:"page",data:"/topic/index?id=".concat(this.threadId)}),0===e){if(void 0===this.user.wechat||this.user.wechat&&""===this.user.wechat.min_openid)return void this.$refs.wechatPopup.open();0===this.payTypeVal?this.creatOrder(this.thread.thread.price,3,this.value,e):1===this.payTypeVal?this.creatOrder(this.price,2,this.value,e):2===this.payTypeVal?this.creatOrder(this.price,6,this.value,e):3===this.payTypeVal&&this.creatOrder(this.thread.thread.attachmentPrice,7,this.value,e)}},limitArray:function(t){var e=[];return Object.values(t).forEach((function(t){e.push(t)})),e},selectClick:function(){this.seleShow=!this.seleShow},selectChoice:function(e){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),"0"===e.type?t.redirectTo({url:"/topic/post?type=".concat(this.thread.thread.type,"&operating=edit&threadId=").concat(this.thread.thread.id)}):"2"===e.type||"3"===e.type?this.threadOpera(this.threadId,e.canOpera,e.status,e.type):"4"===e.type&&(this.$refs.deletePopup.open(),this.deleteType="4",this.deleteId=this.threadId,this.deletePostCanStatus=e.canOpera,this.deletePostIsStatus=e.status,this.deletePostType=e.type,this.deleteTip=this.i18n.t("core.deleteContentSure"))},beAskClick:function(e){e<=0||t.navigateTo({url:"/pages/profile/index?userId=".concat(e)})},personJump:function(e){!e||e<=0||t.navigateTo({url:"/pages/profile/index?userId=".concat(e)})},payClickShow:function(){var e=this;if(!this.$store.getters["session/get"]("isLogin"))return t.setStorage({key:"page",data:(0,p.getCurUrl)()}),void this.mpLoginMode();if(this.payStatus=!1,this.forums.paycenter.wxpay_close)if(this.forums.paycenter.wxpay_close){if("ios"===this.system){if(!1===this.paymentmodel)return void(this.payShowStatus=!1);this.payShowStatus=!0}else this.payShowStatus=!0;this.payTypeVal=0,this.thread.thread.attachmentPrice>0?this.payTypeVal=3:this.payTypeVal=0,3===this.thread.thread.type?(this.payTypeText=this.t.pay+this.t.paymentViewPicture,this.price=parseFloat(this.thread.thread.price)):1===this.thread.thread.type?this.thread.thread.attachmentPrice>0?(this.payTypeText=this.t.pay+this.thread.thread.attachmentPrice+this.t.checkTheAttachment,this.price=parseFloat(this.thread.thread.attachmentPrice)):(this.payTypeText=this.t.pay+this.thread.thread.price+this.t.paymentViewRemainingContent,this.price=parseFloat(this.thread.thread.price)):2===this.thread.thread.type?(this.payTypeText=this.t.pay+this.t.paymentViewVideo,this.price=parseFloat(this.thread.thread.price)):4===this.thread.thread.type&&(this.payTypeText=this.t.pay+this.t.paymentViewAudio,this.price=parseFloat(this.thread.thread.price)),this.$nextTick((function(){e.$refs.payShow.payClickShow(e.payTypeVal)}))}else this.payShowStatus=!1;else this.payShowStatus=!1},payAnswerClickShow:function(){var e=this;this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.payStatus=!1,this.payTypeVal=2,this.price=parseFloat(this.thread.question.onlookerUnitPrice),this.$nextTick((function(){e.$refs.payShow.payClickShow(e.payTypeVal)}))},radioMyHead:function(t){this.isAnonymous=!t},radioChange:function(t){},rewardClick:function(){if(this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.user.id===this.thread.author.id)return this.$refs.toast.show({message:this.t.iCantRewardMyself}),!1;this.payStatus=!1,this.payTypeVal=1,this.payTypeText=this.t.supportTheAuthorToCreate,this.payNumCheck=[{name:"",pay:""}],this.$refs.rewardPopup.open()},cancelReward:function(){this.payNumCheck=[{name:"",pay:""}],this.$refs.rewardPopup.close()},moneyClick:function(t){var e=this;this.payNumCheck=[],this.payNumCheck.push(this.payNum[t]),"自定义"===this.payNumCheck[0].name?(this.$refs.rewardPopup.close(),this.$nextTick((function(){e.$refs.customAmountPopup.open(),e.customAmountStatus=!0}))):(this.price=this.payNumCheck[0].pay,this.payShowStatus=!0,this.$refs.rewardPopup.close(),this.payTypeVal=1,this.$nextTick((function(){e.$refs.payShow.payClickShow(e.payTypeVal)})))},checkNum:function(e){var s=this,a=e.target.value,i=a.indexOf(".");a.indexOf(".")<0&&""!=a?a.length>6?(a=a.substring(0,a.length-1),t.showToast({title:s.c.TheAmountCannotExceedOneMillion,icon:"none"})):a=parseFloat(a):0==a.indexOf(".")?(a=a.replace(/[^$#$]/g,"0."),a=a.replace(/\.{2,}/g,".")):/^(\d?)+(\.\d{0,2})?$/.test(a)||(a=a.substring(0,a.length-1)),s.$nextTick((function(){s.maxLength=-1==i?7:10,s.inputPrice=a}))},diaLogClose:function(){this.$refs.customAmountPopup.close(),this.customAmountStatus=!1},diaLogOk:function(){var e=this;if(""===this.forums.set_site.site_minimum_amount){if(this.inputPrice<"0.1")return void t.showToast({title:this.i18n.t("core.TheAmountCannotBeLessThanOneYuan"),icon:"none"})}else if(this.inputPrice<this.forums.set_site.site_minimum_amount)return void t.showToast({title:this.i18n.t("core.TheAmountCannotBeLessThanMinMoney")+this.forums.set_site.site_minimum_amount+this.i18n.t("discuzq.post.yuan"),icon:"none"});this.price=Number(this.inputPrice),this.$refs.customAmountPopup.close(),this.customAmountStatus=!1,this.payShowStatus=!0,this.$nextTick((function(){e.$refs.payShow.payClickShow(e.payTypeVal)}))},contBlur:function(t){this.cursor=t.detail.cursor},getEmojiClick:function(t){var e="";e="".concat(this.textAreaValue.slice(0,this.cursor)+t+this.textAreaValue.slice(this.cursor)),this.textAreaValue=e,this.emojiShow=!1},callClick:function(){t.navigateTo({url:"/pages/user/at-member"})},uploadChange:function(t){this.uploadFile=t},uploadClear:function(t,e){var s=t.id;this.deleteType=0,this.deleteImgId=s,this.deleteIndex=e,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteImgSure")},delAttachments:function(t){var e={_jv:{type:"attachments",id:t}};return this.$store.dispatch("jv/delete",e).then((function(t){return t})).catch((function(t){console.log(t)}))},publishClick:function(){this.publishClickStatus=!1,!0===this.commentAnser?this.postAnswer():this.postComment(this.commentId)},commentJump:function(e,s){if(!this.$store.getters["session/get"]("isLogin"))return t.setStorage({key:"page",data:(0,p.getCurUrl)()}),void this.mpLoginMode();t.navigateTo({url:"/pages/topic/comment?threadId=".concat(e,"&commentId=").concat(s)})},commentLikeClick:function(e,s,a,i,o,r){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.postIndex=o,this.postOpera(e,s,a,i,r)},deleteComment:function(e,s,a,i,o){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.$refs.deletePopup.open(),this.deleteId=e,this.deleteType="3",this.deletePostCanStatus=a,this.deletePostIsStatus=i,this.deletePost=o,this.deleteTip=this.i18n.t("core.deleteCommentSure")},replyComment:function(e,s){if(!this.$store.getters["session/get"]("isLogin"))return t.setStorage({key:"page",data:(0,p.getCurUrl)()}),void this.mpLoginMode();this.thread.thread.canReply?(this.commentReply=!0,this.postIndex=s,this.commentId=e,this.$refs.commentPopup.open(),this.commentPopupStatus=!0,this.commentWorkTips=!0,this.commentText=!1,this.focusVal=!0):this.$refs.toast.show({message:this.t.noReplyPermission})},imageClick:function(){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode())},tagClick:function(e,s,a){this.$u.event.$emit("tagClick",e,s,a);var i=getCurrentPages(),o=i.indexOf(i[i.length-1]);i.length>1&&i[o-1].route&&"pages/home/index"===i[o-1].route?(t.navigateBack({delta:o}),this.setFooterIndex(0)):(t.navigateTo({url:"/pages/home/index?categoryId=".concat(e,"&searchIds=").concat(a)}),this.setFooterIndex(0))},threadLikeClick:function(e,s,a){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.postOpera(e,"1",s,a)},threadCollectionClick:function(e,s,a,i){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.threadOpera(e,s,a,i)},threadComment:function(e){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.thread.thread.canReply?(this.commentId=e,this.formData.type=1,this.$refs.commentPopup.open(),this.commentPopupStatus=!0,this.commentWorkTips=!0,this.commentText=!1,this.focusVal=!0):this.$refs.toast.show({message:this.t.noReplyPermission})},queClick:function(){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.formData.type=5,this.commentAnser=!0,this.$refs.commentPopup.open(),this.commentPopupStatus=!0,this.commentWorkTips=!1,this.commentText=!0,this.maxTextLength=49999},handleClickOk:function(){var t=this;this.$refs.deletePopup.close(),"4"===this.deleteType?this.threadOpera(this.deleteId,this.deletePostCanStatus,this.deletePostIsStatus,this.deleteType):"3"===this.deleteType?this.postOpera(this.deleteId,"3",this.deletePostCanStatus,this.deletePostIsStatus,this.deletePost):0===this.deleteType&&this.delAttachments(this.deleteImgId,this.deleteIndex).then((function(){t.$refs.upload.clear(t.deleteIndex),t.$refs.upload.getValue().forEach((function(e,s,a){e.id==t.deleteImgId&&a.splice(s,1)}))}))},handleWechatClickOk:function(){this.$refs.wechatPopup.close(),this.mpLogin()},handleWechatClickCancel:function(){this.$refs.wechatPopup.close()},handleClickCancel:function(){this.$refs.deletePopup.close()},shareClick:function(){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.$refs.sharePopup.open(),this.thread.thread.isAnonymous&&0===parseFloat(this.thread.thread.price)&&(this.shareAnonymous=!0),this.forums.set_site&&"pay"===this.forums.set_site.site_mode&&this.bottomData.forEach((function(t,e,s){"wxFriends"===t.name&&s.splice(e,1)}))},cancel:function(){this.shareAnonymous=!1,this.$refs.sharePopup.close()},shareContent:function(e){0===e&&(0==this.thread.thread.isApproved?t.showToast({icon:"none",title:this.i18n.t("topic.underReview"),duration:2e3}):t.navigateTo({url:"/pages/share/topic?id=".concat(this.threadId)})),this.cancel()},codeImgChange:function(t){t.show||clearInterval(x)},_updateLikedUsers:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.log(this.user,"this.user"),this.isLiked=e,this.isLiked?(this.likedUsers.unshift(this.user),this.thread.firstPost.likeCount+=1,this.thread.firstPost.isLiked=!0):(this.likedUsers.forEach((function(e,s,a){e.id==t.user._jv.id&&a.splice(s,1)})),this.thread.firstPost.likeCount-=1,this.thread.firstPost.isLiked=!1),this.$forceUpdate()},_updateRewardUsers:function(){1===this.payTypeVal&&(this.thread.thread.rewardedCount++,this.rewardStatus||(this.rewardStatus=!0,this.rewardBtnStatus=!0)),this.rewardedUsers.unshift(this.user),this.$forceUpdate()},onUnload:function(){clearInterval(x),clearInterval(b)},sortOperaClick:function(){this.sortSeleShow=!this.sortSeleShow},sortSelectChoice:function(e){var s=this;this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.sortSeleShow=!1,"0"===e.type?"createdAt"===this.sortVal?this.$refs.toast.show({message:this.t.itsAlreadyWantedSort}):(this.refreshVal=!1,this.$nextTick((function(){s.refreshVal=!0})),this.sortVal="createdAt",this.posts=[],this.splitLists=[],this.preThreadsPostsData=null,this.pageNum=1,this.loadThreadPosts()):"1"===e.type&&("-createdAt"===this.sortVal?this.$refs.toast.show({message:this.t.itsAlreadyWantedSort}):(this.refreshVal=!1,this.sortVal="-createdAt",this.posts=[],this.splitLists=[],this.preThreadsPostsData=null,this.pageNum=1,this.loadThreadPosts(),this.$nextTick((function(){s.refreshVal=!0}))))},addFollow:function(e){var s=this;this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode());var a=this.$store.getters["jv/get"]("users/".concat(e.id)),i={_jv:{type:"follow"},type:"user_follow",to_user_id:e.id};this.$store.dispatch("jv/post",i).then((function(t){0==t.is_mutual?(s.thread.user.follow=1,a.follow=1,s.followStatus=1):(s.thread.user.follow=2,a.follow=2,s.followStatus=2)}))},deleteFollow:function(t){var e=this,a=this.$store.getters["jv/get"]("users/".concat(t.id));this.$store.dispatch("jv/delete","follow/".concat(t.id,"/1")).then((function(){e.thread.user.follow=0,a.follow=0,e.followStatus=0})),s},moreClick:function(){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,p.getCurUrl)()}),this.mpLoginMode()),this.$refs.morePopup.open()},moreContent:function(e,s){"8"===e.type?this.thread.thread.isAnonymous&&0===parseFloat(this.thread.thread.price)&&(this.shareAnonymous=!0):this.moreCancel(),"0"===e.type?(this.$,t.redirectTo({url:"/topic/post?type=".concat(this.thread.thread.type,"&operating=edit&threadId=").concat(this.thread.thread.id,"&isredbag=").concat(this.thread.isRedPacket)})):"2"===e.type||"3"===e.type?this.threadOpera(this.threadId,e.canOpera,e.isStatus,e.type):"4"===e.type&&(this.$refs.deletePopup.open(),this.deleteType="4",this.deleteId=this.threadId,this.deletePostCanStatus=e.canOpera,this.deletePostIsStatus=e.status,this.deletePostType=e.type,this.deleteTip=this.i18n.t("core.deleteContentSure")),"report"===e.name&&this.reportClick(),"collection"===e.name&&this.threadCollectionClick(s.thread.id,s.canFavorite,s.isFavorite,"1"),"share"===e.name&&this.shareClick(),"poster"===e.name&&this.shareContent(0)},moreCancel:function(){this.shareAnonymous=!1,this.$refs.morePopup.close()},reportClose:function(t){this.$refs.reportPopup.close()},reportClick:function(){this.moreCancel(),this.$refs.reportPopup.open()},buyGood:function(){6===this.thread.thread.type&&this.copy(this.thread.postGoods.detailContent)},copy:function(e){var s=this;(0,l.default)({content:e,success:function(e){t.showToast({title:s.thread.postGoods.typeName+e,icon:"none"})},error:function(e){t.showToast({title:e,icon:"none",duration:3e3})}})},modifyPostCommentHtml:function(t){return t.forEach((function(t){t.summary=(0,f.modifyPostContentHtml)(t.summary)})),t}})};e.default=L}).call(this,a("543d")["default"])},"1f31":function(t,e,s){"use strict";var a=s("a9d3"),i=s.n(a);i.a},"292a":function(t,e,s){"use strict";s.r(e);var a=s("131d"),i=s.n(a);for(var o in a)"default"!==o&&function(t){s.d(e,t,(function(){return a[t]}))}(o);e["default"]=i.a},"4c57":function(t,e,s){"use strict";s.r(e);var a=s("c4d4"),i=s("292a");for(var o in i)"default"!==o&&function(t){s.d(e,t,(function(){return i[t]}))}(o);s("1f31");var r,n=s("f0c5"),h=Object(n["a"])(i["default"],a["b"],a["c"],!1,null,"596591b6",null,!1,a["a"],r);e["default"]=h.exports},a9d3:function(t,e,s){},c4d4:function(t,e,s){"use strict";s.d(e,"b",(function(){return i})),s.d(e,"c",(function(){return o})),s.d(e,"a",(function(){return a}));var a={quiPage:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-page/qui-page")]).then(s.bind(null,"a983"))},quiTopicContent:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-topic-content/qui-topic-content")]).then(s.bind(null,"2e9b"))},quiIcon:function(){return s.e("components/qui-icon/qui-icon").then(s.bind(null,"d13f"))},quiPersonList:function(){return s.e("components/qui-person-list/qui-person-list").then(s.bind(null,"77ee"))},quiBeAsk:function(){return s.e("components/qui-be-ask/qui-be-ask").then(s.bind(null,"b240"))},quiAnswer:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-answer/qui-answer")]).then(s.bind(null,"4f70"))},quiPaymentVisible:function(){return s.e("components/qui-payment-visible/qui-payment-visible").then(s.bind(null,"c87c"))},quiDropDown:function(){return s.e("components/qui-drop-down/qui-drop-down").then(s.bind(null,"597f"))},quiTopicComment:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-topic-comment/qui-topic-comment")]).then(s.bind(null,"f80e"))},quiLoadMore:function(){return s.e("components/qui-load-more/qui-load-more").then(s.bind(null,"3fc9"))},uniPopup:function(){return s.e("components/uni-popup/uni-popup").then(s.bind(null,"78fd"))},quiButton:function(){return s.e("components/qui-button/qui-button").then(s.bind(null,"018a"))},quiReport:function(){return s.e("components/qui-report/qui-report").then(s.bind(null,"d818"))},quiPay:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-pay/qui-pay")]).then(s.bind(null,"2751"))},quiLoadingCover:function(){return s.e("components/qui-loading-cover/qui-loading-cover").then(s.bind(null,"12a6"))},quiToast:function(){return s.e("components/qui-toast/qui-toast").then(s.bind(null,"b091"))},quiEmoji:function(){return s.e("components/qui-emoji/qui-emoji").then(s.bind(null,"0380"))},quiUploader:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-uploader/qui-uploader")]).then(s.bind(null,"bb64"))},uLoading:function(){return s.e("components/u-loading/u-loading").then(s.bind(null,"2db1"))},quiPageMessage:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-page-message/qui-page-message")]).then(s.bind(null,"84ac"))}},i=function(){var t=this,e=t.$createElement,s=(t._self._c,t.loaded&&t.answerPay?t.handleGroup(t.thread.question.beUser.groups&&t.thread.question.beUser.groups):null),a=t.loaded&&t.posts.length>0?t.__map(t.splitLists,(function(e,s){var a=t.__get_orig(e),i=t.__map(e,(function(e,s){var a=t.__get_orig(e),i=e.isDeleted?null:parseFloat(e.rewards);return{$orig:a,m1:i}}));return{$orig:a,l0:i}})):null,i=t.loaded?{contentdown:t.c.contentdown,contentrefresh:t.c.contentrefresh,contentnomore:t.contentnomoreVal}:null,o=t.loaded&&t.footerShow?t.detectionModel():null,r=t.loaded?t.i18n.t("discuzq.post.cancel"):null,n=t.loaded&&t.customAmountStatus?t.i18n.t("discuzq.close"):null,h=t.loaded&&t.customAmountStatus?t.i18n.t("discuzq.ok"):null,c=t.loaded&&t.payShowStatus?Number(t.user.walletBalance):null;t._isMounted||(t.e0=function(e){t.emojiShow=!t.emojiShow},t.e1=function(e){t.publishClickStatus&&t.publishClick()}),t.$mp.data=Object.assign({},{$root:{m0:s,l1:a,a0:i,m2:o,g0:r,g1:n,g2:h,m3:c}})},o=[]},e728:function(t,e,s){"use strict";(function(t){s("8d7e");a(s("66fd"));var e=a(s("4c57"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("543d")["createPage"])}},[["e728","common/runtime","common/vendor"]]]);