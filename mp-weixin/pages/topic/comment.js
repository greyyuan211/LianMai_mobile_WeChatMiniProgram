(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/topic/comment"],{2469:function(t,e,o){"use strict";var s=o("af43"),n=o.n(s);n.a},4408:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=o("1299"),n=o("2f62"),i=h(o("dc1b")),r=o("6c07"),a=o("0f20"),u=o("e114"),l=h(o("c939")),c=h(o("7a36")),d=o("cff7"),p=o("2ef0"),m=h(o("d654"));function h(t){return t&&t.__esModule?t:{default:t}}function f(t){return S(t)||y(t)||v(t)||g()}function g(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(t,e){if(t){if("string"===typeof t)return b(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?b(t,e):void 0}}function y(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function S(t){if(Array.isArray(t))return b(t)}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,s=new Array(e);o<e;o++)s[o]=t[o];return s}function P(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,s)}return o}function C(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?P(Object(o),!0).forEach((function(e){I(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):P(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function I(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var k=function(){o.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(o("ba2b"))}.bind(null,o)).catch(o.oe)},w={components:{uniPopupDialog:k},mixins:[i.default,l.default,c.default],data:function(){var t;return t={newContentHtml:"",navTitle:"评论详情页",threadId:"",commentId:"",thread:{},loadDetailStatus:{},loaded:!1,status:!1,loadingStatus:!0,topicStatus:0,posts:[],commentIndex:"",postComments:[],postsStatus:!1,footerShow:!0,commentShow:!1,commentPopupStatus:!1,emojiShow:!1,textAreaValue:"",barStatus:!1,uploadFile:[],publishClickStatus:!0,focusVal:!0,header:{},formData:{},placeholderColor:"color:#b5b5b5",isLiked:!1,role:"管理员",isActive:!0,seleShow:!1,selectList:[{text:"编辑",type:"0"},{text:"精华",type:"2"},{text:"置顶",type:"3"},{text:"删除",type:"4"}],limitShowNum:12,paidStatus:!1,rewardStatus:!1,likedStatus:!1,commentStatus:{}},I(t,"commentId",""),I(t,"loadingType","more"),I(t,"scrollTop",0),I(t,"pageNum",1),I(t,"pageSize",20),I(t,"contentnomoreVal",""),I(t,"url",""),I(t,"imageStatus",!0),I(t,"likedUsers",[]),I(t,"deleteId",""),I(t,"deleteType",""),I(t,"deletePostType",""),I(t,"deletePostCanStatus",""),I(t,"deletePostIsStatus",""),I(t,"deletePost",""),I(t,"deleteIndex",""),I(t,"deleteTip","确定删除吗？"),I(t,"deleteImgId",""),I(t,"sortSeleShow",!1),I(t,"sortSelectList",[{text:this.i18n.t("topic.sortTimeSequence"),type:"0",canOpera:!0},{text:this.i18n.t("topic.sortTimeReverse"),type:"1",canOpera:!0}]),I(t,"sortVal","createdAt"),I(t,"followStatus",""),I(t,"themeParts",1),I(t,"replyCommentType","0"),I(t,"commentPostId",""),I(t,"commentUserId",""),I(t,"commentUser",{}),t},computed:C(C({},(0,n.mapState)({getAtMemberData:function(t){return t.atMember.atMemberData}})),{},{currentLoginId:function(){var t=this.$store.getters["session/get"]("userId");return parseInt(t,10)},post:function(){var t=this.$store.getters["jv/get"]("posts/".concat(this.commentId));this.newContentHtml=(0,d.modifyPostContentHtml)(t.contentHtml);var e=!1;return t.user&&t.user.groups.length>0&&(t.user.groups=t.user.groups.filter((function(t){if(!0===t.isDisplay&&!e)return e=!0,!0}))),this.likedUsers=t.likedUsers,t},t:function(){return this.i18n.t("topic")},c:function(){return this.i18n.t("core")},localTime:function(){if(this.thread.createdAt)return(0,r.time2DateAndHM)(this.thread.createdAt?this.thread.createdAt:"")}}),onLoad:function(e){this.threadId=e.threadId,this.commentId=e.commentId,this.loadPost(),this.loadThread(),this.loadPostComments(),this.url=a.DISCUZ_REQUEST_HOST;var o=t.getStorageSync("access_token");this.header={authorization:"Bearer ".concat(o)},this.formData={type:1}},onPullDownRefresh:function(){var e=this;e.pageNum=1,e.postComments=[],setTimeout((function(){e.loadPost(),e.loadThread(),e.loadPostComments(),t.stopPullDownRefresh()}),1e3)},onReachBottom:function(){"more"===this.loadingType&&(this.pageNum+=1,this.loadPostComments())},onPageScroll:function(t){this.scrollTop=t.scrollTop},onUnload:function(){this.$store.dispatch("forum/setError",{loading:!1})},onShow:function(){var t="";this.getAtMemberData.map((function(e){return t+="@".concat(e.username," "),t})),this.textAreaValue="".concat(this.textAreaValue.slice(0,this.cursor)+t+this.textAreaValue.slice(this.cursor)),this.setAtMember([])},methods:C(C({},(0,n.mapMutations)({setAtMember:"atMember/SET_ATMEMBER"})),{},{touchStop:function(){},commentJump:function(){},onShareAppMessage:function(t){if("button"===t.from){var e=this.$store.getters["jv/get"]("/threads/".concat(this.threadId));return{title:1===e.type?e.title:e.firstPost.summaryText,path:"/topic/index?id=".concat(this.threadId)}}return{title:1===threadShare.type?threadShare.title:threadShare.firstPost.summaryText,path:"/topic/index?id=".concat(this.threadId)}},onShareTimeline:function(){return{title:this.forums.set_site.site_name,query:""}},loadPost:function(){var t=this,e={include:["user","user.groups","likedUsers","commentPosts","commentPosts.user","commentPosts.user.groups","commentPosts.replyUser","commentPosts.replyUser.groups","commentPosts.mentionUsers","commentPosts.images","images","attachments"]};this.loadPostStatus=s.status.run((function(){return t.$store.dispatch("jv/get",["posts/"+t.commentId,{params:e}]).then((function(e){e.isDeleted?(t.$store.dispatch("forum/setError",{code:"TYPE_404",status:500}),t.loaded=!1):t.loaded=!0,t.loadingStatus=!1})).catch((function(e){t.loaded=!1,t.loadingStatus=!1,404===e.statusCode&&t.$store.dispatch("forum/setError",{code:"type_404",status:500})}))}))},loadThread:function(){var t=this,e={"filter[isDeleted]":"no",include:["user.groups","user","firstPost"]};this.loadDetailStatus=s.status.run((function(){return t.$store.dispatch("jv/get",["threads/"+t.threadId,{params:e}]).then((function(e){e.isDeleted?(t.$store.dispatch("forum/setError",{code:"thread_deleted",status:500}),t.status=!1):t.status=!0;var o=!1;e.user&&e.user.groups.length>0&&(e.user.groups=e.user.groups.filter((function(t){if(!0===t.isDisplay&&!o)return o=!0,!0}))),t.thread=e,t.loadingStatus=!1})).catch((function(e){t.status=!1,t.loadingStatus=!1,404===e.statusCode&&t.$store.dispatch("forum/setError",{code:"type_404",status:500})}))}))},postOpera:function(e,o,s,n,i){var r=this;if("1"!=o||s)if("4"!=o||s){var a={type:"posts",id:e},u={};"1"==o?u={pid:parseInt(e),data:{attributes:{isLiked:!n}}}:"2"==o||"3"==o?u={_jv:a,isDeleted:!n}:"4"==o&&(u={pid:parseInt(e),data:{attributes:{isLiked:!n}}}),"1"==o||"4"==o?m.default.updatePosts({data:u}).then((function(t){if("1"==o){var s=r.$store.getters["jv/get"]("posts/".concat(e));r.isLiked=t.Data.isLiked,r.isLiked?(r.likedUsers.unshift(r.user),s.likeCount=s.likeCount+=1,s._jv.relationships.likedUsers.data.unshift({type:r.user._jv.type,id:r.user._jv.id})):(s.likeCount=s.likeCount-=1,r.likedUsers.forEach((function(t,e,o){t.id==r.user.id&&o.splice(e,1)})),s._jv.relationships.likedUsers.data.forEach((function(t,e,o){t.id==r.user.id&&o.splice(e,1)}))),s.isLiked=t.Data.isLiked}else if("4"==o){var n=i;n.isLiked=t.Data.isLiked,n.likeCount=t.Data.likeCount,i=n,t.Data.isLiked}})).catch((function(t){console.log(t)})):this.$store.dispatch("jv/patch",u).then((function(e){if("2"==o)e.isDeleted?(t.navigateBack({delta:1}),r.$refs.toast.show({message:r.t.deleteSuccessAndJumpToTopic})):r.$refs.toast.show({message:r.t.deleteFailed});else if("3"==o){var s=i;s.isDeleted=e.isDeleted,i=s;var n=r.$store.getters["jv/get"]("posts/".concat(r.commentId));n.replyCount-=1,e.isDeleted?(r.$u.event.$emit("deleteComment",{data:e,commentId:r.commentId}),r.$refs.toast.show({message:r.t.deleteSuccess})):r.$refs.toast.show({message:r.t.deleteFailed})}})).catch((function(t){console.log(t)}))}else this.$refs.toast.show({message:this.t.noCommentLikePermission});else this.$refs.toast.show({message:this.t.noReplyLikePermission})},postComment:function(){var t=this;if(this.textAreaValue.length<1)return this.$refs.toast.show({message:this.t.replyContentCannotBeEmpty}),this.publishClickStatus=!0,!1;var e={id:parseInt(this.threadId),content:this.textAreaValue,replyId:this.commentId,isComment:!0};"0"===this.replyCommentType||"1"===this.replyCommentType&&(e.commentPostId=this.commentPostId,e.commentUserId=this.commentUserId),e.attachments=[],this.uploadFile&&this.uploadFile.forEach((function(t){e.attachments.push({type:"attachments",id:t.id})})),m.default.createPosts({data:e}).then((function(e){if("操作太频繁了，请稍后再试"===e.Message)return t.$refs.commentPopup.close(),t.publishClickStatus=!0,t.textAreaValue="",void(t.uploadFile="");if(1==e.Data.isApproved){var o=!1;e.Data.user.groups=e.Data.user.groups.filter((function(t){return!0===t.isDisplay&&!o&&(o=!0,!0)})),e.contentHtml=(0,d.modifyPostContentHtml)(e.Data.contentHtml),t.postComments.push(e.Data),t.$u.event.$emit("addComment",{data:e.Data,commentId:t.commentId})}else t.$refs.toast.show({message:t.t.publishExamineTip});t.$refs.commentPopup.close(),t.commentPopupStatus=!1,t.publishClickStatus=!0;var s=t.$store.getters["jv/get"]("posts/".concat(t.commentId));s.replyCount+=1,t.textAreaValue="",t.uploadFile=""})).catch((function(e){t.publishClickStatus=!0,console.log(e)}))},loadPostComments:function(){var t=this,e={"filter[isApproved]":1,"filter[thread]":this.threadId,"page[number]":this.pageNum,"page[limit]":this.pageSize,"filter[isDeleted]":"no","filter[isComment]":"yes","filter[reply]":this.commentId,include:["replyUser","commentUser","user.groups","user","images"],sort:this.sortVal};this.loadPostCommentStatus=s.status.run((function(){return t.$store.dispatch("jv/get",["posts",{params:e}]).then((function(e){delete e._jv,e.forEach((function(t,o){var s=!1;e[o].user.groups=e[o].user.groups.filter((function(t){return!0===t.isDisplay&&!s&&(s=!0,!0)})),t.contentHtml=(0,d.modifyPostContentHtml)(t.contentHtml)})),t.postComments=[].concat(f(t.postComments),f(e)),t.loadingType=e.length===t.pageSize?"more":"nomore",0==e.length?t.contentnomoreVal=t.t.noComment:t.contentnomoreVal=t.t.noMoreData,t.postsStatus=!0}))}))},limitArray:function(t){var e=[];return Object.values(t).forEach((function(t){e.push(t)})),e},addFollow:function(e){var o=this;this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,u.getCurUrl)()}),this.mpLoginMode());var s=this.$store.getters["jv/get"]("users/".concat(e.id)),n={_jv:{type:"follow"},type:"user_follow",to_user_id:e.id};this.$store.dispatch("jv/post",n).then((function(t){0==t.is_mutual?(o.post.user.follow=1,s.follow=1,o.followStatus=1):(o.post.user.follow=2,s.follow=2,o.followStatus=2)}))},deleteFollow:function(t){var e=this,o=this.$store.getters["jv/get"]("users/".concat(t.id));this.$store.dispatch("jv/delete","follow/".concat(t.id,"/1")).then((function(){e.post.user.follow=0,o.follow=0,e.followStatus=0}))},sortOperaClick:function(){this.sortSeleShow=!this.sortSeleShow},sortSelectChoice:function(e){var o=this;this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,u.getCurUrl)()}),this.mpLoginMode()),this.sortSeleShow=!1,"0"===e.type?"createdAt"===this.sortVal?this.$refs.toast.show({message:this.t.itsAlreadyWantedSort}):(this.refreshVal=!1,this.$nextTick((function(){o.refreshVal=!0})),this.sortVal="createdAt",this.postComments=[],this.loadPostComments()):"1"===e.type&&("-createdAt"===this.sortVal?this.$refs.toast.show({message:this.t.itsAlreadyWantedSort}):(this.refreshVal=!1,this.sortVal="-createdAt",this.postComments=[],this.loadPostComments(),this.$nextTick((function(){o.refreshVal=!0}))))},personJump:function(e){e<=0||t.navigateTo({url:"/pages/profile/index?userId=".concat(e)})},contBlur:function(t){this.cursor=t.detail.cursor},getEmojiClick:function(t){var e="";e="".concat(this.textAreaValue.slice(0,this.cursor)+t+this.textAreaValue.slice(this.cursor)),this.textAreaValue=e,this.emojiShow=!1},expressionClick:function(){this.emojiShow=!this.emojiShow},callClick:function(){t.navigateTo({url:"/pages/user/at-member"})},uploadChange:function(t){this.uploadFile=t},uploadClear:function(t,e){var o=t.id;this.deleteType=0,this.deleteImgId=o,this.deleteIndex=e,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteImgSure")},delAttachments:function(t){var e={_jv:{type:"attachments",id:t}};return this.$store.dispatch("jv/delete",e).then((function(t){return t})).catch((function(t){console.log(t)}))},publishClick:function(){this.publishClickStatus=!1,this.postComment(this.commentId)},postLikeClick:function(t,e,o,s){this.postOpera(t,e,o,s)},deleteReply:function(t,e){this.$refs.deletePopup.open(),this.deleteType="2",this.deleteId=t,this.deleteTip=this.i18n.t("core.deleteCommentSure")},deleteComment:function(t,e,o,s,n){this.$refs.deletePopup.open(),this.deleteId=t,this.deleteType="3",this.deletePostCanStatus=o,this.deletePostIsStatus=s,this.deletePost=n,this.deleteTip=this.i18n.t("core.deleteReplySure")},handleClickOk:function(){var t=this;this.$refs.deletePopup.close(),"2"===this.deleteType?this.postOpera(this.deleteId,"2"):"3"===this.deleteType?this.postOpera(this.deleteId,"3",this.deletePostCanStatus,this.deletePostIsStatus,this.deletePost):0===this.deleteType&&this.delAttachments(this.deleteImgId,this.deleteIndex).then((function(){t.$refs.upload.clear(t.deleteIndex),t.$refs.upload.getValue().forEach((function(e,o,s){e.id==t.deleteImgId&&s.splice(o,1)}))}))},handleClickCancel:function(){this.$refs.deletePopup.close()},replyComment:function(t,e,o,s){e?(this.replyCommentType=o,this.commentUserId=s,this.commentPostId=t,this.$refs.commentPopup.open(),this.commentPopupStatus=!0):this.$refs.toast.show({message:this.t.noReplyPermission})},contentClick:function(){var e=getCurrentPages(),o=e.indexOf(e[e.length-1]);"pages/topic/index"===(0,p.get)(e,"[".concat(o-1,"].route"))?t.navigateBack({delta:1}):t.navigateTo({url:"/topic/index?id=".concat(this.threadId)})},commentLikeClick:function(t,e,o,s,n,i){this.commentIndex=n,this.postOpera(t,"4",o,s,i)},imageError:function(){this.imageStatus=!1},moreClick:function(){this.$store.getters["session/get"]("isLogin")||(t.setStorage({key:"page",data:(0,u.getCurUrl)()}),this.mpLoginMode()),this.$refs.morePopup.open()},moreContent:function(t,e,o){this.moreCancel(),0===t?this.deleteReply(e,o):this.reportClick()},moreCancel:function(){this.$refs.morePopup.close()},reportClose:function(t){this.$refs.reportPopup.close()},reportClick:function(){this.$refs.reportPopup.open()}})};e.default=w}).call(this,o("543d")["default"])},"9fa1":function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return i})),o.d(e,"a",(function(){return s}));var s={quiPage:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-page/qui-page")]).then(o.bind(null,"a983"))},quiTopicContent:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-topic-content/qui-topic-content")]).then(o.bind(null,"2e9b"))},quiIcon:function(){return o.e("components/qui-icon/qui-icon").then(o.bind(null,"d13f"))},quiAvatar:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-avatar/qui-avatar")]).then(o.bind(null,"7a5a"))},quiUparse:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-uparse/qui-uparse")]).then(o.bind(null,"11a7"))},quiPersonList:function(){return o.e("components/qui-person-list/qui-person-list").then(o.bind(null,"77ee"))},quiDropDown:function(){return o.e("components/qui-drop-down/qui-drop-down").then(o.bind(null,"597f"))},quiTopicComment:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-topic-comment/qui-topic-comment")]).then(o.bind(null,"f80e"))},quiLoadMore:function(){return o.e("components/qui-load-more/qui-load-more").then(o.bind(null,"3fc9"))},quiToast:function(){return o.e("components/qui-toast/qui-toast").then(o.bind(null,"b091"))},uniPopup:function(){return o.e("components/uni-popup/uni-popup").then(o.bind(null,"78fd"))},quiEmoji:function(){return o.e("components/qui-emoji/qui-emoji").then(o.bind(null,"0380"))},quiUploader:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-uploader/qui-uploader")]).then(o.bind(null,"bb64"))},quiReport:function(){return o.e("components/qui-report/qui-report").then(o.bind(null,"d818"))},uLoading:function(){return o.e("components/u-loading/u-loading").then(o.bind(null,"2db1"))},quiPageMessage:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-page-message/qui-page-message")]).then(o.bind(null,"84ac"))}},n=function(){var t=this,e=t.$createElement,o=(t._self._c,t.loaded&&t.status&&t.status?{contentdown:t.c.contentdown,contentrefresh:t.c.contentrefresh,contentnomore:t.contentnomoreVal}:null),s=t.loaded&&t.status?t.i18n.t("report.reportTitle"):null;t.$mp.data=Object.assign({},{$root:{a0:o,g0:s}})},i=[]},adf9:function(t,e,o){"use strict";o.r(e);var s=o("9fa1"),n=o("bbe6");for(var i in n)"default"!==i&&function(t){o.d(e,t,(function(){return n[t]}))}(i);o("2469");var r,a=o("f0c5"),u=Object(a["a"])(n["default"],s["b"],s["c"],!1,null,"11167596",null,!1,s["a"],r);e["default"]=u.exports},af43:function(t,e,o){},bbe6:function(t,e,o){"use strict";o.r(e);var s=o("4408"),n=o.n(s);for(var i in s)"default"!==i&&function(t){o.d(e,t,(function(){return s[t]}))}(i);e["default"]=n.a},d429:function(t,e,o){"use strict";(function(t){o("8d7e");s(o("66fd"));var e=s(o("adf9"));function s(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])}},[["d429","common/runtime","common/vendor"]]]);