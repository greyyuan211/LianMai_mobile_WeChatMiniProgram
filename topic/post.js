(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["topic/post"],{1573:function(t,e,i){"use strict";i.r(e);var s=i("9e48"),a=i.n(s);for(var o in s)"default"!==o&&function(t){i.d(e,t,(function(){return s[t]}))}(o);e["default"]=a.a},"5d85":function(t,e,i){"use strict";(function(t){i("8d7e");s(i("66fd"));var e=s(i("8a58"));function s(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},7773:function(t,e,i){},"8a58":function(t,e,i){"use strict";i.r(e);var s=i("a9d6"),a=i("1573");for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);i("b3b8");var r,n=i("f0c5"),c=Object(n["a"])(a["default"],s["b"],s["c"],!1,null,"cada9d6e",null,!1,s["a"],r);e["default"]=c.exports},"9e48":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=h(i("a34a")),a=i("2f62"),o=i("0f20"),r=h(i("7a36")),n=h(i("dc1b")),c=h(i("c939")),u=h(i("d654"));function h(t){return t&&t.__esModule?t:{default:t}}function d(t,e,i,s,a,o,r){try{var n=t[o](r),c=n.value}catch(u){return void i(u)}n.done?e(c):Promise.resolve(c).then(s,a)}function p(t){return function(){var e=this,i=arguments;return new Promise((function(s,a){var o=t.apply(e,i);function r(t){d(o,s,a,r,n,"next",t)}function n(t){d(o,s,a,r,n,"throw",t)}r(void 0)}))}}function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function m(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){f(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var y=function(){i.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(i("ba2b"))}.bind(null,i)).catch(i.oe)},g=null,_=null,v={name:"Post",components:{uniPopupDialog:y},mixins:[r.default,n.default,c.default],data:function(){return{lowestPrice:0,redbagplay:!0,geographical_location:!1,anonymity_show:!1,redshow:!1,save:!1,SecondaryClassification:"",titlexune:"已添加0个标题",secondallcategories:[],is_onlookers:!1,two_categoryId:"",situation_categoryId:"",is_red_packet:"",showmoney:"",rule:"",money:"",number:"",condition:"",likenum:"",sumtype:"",timer1:null,timer2:null,cansavedraft:!0,currentId:"",vditor:null,navTitle:"发布",loadStatus:"",textAreaValue:"",markdownShow:!1,barStatus:!1,textAreaLength:5e3,textAnswerLength:49999,postTitle:"",checkClassData:[],type:0,price:0,priceAsk:0,pwdVal:"",browser:0,inputPrice:"",maxLength:7,inputWord:"",operating:"",emojiShow:!1,textShow:!0,header:{},formData:{},captcha:null,captcha_ticket:"",captcha_rand_str:"",userImage:"",beUserName:"",checked:!1,watchChecked:!1,watchShow:!1,payShowStatus:!0,haveDate:0,answerIsDate:0,platformDate:0,askingPrice:!0,payNum:[{name:this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"),pay:0},{name:"￥2",pay:2},{name:"￥5",pay:5},{name:"￥10",pay:10},{name:"￥20",pay:20},{name:"￥50",pay:50},{name:"￥88",pay:88},{name:"￥128",pay:128},{name:this.i18n.t("discuzq.post.customize"),pay:0}],payNumCheck:[{name:"",pay:0}],freepercentage:[{name:"0%",pay:0},{name:"10%",pay:.1},{name:"30%",pay:.3},{name:"50%",pay:.5},{name:"70%",pay:.7},{name:"100%",pay:1}],freewords:[],percentagedisplay:"0%",uploadFile:[],cursor:0,wordCountCheck:[{name:this.i18n.t("discuzq.post.word",{num:0}),num:0}],word:0,setType:"pay",controlsStatus:!1,videoBeforeList:[],audioBeforeList:[],fullscreenStatus:!1,videoName:"",percent:0,fileId:"",url:"",postLoading:!1,allCategories:[],categoryIndex:"",categoryId:"",threadId:"",firstPostId:"",postDetails:{},filePreview:[],uploadStatus:!0,showHidden:!0,ticket:"",randstr:"",captchaResult:{},attachmentList:[],signatureVal:"",deleteType:"",deleteId:"",deleteIndex:"",deleteTip:"确定删除吗？",wechatTip:this.i18n.t("discuzq.wechatBind"),currentPosition:{},watchMoeny:"1",beAskId:"",payTypeText:"",orderSn:"",coverLoading:!1,payStatus:!1,payTypeData:[{name:"微信支付",icon:"icon-wxPay",color:"#09bb07",value:"0"},{name:"钱包支付",icon:"icon-walletPay",color:"#1878f3",value:"1"}],chooseType:1,payType:0,showPayType:"",ioshide:!1,isShowGoods:!0,dataGoodInfo:{},dataGoodInfoPrice:0,goodsId:"",categoryid:0,categoryindex:0,postShow:!1,popupStatus:!1,canUploadAttachment:!1}},computed:m(m({},(0,a.mapState)({getAtMemberData:function(t){return t.atMember.atMemberData}})),{},{showPrice:function(){var t="";return t=1===this.type?this.i18n.t("discuzq.post.pleaseChoice"):this.i18n.t("discuzq.post.free"),t=this.price<=0?1===this.type?this.i18n.t("discuzq.post.pleaseChoice"):this.i18n.t("discuzq.post.free"):"￥".concat(this.price+this.i18n.t("discuzq.post.yuan")),t},showAskPrice:function(){var t=this.i18n.t("discuzq.post.free");return t=this.priceAsk<=0?this.i18n.t("discuzq.post.free"):"￥".concat(this.priceAsk+this.i18n.t("discuzq.post.yuan")),t},currentLoginId:function(){var t=this.$store.getters["session/get"]("userId");return parseInt(t,10)}}),beforeDestroy:function(){this.save=!0,clearInterval(this.timer1),this.timer1=null,clearInterval(this.timer2),this.timer2=null},updated:function(){var e=this;this.red_bagshow(),this.geographical_location_show(),this.forums&&5===this.type&&(this.platformDate=(this.forums.set_site.site_onlooker_price*(this.forums.set_site.site_master_scale/10)).toFixed(2),this.haveDate=((this.forums.set_site.site_onlooker_price-this.platformDate)/2).toFixed(2),this.answerIsDate=(this.forums.set_site.site_onlooker_price-this.platformDate-this.haveDate).toFixed(2)),t.$off("uploadVideoOver"),t.$on("uploadVideoOver",(function(t){e.percent=1,t.doneResult?e.fileId=t.doneResult.fileId:t.result&&(e.fileId=t.result.fileId),e.videoBeforeList.push({path:t.uploadVideoRes.tempFilePath})}))},methods:m(m({red_bagshow:function(){0===this.type&&this.forums.other.can_create_thread_red_packet&&(this.redshow=!0),1===this.type&&this.forums.other.can_create_thread_long_red_packet&&(this.redshow=!0)},geographical_location_show:function(){switch(0===this.type&&this.forums.other.can_create_thread_position&&(this.geographical_location=!0),1===this.type&&this.forums.other.can_create_thread_long_position&&(this.geographical_location=!0),2===this.type&&this.forums.other.can_create_thread_video_position&&(this.geographical_location=!0),3===this.type&&this.forums.other.can_create_thread_image_position&&(this.geographical_location=!0),4===this.type&&this.forums.other.can_create_thread_audio_position&&(this.geographical_location=!0),5===this.type&&this.forums.other.can_create_thread_question_position&&(this.geographical_location=!0),6===this.type&&this.forums.other.can_create_thread_goods_position&&(this.geographical_location=!0),this.type){case 0:this.anonymity_show=this.forums.other.can_create_thread_anonymous;break;case 1:this.anonymity_show=this.forums.other.can_create_thread_long_anonymous;break;case 2:this.anonymity_show=this.forums.other.can_create_thread_video_anonymous;break;case 3:this.anonymity_show=this.forums.other.can_create_thread_image_anonymous;break;case 4:this.anonymity_show=this.forums.other.can_create_thread_audio_anonymous;break;case 5:this.anonymity_show=this.forums.other.can_create_thread_question_anonymous;break;default:this.anonymity_show=this.forums.other.can_create_thread_goods_anonymous}},toDraftsing:function(){var t=this;if(!1!==this.redbagplay){if(0===this.textAreaValue.length)return this.$refs.toast.show({message:this.i18n.t("草稿不能为空")});if(!this.categoryId&&!this.two_categoryId)return this.$refs.toast.show({message:this.i18n.t("未选择分类")});this.save=!0,clearInterval(this.timer2),this.timer2=null;var e={categoriesId:Number(this.two_categoryId||this.categoryId),content:this.textAreaValue,type:this.type,isAnonymous:this.checked?1:0,price:this.price,freeWords:this.word,id:this.currentId,isDraft:1,isOldDraft:0,captchaTicket:this.ticket,captchaRandStr:this.randstr,redPacket:{rule:+this.rule,money:+this.money,number:+this.number,condition:+this.condition,likenum:+this.likenum,orderId:this.orderSn,orderPrice:0}};1===this.payType?(e.attachmentPrice=this.price,e.price=""):0===this.payType&&(e.attachmentPrice="",e.price=this.price);var i=this.currentPosition;i&&(e.longitude=Number(i.longitude)||"",e.latitude=Number(i.latitude)||"",e.location=i.location||"",e.address=i.address||"");var s=new Promise((function(i,s){switch(t.type){case 0:i();break;case 1:var a=t.addImg().data.concat(t.addFile().data);e.attachments=[],a.forEach((function(t){e.attachments.push({id:Number(t.id),type:t.type})})),i();break;case 2:e.fileId=t.fileId,e.fileName=t.videoName,i();break;case 3:var o=t.addImg().data;e.attachments=[],o.forEach((function(t){e.attachments.push({id:Number(t.id),type:t.type})})),i();break;case 4:e.fileId=t.audioBeforeList[0].id,e.fileName=t.audioBeforeList[0].fileName,i();break;case 5:var r=t.addImg().data,n=t.addQuestion().data;e.attachments=[],e.question={},r.forEach((function(t){e.attachments.push({id:Number(t.id),type:t.type})})),n&&(e.question.type=n.type,e.question.price=Number(n.price),e.question.orderId=n.order_id,e.question.isOnlooker=n.is_onlooker,e.question.beUserId=n.be_user_id),i();break;case 6:e.postGoodsId=Number(t.dataGoodInfo._jv.id),i();break;default:s(),t.$refs.toast.show({message:t.i18n.t("core.postTypesDoNotMatch")})}}));s.then((function(){u.default.createThread({data:e}).then((function(e){t.save=!1,t.currentId||(t.currentId=e.Data.id),t.$refs.toast.show({message:t.i18n.t("保存成功")})}))}))}},toDrafts:function(){var t=this;this.save=!0;var e={categoriesId:Number(this.two_categoryId||this.categoryId),content:this.textAreaValue,type:this.type,isAnonymous:this.checked?1:0,price:this.price,freeWords:this.word,id:this.currentId,isDraft:1,isOldDraft:0,captchaTicket:this.ticket,captchaRandStr:this.randstr,redPacket:{rule:+this.rule,money:+this.money,number:+this.number,condition:+this.condition,likenum:+this.likenum,orderId:this.orderSn,orderPrice:0}};1===this.payType?(e.attachmentPrice=this.price,e.price=""):0===this.payType&&(e.attachmentPrice="",e.price=this.price);var i=this.currentPosition;i&&(e.longitude=Number(i.longitude)||"",e.latitude=Number(i.latitude)||"",e.location=i.location||"",e.address=i.address||"");var s=new Promise((function(i,s){switch(t.type){case 0:i();break;case 1:var a=t.addImg().data.concat(t.addFile().data);e.attachments=[],a.forEach((function(t){e.attachments.push({id:Number(t.id),type:t.type})})),i();break;case 2:e.fileId=t.fileId,e.fileName=t.videoName,i();break;case 3:var o=t.addImg().data;e.attachments=[],o.forEach((function(t){e.attachments.push({id:Number(t.id),type:t.type})})),i();break;case 4:e.fileId=t.audioBeforeList[0].id,e.fileName=t.audioBeforeList[0].fileName,i();break;case 5:var r=t.addImg().data,n=t.addQuestion().data;e.attachments=[],e.question={},r.forEach((function(t){e.attachments.push({id:Number(t.id),type:t.type})})),n&&(e.question.type=n.type,e.question.price=Number(n.price),e.question.orderId=n.order_id,e.question.isOnlooker=n.is_onlooker,e.question.beUserId=n.be_user_id),i();break;case 6:e.postGoodsId=Number(t.dataGoodInfo._jv.id),i();break;default:s(),t.$refs.toast.show({message:t.i18n.t("core.postTypesDoNotMatch")})}}));s.then((function(){u.default.createThread({data:e}).then((function(e){t.save=!1,t.currentId||(t.currentId=e.Data.id)}))}))},onStartSave:function(){var t=this;this.timer1=setInterval((function(){t.categoryId&&0!==t.textAreaValue.length&&(t.startSave(),clearInterval(t.timer1),t.timer1=null)}),1e4)},startSave:function(){var t=this;this.timer2=setInterval((function(){t.save||t.toDrafts()}),12e4)},addGoods:function(){if("edit"===this.operating)t.redirectTo({url:"/pages/topic/parse-goods?type=".concat(this.type,"&operating=edit&threadId=").concat(this.threadId)});else{try{t.setStorageSync("add_goods_text",this.textAreaValue||"")}catch(e){}t.redirectTo({url:"/pages/topic/parse-goods?type=".concat(this.type,"&isSaveText=1")})}},deleteGoods:function(){this.dataGoodInfo=[],this.isShowGoods=!1},changeCheck:function(){},choosePosition:function(){var e=this;e.currentPosition.location||t.getSetting({success:function(i){i.authSetting["scope.userLocation"]?t.chooseLocation({success:function(t){var i=t;i.location=t.name,e.currentPosition=i}}):t.authorize({scope:"scope.userLocation",success:function(){t.chooseLocation({success:function(t){var i=t;i.location=t.name,e.currentPosition=i}})}})}})},clearPosition:function(){this.currentPosition={}},addthetheme:function(){t.navigateTo({url:"/pagesplay_web/AddTheTheme"})},skipred_packet:function(){!1!==this.redbagplay&&t.navigateTo({url:"/pagesplay_web/compile-money"})},clearPacket:function(){this.is_red_packet="",this.showmoney="",this.rule="",this.money="",this.number="",this.condition="",this.likenum="",this.sumtype=""},saveThread:function(){var e=this;t.removeStorageSync("current_thread"),1===this.type&&(this.textAreaValue=this.vditor.getValue());var i={},s=["postTitle","price","word","fileId","videoName","textAreaValue","categoryIndex","categoryId","checkClassData","uploadFile","videoBeforeList","audioBeforeList","checked","watchChecked","askingPrice","watchShow","priceAsk","beAskId","userImage","beUserName","type","showHidden","payType","showPayType","ioshide","dataGoodInfo"];if(s.forEach((function(t){e[t]&&(i[t]=e[t])})),this.$refs.uploadFiles){var a=this.$refs.uploadFiles.getValue(),o=[];a.forEach((function(t){o.push({fileName:t.attributes.fileName,url:t.attributes.url,_jv:{id:t.id}})})),i.attachmentList=o}if(this.$refs.upload){var r=this.$refs.upload.getValue();r.forEach((function(t,e){t.attributes&&(r[e]={path:t.attributes.thumbUrl,id:t.id,order:t.attributes.order,name:t.attributes.fileName,url:t.attributes.url})})),i.imgList=r}t.setStorageSync("current_thread",JSON.stringify(i))},setThread:function(){var e=this,i=t.getStorageSync("current_thread");i&&(i=JSON.parse(i),this.dataGoodInfo=i.dataGoodInfo,Object.getOwnPropertyNames(i).forEach((function(t){if("imgList"===t){var s=i[t];s.forEach((function(t,e){s[e]={thumbUrl:t.path,_jv:{id:t.id},order:t.order,fileName:t.name,url:t.url}}));var a={firstPost:{images:[]}};a.firstPost.images=i[t],e.setAnnex("img",a)}else e[t]=i[t]})),this.videoBeforeList.length>0&&(this.percent=1),t.removeStorageSync("current_thread"))},focusEvent:function(){},toolBarClick:function(t){var e="";"bold"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"**粗体文字**").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=2,this.focusEvent(this.cursor)):"italic"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"__").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=1,this.focusEvent(this.cursor)):"title"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"\n### ").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=4,this.focusEvent(this.cursor)):"quote"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"\n> ").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=1,this.focusEvent(this.cursor)):"link"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"[](url)").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=1,this.focusEvent(this.cursor)):"code"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"``").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=1,this.focusEvent(this.cursor)):"strikethrough"===t&&(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"~~~~").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=2,this.focusEvent(this.cursor)),this.textAreaValue=e}},(0,a.mapMutations)({setAtMember:"atMember/SET_ATMEMBER"})),{},{checkNum:function(e){var i=this,s=e.target.value,a=s.indexOf(".");s.indexOf(".")<0&&""!=s?s.length>6?(s=s.substring(0,s.length-1),t.showToast({title:i.c.TheAmountCannotExceedOneMillion,icon:"none"})):s=parseFloat(s):0==s.indexOf(".")?(s=s.replace(/[^$#$]/g,"0."),s=s.replace(/\.{2,}/g,".")):/^(\d?)+(\.\d{0,2})?$/.test(s)||(s=s.substring(0,s.length-1)),i.$nextTick((function(){i.maxLength=-1==a?7:10,i.inputPrice=s}))},videoDel:function(){this.deleteType=2,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteVideoSure")},playVideo:function(t){},fullscreenchange:function(t){this.fullscreenStatus=t.detail.fullScreen,t.detail.fullScreen||(this.controlsStatus=!1,this.videoContext.pause())},emojiclick:function(){this.emojiShow=!this.emojiShow,this.textShow=!this.textShow},contBlur:function(t){this.cursor=t.detail.cursor},diaLogClose:function(){this.$refs.popup.close(),this.popupStatus=!1,this.textShow=!0},diaLogOk:function(){if(""===this.forums.set_site.site_minimum_amount){if(this.inputPrice<"0.1")return void t.showToast({title:this.i18n.t("core.TheAmountCannotBeLessThanOneYuan"),icon:"none"})}else if(this.inputPrice<this.forums.set_site.site_minimum_amount)return void t.showToast({title:this.i18n.t("core.TheAmountCannotBeLessThanMinMoney")+this.forums.set_site.site_minimum_amount+this.i18n.t("discuzq.post.yuan"),icon:"none"});if(5===this.type)return this.priceAsk=this.inputPrice,this.$refs.popup.close(),this.popupStatus=!1,this.textShow=!0,void this.postClick();"pay"===this.setType?this.price=this.inputPrice:this.word=this.inputWord,this.$refs.popup.close(),this.popupStatus=!1,this.textShow=!0},percentageClick:function(t){this.word=this.freepercentage[t].pay,this.percentagedisplay=this.freepercentage[t].name,this.setType="word",this.freewords=[],this.freewords.push(this.freepercentage[t]),this.$refs.popupBtm.close()},moneyClick:function(t){var e=this;if(0===this.forums.set_site.site_onlooker_price&&(this.watchShow=!1),0===t){if(5===this.type)return this.watchShow=!1,void this.postClick();1!==this.type&&5!==this.type&&(this.payType=0,0===this.payType&&(this.showPayType=this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree")))}else this.watchShow=!0;if(this.setType="pay",this.payNumCheck=[],this.payNumCheck.push(this.payNum[t]),this.payNumCheck[0].name===this.i18n.t("discuzq.post.customize"))this.textShow=!1,this.$refs.popupBtm.close(),this.popupStatus=!0,this.$nextTick((function(){e.inputPrice="",e.$refs.popup.open(),e.textShow=!1}));else{if(5===this.type&&0!==t)return this.priceAsk=this.payNumCheck[0].pay,this.$refs.popupBtm.close(),this.postClick(),void(this.textShow=!0);this.price=this.payNumCheck[0].pay,this.$refs.popupBtm.close(),this.textShow=!0}},lookPay:function(){this.$refs.lookPayPopup.open()},cancelLookPay:function(){this.$refs.lookPayPopup.close()},choicePayType:function(t){0===t?(this.payNumCheck=[],this.price="",this.showPayType=this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree")):1===t?(this.payNumCheck=[],this.showPayType=this.i18n.t("discuzq.post.TheContentIsFreeAndTheAccessoriesArePaid"),this.payNum[0].name="￥1",this.payNum[0].pay=1):(this.payNumCheck=[],this.payNum[0].name="￥1",this.showPayType=this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsPaid"),this.payNum[0].pay=1),this.payType=t,this.$refs.lookPayPopup.close()},cellClick:function(t){this.setType=t,this.$refs.popupBtm.open(),this.textShow=!1},postAnswerClick:function(t){this.$refs.popupBtm.open(),this.textShow=!1},cancel:function(){this.$refs.popupBtm.close(),this.textShow=!0},uploadClick:function(t){this.uploadStatus=t},uploadChange:function(t,e){this.uploadFile=t,this.uploadStatus=e},uploadClear:function(t,e){var i=t.id;this.deleteType=0,this.deleteId=i,this.deleteIndex=e,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteImgSure")},uploadAudioChange:function(t){this.audioBeforeList=t},audioDel:function(){this.deleteType=3,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteAudioSure")},getEmojiClick:function(t){var e="";e="".concat(this.textAreaValue.slice(0,this.cursor)+t+this.textAreaValue.slice(this.cursor)),this.cursor=e.length,this.textAreaValue=e,this.emojiShow=!1,this.textShow=!0},callClick:function(){t.navigateTo({url:"/pages/user/at-member"})},topicPage:function(){t.navigateTo({url:"/pages/topic/topic"})},checkClass:function(t,e,i){this.two_categoryId="",this.checkClassData=[],+this.categoryId!=+i?(this.categoryId=i,this.checkClassData.push(t),this.secondallcategories=t.children||[]):this.categoryId=""},checkClassing:function(t,e,i){+this.two_categoryId!=+i?this.two_categoryId=i:this.two_categoryId=""},payClickShow:function(){var t=this;if(this.$store.getters["session/get"]("isLogin")||this.mpLoginMode(),this.payStatus=!1,this.forums.paycenter.wxpay_close){if(!this.forums.paycenter.wxpay_close||!this.forums.other.can_create_thread_paid)return this.ioshide=!1,void(this.payShowStatus=!1);if("ios"===this.system)return this.postShow=!0,this.payShowStatus=!1,void(this.ioshide=!1);this.ioshide=!0,this.payShowStatus=!0,this.payTypeText=this.t.pay+this.t.payAskingPrice,this.priceAsk=parseFloat(this.thread.price),this.$nextTick((function(){t.$refs.payShow.payClickShow(t.payTypeVal)}))}else this.payShowStatus=!1},paysureShow:function(e){if(t.setStorage({key:"page",data:"/topic/post?type=5&categoryId=".concat(this.categoryid,"&categoryIndex=").concat(this.categoryindex)}),0===e){if(void 0===this.user.wechat||this.user.wechat&&""===this.user.wechat.min_openid)return void this.$refs.wechatPopup.open();1===this.is_red_packet||"1"===this.is_red_packet?(0===this.type&&this.creatOrder(this.money,20,"",e),1===this.type&&this.creatOrder(this.money,21,"",e)):this.creatOrder(this.priceAsk,5,"",e)}},onInput:function(t){this.value=t,1===this.is_red_packet||"1"===this.is_red_packet?(0===this.type&&this.creatOrder(this.money,20,t,1),1===this.type&&this.creatOrder(this.money,21,t,1)):this.creatOrder(this.priceAsk,5,t,1)},creatOrder:function(t,e,i,s){var a=this,o={_jv:{type:"orders"},type:e,payee_id:this.beAskId,amount:t,is_anonymous:this.checked?"0":"1"};this.$store.dispatch("jv/post",o).then((function(t){a.orderSn=t.order_sn,0===s?0==a.browser?a.orderPay(13,i,a.orderSn,s,"0"):a.isWeixin&&a.isPhone?a.orderPay(12,i,a.orderSn,s,"1"):a.isPhone?a.orderPay(20,i,a.orderSn,1,"2"):a.orderPay(10,i,a.orderSn,s,"3"):1===s&&a.orderPay(20,i,a.orderSn,s)})).catch((function(t){console.log(t)}))},orderPay:function(e,i,s,a,o){var r=this,n={};0===a?n={_jv:{type:"trade/pay/order/".concat(s)},payment_type:e}:1===a&&(n={_jv:{type:"trade/pay/order/".concat(s)},payment_type:e,pay_password:i}),this.$store.dispatch("jv/post",n).then((function(e){r.wxRes=e,0===a?"0"===o?r.wechatPay(e.wechat_js.timeStamp,e.wechat_js.nonceStr,e.wechat_js.package,e.wechat_js.signType,e.wechat_js.paySign):"1"===o?"undefined"===typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",r.onBridgeReady(e),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",r.onBridgeReady(e)),document.attachEvent("onWeixinJSBridgeReady",r.onBridgeReady(e))):r.onBridgeReady(e):"2"===o?r.postThread().then((function(i){r.postLoading=!1,t.hideLoading(),i&&1===i.isApproved&&r.$u.event.$emit("refreshHome",e),i&&i.Data&&i.Data.id&&t.redirectTo({url:"/topic/index?id=".concat(i.Data.id)})})):"3"===o&&e&&(r.codeUrl=e.wechat_qrcode,r.payShowStatus=!1,r.$refs.codePopup.open(),r.qrcodeShow=!0,g=setInterval((function(){1!==r.payStatus?(r.getOrderStatus(r.orderSn,o),t.hideLoading()):clearInterval(g)}),3e3)):1===a&&("success"===e.wallet_pay.result&&(r.$store.dispatch("jv/get",["users/".concat(r.currentLoginId),{}]),r.coverLoading=!1,r.postThread().then((function(e){r.postLoading=!1,t.hideLoading(),e&&1===e.isApproved&&r.$u.event.$emit("refreshHome",e),e&&e.Data&&e.Data.id&&t.redirectTo({url:"/topic/index?id=".concat(e.Data.id)})}))),r.coverLoading=!1)})).catch((function(t){console.log(t),r.$refs.payShow.clearPassword()}))},getOrderStatus:function(e,i){var s=this;this.$store.dispatch("jv/get",["orders/".concat(e),{custom:{loading:!1}}]).then((function(e){s.payStatus=e.status,1===s.payStatus&&("2"===i||("3"===i?(s.$refs.codePopup.close(),s.qrcodeShow=!1,s.postThread()):("0"===i||"1"===i)&&s.postThread().then((function(e){s.postLoading=!1,t.hideLoading(),e&&1===e.isApproved&&s.$u.event.$emit("refreshHome",e),e&&e.Data&&e.Data.id&&t.redirectTo({url:"/topic/index?id=".concat(e.Data.id)})}))),s.$refs.toast.show({message:s.i18n.t("pay.paySuccess")}))})).catch((function(t){console.log(t),s.coverLoading=!1,s.$refs.toast.show({message:s.i18n.t("pay.payFail")})}))},wechatPay:function(e,i,s,a,o){var r=this;t.requestPayment({provider:"wxpay",timeStamp:e,nonceStr:i,package:s,signType:a,paySign:o,success:function(t){r.coverLoading=!0,g=setInterval((function(){1!==r.payStatus?r.getOrderStatus(r.orderSn,"0"):clearInterval(g)}),3e3)},fail:function(t){r.payShowStatus=!1,r.coverLoading=!1,r.$refs.toast.show({message:r.p.payFail})}})},onBridgeReady:function(t){var e=this;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.wechat_js.appId,timeStamp:t.wechat_js.timeStamp,nonceStr:t.wechat_js.nonceStr,package:t.wechat_js.package,signType:"MD5",paySign:t.wechat_js.paySign},(function(t){"get_brand_wcpay_request:ok"==t.err_msg||("get_brand_wcpay_request:cancel"==t.err_msg||"get_brand_wcpay_request:fail"==t.err_msg)&&(clearInterval(g),resolve)})),g=setInterval((function(){1!==e.payStatus?e.getOrderStatus(e.orderSn,"1"):clearInterval(g)}),3e3)},radioChange:function(t){},postClick:function(){var e=this;if(this.payTypeText=this.i18n.t("topic.pay")+this.i18n.t("discuzq.post.payAskingPrice"),1===this.type&&this.vditor&&(this.textAreaValue=this.vditor.getValue().replace(/blob\:/g,"").replace(/\n\n/g,"\n\n\n")),!this.categoryId&&!this.two_categoryId)return this.$refs.toast.show({message:this.i18n.t("discuzq.post.theclassifyCanNotBeBlank")}),!1;var i=!0;switch(this.type){case 0:this.textAreaValue.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theContentCanNotBeBlank")}),i=!1):i=!0;break;case 1:this.postTitle.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theTitleCanNotBeBlank")}),i=!1):this.textAreaValue.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theContentCanNotBeBlank")}),i=!1):this.uploadStatus?1===this.payType?0===this.$refs.uploadFiles.getValue().length?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.attachmentCannotBeEmpty")}),i=!1):0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),i=!1):i=!0:2===this.payType&&0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),i=!1):i=!0:(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseWaitForTheImageUploadToComplete")}),i=!1);break;case 2:this.videoBeforeList.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.videoCannotBeEmpty")}),i=!1):1!==this.percent?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseWaitForTheVideoUploadToComplete")}),i=!1):2===this.payType&&0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),i=!1):i=!0;break;case 3:"edit"!==this.operating||"draft"===this.operating?this.uploadStatus?this.uploadFile.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.imageCannotBeEmpty")}),i=!1):2===this.payType&&0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),i=!1):i=!0:(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseWaitForTheImageUploadToComplete")}),i=!1):this.uploadStatus?2===this.payType&&0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),i=!1):i=!0:(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseWaitForTheImageUploadToComplete")}),i=!1);break;case 4:this.audioBeforeList.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.audioCannotBeEmpty")}),i=!1):i=!0;break;case 5:""===this.beAskId?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseSelectTheUserToBeAsked")}),i=!1):this.textAreaValue.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theContentCanNotBeBlank")}),i=!1):this.watchShow&&(this.payShowStatus=!0,this.$nextTick((function(){e.$refs.payShow.payClickShow()})));break;case 6:""===this.dataGoodInfo||0===this.dataGoodInfo.length?(this.$refs.toast.show({message:this.i18n.t("core.productInformationDoesNotExist")}),i=!1):i=!0;break;default:i=!1,this.$refs.toast.show({message:this.i18n.t("core.postTypesDoNotMatch")})}if(i)if(this.save=!0,clearInterval(this.timer1),this.timer1=null,clearInterval(this.timer2),this.timer2=null,5!==this.type&&(this.postLoading=!0),"edit"===this.operating)3===this.type&&this.uploadFile.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.imageCannotBeEmpty")}),t.hideLoading(),this.postLoading=!1):this.editThread().then((function(i){e.postLoading=!1,t.hideLoading(),i&&e.threadId&&t.redirectTo({url:"/topic/index?id=".concat(e.threadId)})}));else{if(this.forums.qcloud.qcloud_captcha&&this.forums.other.create_thread_with_captcha&&(!this.ticket||!this.randstr))return this.toTCaptcha(),!1;this.watchShow&&5===this.type||(1===this.is_red_packet||"1"===this.is_red_packet?this.$nextTick((function(){e.$refs.payShowtwo.payClickShow()})):this.postThread().then((function(i){e.postLoading=!1,t.hideLoading(),i&&1===i.isApproved&&e.$u.event.$emit("refreshHome",i),i&&i.Data&&i.Data.id&&t.redirectTo({url:"/topic/index?id=".concat(i.Data.id)})})))}},setAnnex:function(t,e){switch(t){case"img":var i=[];e.firstPost.images.map((function(t){return i.push({path:t.thumbUrl,id:t._jv.id,order:t.order,name:t.fileName,url:t.url}),t})),this.filePreview=i;break;case"video":this.videoBeforeList.push({path:e.threadVideo.media_url});break;case"audio":this.audioBeforeList.push({fileName:e.threadAudio.file_name,url:e.threadAudio.media_url,id:e.threadAudio.file_id});break;case"goods":this.dataGoodInfo=e.firstPost.postGoods,-1!==e.firstPost.postGoods.price.indexOf("-")||Number(e.firstPost.postGoods.price)>0?this.dataGoodInfoPrice=e.firstPost.postGoods.price:Number(e.firstPost.postGoods.price)<=0&&(this.dataGoodInfoPrice="");break;default:break}},addImg:function(){var t={data:[]};return this.uploadFile.forEach((function(e){e&&t.data.push({type:"attachments",id:e.id})})),t},addFile:function(){var t={data:[]},e=this.$refs.uploadFiles.getValue();return e.forEach((function(e){e.id&&t.data.push({type:"attachments",id:e.id})})),t},addQuestion:function(){var t={data:{be_user_id:this.beAskId,price:this.priceAsk,is_onlooker:this.watchChecked,order_id:this.orderSn,type:1}};return t},deleteFile:function(t){this.deleteTip=this.i18n.t("core.deleteEnclosureSure"),this.$refs.deletePopup.open(),this.deleteType=1,this.deleteId=t},deleteFileSure:function(t){var e=this,i={_jv:{type:"attachments",id:t}};this.$store.dispatch("jv/delete",i).then((function(t){e.$refs.uploadFiles.deleteSure()}))},getCategories:function(){var t=this;return p(s.default.mark((function e(){return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("jv/get",["categories?filter[createThread]=1",{}]).then((function(e){t.allCategories=e,""===t.categoryId&&t.checkClass(e[0],0),e.map((function(e){return e._jv&&Number(e._jv.id)===Number(t.categoryId)&&t.checkClassData.push(e),e}))}));case 2:t.categoryId&&t.initCategoryId(t.categoryId);case 3:case"end":return e.stop()}}),e)})))()},initCategoryId:function(t){var e=this;this.allCategories.forEach((function(i){i._jv.id==t?(e.categoryId=t,e.two_categoryId=""):i.children&&i.children.forEach((function(s){s.id==t&&(e.secondallcategories=i.children,e.categoryId=Number(i._jv.id),e.two_categoryId=t)}))}))},postThread:function(){var t=this,e={categoriesId:Number(this.two_categoryId||this.categoryId),content:this.textAreaValue,type:this.type,isAnonymous:this.checked?1:0,price:Number(this.price),freeWords:this.word,id:this.currentId,isDraft:0,isOldDraft:this.currentId?1:0,captchaTicket:this.ticket,captchaRandStr:this.randstr,redPacket:{rule:+this.rule,money:+this.money,number:+this.number,condition:+this.condition,likenum:+this.likenum,orderId:this.orderSn,orderPrice:0}};1===this.payType?(e.attachmentPrice=this.price,e.price=0):0===this.payType&&(e.attachmentPrice="",e.price=Number(this.price));var i=this.currentPosition;i&&(e.longitude=Number(i.longitude)||"",e.latitude=Number(i.latitude)||"",e.location=i.location||"",e.address=i.address||"");var s=new Promise((function(i,s){switch(t.type){case 0:i();break;case 1:e.title=t.postTitle;var a=t.addImg().data.concat(t.addFile().data);e.attachments=[],a.map((function(t){e.attachments.push({id:Number(t.id),type:t.type})})),i();break;case 2:e.fileId=t.fileId,e.fileName=t.videoName,i();break;case 3:var o=t.addImg().data;e.attachments=[],o.map((function(t){e.attachments.push({id:Number(t.id),type:t.type})})),i();break;case 4:e.fileId=t.audioBeforeList[0].id,e.fileName=t.audioBeforeList[0].fileName,i();break;case 5:var r=t.addImg().data,n=t.addQuestion().data;e.attachments=[],e.question={},r.map((function(t){e.attachments.push({id:Number(t.id),type:t.type})})),n&&(e.question.type=n.type,e.question.price=Number(n.price),e.question.orderId=n.order_id,e.question.isOnlooker=n.is_onlooker,e.question.beUserId=n.be_user_id),i();break;case 6:e.postGoodsId=Number(t.dataGoodInfo._jv.id),i();break;default:s(),t.$refs.toast.show({message:t.i18n.t("core.postTypesDoNotMatch")})}}));return this.save=!0,clearInterval(this.timer1),this.timer1=null,clearInterval(this.timer2),this.timer2=null,s.then((function(){return u.default.createThread({data:e}).then((function(t){return t})).catch((function(t){console.log(t)}))}))},delAttachments:function(t,e){if("edit"===this.operating){this.$u.event.$emit("deleteImg",{threadId:this.postDetails._jv.id,index:e});var i=this.$store.getters["jv/get"]("posts/".concat(this.postDetails.firstPost._jv.id));i.images.splice(e,1),i._jv.relationships.images.data.splice(e,1)}},handleClickOk:function(){this.$refs.deletePopup.close(),0===this.deleteType?(this.delAttachments(this.deleteId,this.deleteIndex),this.$refs.upload.clear(this.deleteIndex)):2===this.deleteType?(this.videoBeforeList=[],this.percent=0):3===this.deleteType&&(this.audioBeforeList=[])},handleClickCancel:function(){this.$refs.deletePopup.close()},handleWechatClickOk:function(){this.mpLogin()},handleWechatClickCancel:function(){this.$refs.wechatPopup.close()},getSignature:function(t){this.$store.dispatch("jv/get",["signature",{}]).then((function(e){t(e.signature)}))},postVideo:function(t){var e={_jv:{type:"thread/video"},file_id:t,type:0};this.$store.dispatch("jv/post",e)},getPostThread:function(t){var e=this,i={include:["firstPost","firstPost.images","threadVideo","threadAudio","category","firstPost.attachments","question","onlookers","question.beUser","question.images","firstPost.postGoods"]};this.$store.dispatch("jv/get",["threads/".concat(this.threadId),{params:i}]).then((function(i){switch(e.is_red_packet=i.isRedPacket,i.question&&(e.beUserName=i.question.beUser.username,e.beAskId=i.question.beUser.id,e.userImage=i.question.beUser.avatarUrl),e.postDetails=i,e.firstPostId=i.firstPost._jv.id,e.type=i.type,e.markdownShow=!1,e.attachmentList=i.firstPost.attachments||[],e.textAreaValue=i.firstPost.parseContentHtml,e.categoryId=i.category._jv.id,e.initCategoryId(e.categoryId),e.checkClassData.push(i.category),i.threadVideo&&(e.fileId=i.threadVideo.file_id,e.percent=1),e.checked=i.isAnonymous,5===e.type&&(e.watchChecked=i.question.is_onlooker),i.firstPost.images&&i.firstPost.images.forEach((function(t){t&&e.uploadFile.push({type:"attachments",id:t._jv.id,order:t.order,name:t.fileName,url:t.url,path:t.thumbUrl?t.thumbUrl:""})})),6===e.type&&i.firstPost.postGoods&&(e.dataGoodInfo=i.firstPost.postGoods,-1!==i.firstPost.postGoods.price.indexOf("-")||Number(i.firstPost.postGoods.price)>0?e.dataGoodInfoPrice=i.firstPost.postGoods.price:Number(i.firstPost.postGoods.price)<=0&&(e.dataGoodInfoPrice=""),e.isShowGoods=!0),e.loadStatus=!0,Number(i.price)>0?(e.price=i.price,e.word=i.freeWords,e.freepercentage.forEach((function(t){i.freeWords===t.pay&&(e.percentagedisplay=t.name)})),e.payType=2,e.showPayType=e.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsPaid"),1===e.type&&(e.payNum[0].name="￥1",e.payNum[0].pay=1)):Number(i.attachmentPrice)>0?(e.price=i.attachmentPrice,e.payType=1,e.showPayType=e.i18n.t("discuzq.post.TheContentIsFreeAndTheAccessoriesArePaid"),e.payNum[0].name="￥1",e.payNum[0].pay=1):e.showPayType=e.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"),e.textAreaLength=1===e.type?49999:5e3,Number(i.type)){case 0:break;case 1:e.postTitle=i.title,e.setAnnex("img",i);break;case 2:e.percent=1,e.setAnnex("video",i);break;case 3:e.setAnnex("img",i);break;case 4:e.setAnnex("audio",i);break;case 5:e.setAnnex("img",i);break;case 6:e.setAnnex("goods",i);break;default:}if(t.name){var s={},a=t.latng.split(",");s.longitude=a[1],s.latitude=a[0],s.location=t.name,s.address=t.addr,e.currentPosition=s}else e.currentPosition.longitude=i.longitude||"",e.currentPosition.latitude=i.latitude||"",e.currentPosition.location=i.location||"",e.currentPosition.address=i.address||"";"edit"===e.operating&&e.goodsId&&e.getGoodsInfo(),e.setThread()}))},getGoodsInfo:function(){var t=this;this.$store.dispatch("jv/get","goods/".concat(this.goodsId)).then((function(e){t.dataGoodInfo=e,-1!==e.price.indexOf("-")||Number(e.price)>0?t.dataGoodInfoPrice=e.price:Number(e.price)<=0&&(t.dataGoodInfoPrice=""),t.isShowGoods=!0}))},editThread:function(){var t=this;return p(s.default.mark((function e(){var i,a,o,r,n,c,h;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=0,a={pid:Number(t.firstPostId),data:{attributes:{content:t.textAreaValue,is_old_draft:1},relationships:{attachments:{data:[]}},id:Number(t.threadId)}},o={categoriesId:Number(t.two_categoryId||t.categoryId),id:Number(t.threadId),isOldDraft:1,content:t.textAreaValue,type:t.type},r=t.currentPosition,o.longitude=Number(r.longitude)||"",o.latitude=Number(r.latitude)||"",o.location=r.location||"",o.address=r.address||"",e.t0=t.type,e.next=0===e.t0?11:1===e.t0?12:2===e.t0?18:3===e.t0?22:4===e.t0?27:5===e.t0?31:6===e.t0?36:38;break;case 11:return e.abrupt("break",39);case 12:return o.title=t.postTitle,1===t.payType?(o.attachmentPrice=t.price,o.price=0):2===t.payType?(o.attachmentPrice="",o.price=Number(t.price)):0===t.payType&&(o.attachmentPrice=0,o.price=0),n=t.addImg().data.concat(t.addFile().data),a.data.relationships.attachments.data=[],n.forEach((function(t){a.data.relationships.attachments.data.push({id:Number(t.id),type:t.type})})),e.abrupt("break",39);case 18:return o.fileId=t.fileId,o.fileName=t.videoName,o.price=t.price,e.abrupt("break",39);case 22:return o.price=t.price,c=t.addImg().data,a.data.relationships.attachments.data=[],c.forEach((function(t){a.data.relationships.attachments.data.push({id:Number(t.id),type:t.type})})),e.abrupt("break",39);case 27:return o.price=t.price,o.fileId=t.audioBeforeList[0].id,o.fileName=t.audioBeforeList[0].fileName,e.abrupt("break",39);case 31:return h=t.addImg().data,a.data.relationships.attachments.data=[],h.forEach((function(t){a.data.relationships.attachments.data.push({id:Number(t.id),type:t.type})})),params._jv.relationships.question=t.addQuestion(),e.abrupt("break",39);case 36:return a.postGoodsId=t.dataGoodInfo._jv.id,e.abrupt("break",39);case 38:return e.abrupt("break",39);case 39:return e.next=41,u.default.updatePosts({data:a}).then((function(t){return t.Data.pid&&(i+=1),t}));case 41:return e.next=43,u.default.updateThreads({data:o}).then((function(t){t.Data.id&&(i+=1)}));case 43:if(2!==i){e.next=45;break}return e.abrupt("return",i);case 45:throw new Error("出错了");case 46:case"end":return e.stop()}}),e)})))()},toTCaptcha:function(){var e=this;wx.navigateToMiniProgram({appId:"wx5a3a7366fd07e119",path:"/pages/captcha/index",envVersion:"release",extraData:{appId:this.forums.qcloud.qcloud_captcha_app_id},success:function(t){e.payShowStatus=!0},fail:function(i){t.hideLoading(),e.postLoading=!1,e.payShowStatus=!1}})},changeAvatar:function(){var e=this;t.setStorage({key:"edit_content",data:e.textAreaValue}),t.navigateTo({url:"/pages/user/at-member?name=select"})}}),onLoad:function(e){var i=this;if("1"===e.isSaveText)try{var s=t.getStorageSync("add_goods_text");s&&(this.textAreaValue=s)}catch(d){}"edit"===e.operating&&(this.cansavedraft=!1,this.redbagplay=!1),this.currentId=e.threadId,1==e.isredbag&&this.$store.dispatch("jv/get",["redpacket/".concat(e.threadId),{}]).then((function(t){i.is_red_packet=e.isredbag,i.money=t.money,i.showmoney=t.money,i.number=t.number,i.condition=t.condition,i.likenum=t.likenum,i.rule=t.rule,"1"===i.rule||1===i.rule?i.sumtype="随机":(i.sumtype="固定",i.showmoney=i.money/i.number)}),(function(t){return console.log(t)})),"5"===e.type&&(t.getStorage({key:"edit_content",success:function(t){i.textAreaValue=t.data}}),this.payNum[0].name=this.i18n.t("discuzq.post.noReward")),this.categoryid=e.categoryId,this.categoryindex=e.categoryIndex,t.$on("radioChange",(function(t){i.beUserName=t.username,i.beAskId=t.id,i.userImage=t.avatarUrl})),this.forums&&this.forums.other&&(this.canUploadAttachment=this.forums.other.can_upload_attachments),this.forums&&this.forums.paycenter&&("edit"!==e.operating&&this.forums.paycenter.wxpay_close?this.showPayType=this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"):this.askingPrice=!1),e.type&&(this.type=Number(e.type));var a=t.getSystemInfoSync();"ios"===a.platform&&5===this.type&&(this.askingPrice=!1),this.url=o.DISCUZ_REQUEST_HOST;var r=t.getStorageSync("access_token");if(this.header={authorization:"Bearer ".concat(r)},this.formData={type:1},this.getCategories(),e.operating&&(this.operating=e.operating),e.threadId&&(this.threadId=e.threadId),e.categoryIndex&&("0"===e.categoryIndex?this.categoryIndex="":this.categoryIndex=Number(e.categoryIndex)),e.categoryId&&(this.categoryId=0===Number(e.categoryId)?"":Number(e.categoryId)),this.textAreaLength=1===Number(e.type)?49999:5e3,"edit"===this.operating||"draft"===this.operating)this.loadStatus=!1,this.getPostThread(e);else if(this.loadStatus=!0,e.name){var n={},c=e.latng.split(",");n.longitude=c[1],n.latitude=c[0],n.location=e.name,n.address=e.addr,this.currentPosition=n}try{var u=t.getSystemInfoSync();this.forums&&this.forums.paycenter.wxpay_close&&this.forums.other.can_create_thread_paid?"ios"===u.platform?this.ioshide=!1:(this.ioshide=!0,this.showHidden=!0):(this.ioshide=!1,this.showHidden=!1)}catch(d){}if(this.markdownShow=!1,this.$u.event.$on("captchaResult",(function(t){i.ticket=t.ticket,i.randstr=t.randstr,i.postClick()})),this.$u.event.$on("closeChaReault",(function(){i.postLoading=!1,i.payShowStatus=!1,t.hideLoading()})),t.$on("clickTopic",(function(t){t.keywords&&(i.textAreaValue="".concat(i.textAreaValue.slice(0,i.cursor),"  #").concat(t.keywords.replace(/\s+/g,""),"#").concat(i.textAreaValue.slice(i.cursor),"  ")),i.cursor=i.textAreaValue?i.textAreaValue.length:0})),6===this.type&&(this.goodsId=e.goodsId),(6===this.type&&"edit"!==e.operating&&""!==e.threadId&&this.goodsId||6===this.type&&this.goodsId)&&this.getGoodsInfo(),2===this.type||3===this.type){var h=this.getOpenerEventChannel();h.on("acceptDataFromOpenerPage",(function(t){3===i.type&&(t.map((function(t){i.uploadFile.push({type:"attachments",id:t.data.id,order:t.data.attributes.order,name:t.data.attributes.fileName,url:t.data.attributes.url,path:t.data.attributes.thumbUrl?t.data.attributes.thumbUrl:""}),i.filePreview.push({path:t.data.attributes.thumbUrl,id:t.data.id,order:t.data.attributes.order,name:t.data.attributes.fileName,url:t.data.attributes.url})})),i.addImg()),2===i.type&&t.data&&(t.data.doneResult?i.fileId=t.data.doneResult.fileId:i.fileId=t.data.result.fileId,i.videoBeforeList.push({path:t.data.uploadVideoRes.tempFilePath}),i.chooseType=0,i.percent=1)}))}e.fromdrafts&&(this.operating="")},onShow:function(){var e=this,i="";this.getAtMemberData.map((function(t){return i+="@".concat(t.username," "),i})),this.textAreaValue="".concat(this.textAreaValue.slice(0,this.cursor)+i+this.textAreaValue.slice(this.cursor)),this.setAtMember([]),this.cursor=this.textAreaValue?this.textAreaValue.length:0,this.threadId||this.setThread(),t.getStorage({key:"is_red_packet",success:function(t){e.is_red_packet=t.data}}),t.getStorage({key:"rule",success:function(t){e.rule=t.data}}),t.getStorage({key:"money",success:function(t){e.money=t.data,e.showmoney=t.data}}),t.getStorage({key:"number",success:function(t){e.number=t.data}}),t.getStorage({key:"condition",success:function(t){e.condition=t.data}}),t.getStorage({key:"likenum",success:function(t){e.likenum=t.data,"1"===e.rule||1===e.rule?e.sumtype="随机":(e.sumtype="固定",e.money=e.money*e.number)}})},onReady:function(){this.videoContext=t.createVideoContext("video")},onUnload:function(){this.$u.event.$off("captchaResult"),this.$u.event.$off("closeChaReault"),this.$u.event.$off("radioChange"),this.$u.event.$off("radioEditChange"),this.captcha&&this.captcha.destroy(),clearInterval(g),clearInterval(_),t.removeStorage({key:"is_red_packet",success:function(t){}}),t.removeStorage({key:"rule",success:function(t){}}),t.removeStorage({key:"money",success:function(t){}}),t.removeStorage({key:"number",success:function(t){}}),t.removeStorage({key:"condition",success:function(t){}}),t.removeStorage({key:"likenum",success:function(t){}}),t.removeStorage({key:"edit_content",success:function(t){}}),this.save=!0,clearInterval(this.timer1),this.timer1=null,clearInterval(this.timer2),this.timer2=null},mounted:function(){this.cansavedraft&&this.onStartSave(),this.red_bagshow(),this.geographical_location_show()}};e.default=v}).call(this,i("543d")["default"])},a9d6:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return s}));var s={quiPage:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-page/qui-page")]).then(i.bind(null,"a983"))},quiCellItem:function(){return i.e("components/qui-cell-item/qui-cell-item").then(i.bind(null,"60f4"))},quiAvatar:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-avatar/qui-avatar")]).then(i.bind(null,"7a5a"))},quiIcon:function(){return i.e("components/qui-icon/qui-icon").then(i.bind(null,"d13f"))},quiEmoji:function(){return i.e("components/qui-emoji/qui-emoji").then(i.bind(null,"0380"))},quiUploader:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-uploader/qui-uploader")]).then(i.bind(null,"bb64"))},quiUploadFile:function(){return i.e("components/qui-upload-file/qui-upload-file").then(i.bind(null,"9494"))},quiUploadVideo:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-upload-video/qui-upload-video")]).then(i.bind(null,"7933"))},quiUploadAudio:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-upload-audio/qui-upload-audio")]).then(i.bind(null,"3eed"))},uSwitch:function(){return i.e("components/u-switch/u-switch").then(i.bind(null,"d6cc"))},quiButton:function(){return i.e("components/qui-button/qui-button").then(i.bind(null,"018a"))},quiPay:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-pay/qui-pay")]).then(i.bind(null,"2751"))},uniPopup:function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,"78fd"))},quiToast:function(){return i.e("components/qui-toast/qui-toast").then(i.bind(null,"b091"))},quiLoadingCover:function(){return i.e("components/qui-loading-cover/qui-loading-cover").then(i.bind(null,"12a6"))}},a=function(){var t=this,e=t.$createElement,i=(t._self._c,t.loadStatus&&1===t.type&&1===t.type?t.i18n.t("discuzq.post.pleaseEnterAPostTitle"):null),s=t.loadStatus&&5===t.type&&5===t.type?t.i18n.t("discuzq.post.askedUsers"):null,a=t.loadStatus&&5!==t.type&&t.textAreaValue.length<=t.textAreaLength?t.i18n.t("discuzq.post.note",{num:t.textAreaLength-t.textAreaValue.length}):null,o=!t.loadStatus||5===t.type||t.textAreaValue.length<=t.textAreaLength?null:t.i18n.t("discuzq.post.exceed",{num:t.textAreaValue.length-t.textAreaLength}),r=t.loadStatus&&5===t.type&&t.textAreaValue.length<=t.textAreaLength?t.i18n.t("discuzq.post.note",{num:t.textAreaLength-t.textAreaValue.length}):null,n=!t.loadStatus||5!==t.type||t.textAreaValue.length<=t.textAreaLength?null:t.i18n.t("discuzq.post.exceed",{num:t.textAreaValue.length-t.textAreaLength}),c=t.loadStatus&&5!==t.type?t.i18n.t("discuzq.post.placeholder"):null,u=t.loadStatus&&5===t.type?t.i18n.t("discuzq.post.placeholderQuestion"):null,h=t.loadStatus&&1===t.type&&t.forums.other&&t.forums.other.can_create_thread_paid&&t.ioshide?t.i18n.t("discuzq.post.lookPay"):null,d=t.loadStatus&&1===t.type&&0!==t.type&&t.showHidden&&t.forums.paycenter&&t.forums.paycenter.wxpay_close&&0!==t.payType&&t.forums.other.can_create_thread_paid&&t.ioshide?t.i18n.t("discuzq.post.paymentAmount"):null,p=t.loadStatus&&1!==t.type&&0!==t.type&&5!==t.type&&6!==t.type&&t.forums.other.can_create_thread_paid&&t.ioshide&&0!==t.type&&t.showHidden&&t.forums.paycenter.wxpay_close&&t.forums.other.can_create_thread_paid&&t.ioshide&&4===t.type?t.i18n.t("discuzq.post.payByListeningToAudio"):null,l=t.loadStatus&&1!==t.type&&0!==t.type&&5!==t.type&&6!==t.type&&t.forums.other.can_create_thread_paid&&t.ioshide&&0!==t.type&&t.showHidden&&t.forums.paycenter.wxpay_close&&t.forums.other.can_create_thread_paid&&t.ioshide&&4!==t.type?t.i18n.t("discuzq.post.paymentAmount"):null,m=t.loadStatus&&t.anonymity_show&&"edit"!==t.operating?t.i18n.t("discuzq.post.anonymity"):null,f=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?t.i18n.t("discuzq.post.otherPay"):null,y=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?parseInt(t.haveDate):null,g=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker&&0!==y?t.i18n.t("discuzq.post.youHaveTo"):null,_=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker&&0!==y?t.i18n.t("discuzq.post.yuan"):null,v=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?parseInt(t.answerIsDate):null,b=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker&&0!==v?t.i18n.t("discuzq.post.theAnswerIs"):null,w=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker&&0!==v?t.i18n.t("discuzq.post.yuan"):null,k=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?parseInt(t.platformDate):null,S=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker&&0!==k?t.i18n.t("discuzq.post.platform"):null,I=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker&&0!==k?t.i18n.t("discuzq.post.yuan"):null,T=t.loadStatus&&t.price>0&&3!==t.type&&2!==t.type&&0!==t.type&&4!==t.type&&5!==t.type&&1!==t.payType&&0!==t.payType?t.i18n.t("discuzq.post.freeWordCount"):null,P=t.loadStatus&&t.price>0&&3!==t.type&&2!==t.type&&0!==t.type&&4!==t.type&&5!==t.type&&1!==t.payType&&0!==t.payType?t.i18n.t("discuzq.post.word",{num:t.percentagedisplay}):null,x=!(t.loadStatus&&t.forums.lbs&&t.forums.lbs.lbs&&t.geographical_location)||t.currentPosition&&t.currentPosition.location?null:t.i18n.t("discuzq.post.addPosition"),q=t.loadStatus?t.i18n.t("discuzq.post.chooseCategory"):null,A=Number(t.categoryId),N=Number(t.categoryId),C=Number(t.categoryId),$=t.loadStatus?t.__map(t.allCategories,(function(e,i){var s=t.__get_orig(e),a=Number(e._jv.id),o=Number(e._jv.id),r=Number(e._jv.id);return{$orig:s,m3:a,m5:o,m7:r}})):null,z=Number(t.two_categoryId),L=Number(t.two_categoryId),V=Number(t.two_categoryId),j=t.loadStatus&&""!=t.secondallcategories?t.__map(t.secondallcategories,(function(e,i){var s=t.__get_orig(e),a=Number(e.id),o=Number(e.id),r=Number(e.id);return{$orig:s,m9:a,m11:o,m13:r}})):null,B=t.loadStatus&&(5!==t.type||5===t.type&&t.forums.other&&!1===t.forums.other.can_create_thread_paid)?t.i18n.t("discuzq.post.post"):null,D=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_create_thread_paid?t.i18n.t("discuzq.post.nextPay"):null,O=t.loadStatus&&t.payShowStatus?Number(t.user.walletBalance):null,E=t.loadStatus&&t.payShowStatus?Number(t.user.walletBalance):null,F=t.loadStatus?t.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"):null,G=t.loadStatus&&1===t.type&&t.canUploadAttachment?t.i18n.t("discuzq.post.TheContentIsFreeAndTheAccessoriesArePaid"):null,U=t.loadStatus?t.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsPaid"):null,R=t.loadStatus?t.i18n.t("discuzq.post.cancel"):null,M=t.loadStatus&&5!==t.type&&"pay"===t.setType?t.i18n.t("discuzq.post.selectToViewPaymentAmount"):null,W=t.loadStatus&&5!==t.type&&"pay"!==t.setType?t.i18n.t("discuzq.post.selectToViewFreeWordCount"):null,H=t.loadStatus&&"pay"===t.setType&&5===t.type?t.i18n.t("discuzq.post.supportTheAuthorToContinueToCreate"):null,J=t.loadStatus?t.i18n.t("discuzq.post.cancel"):null,Q=t.loadStatus&&t.popupStatus?t.i18n.t("discuzq.post.payMoney"):null,Y=t.loadStatus&&t.popupStatus&&"pay"!==t.setType?t.i18n.t("discuzq.post.word",{num:""}):null,Z=t.loadStatus&&t.popupStatus?t.i18n.t("discuzq.close"):null,K=t.loadStatus&&t.popupStatus&&"pay"===t.setType?t.i18n.t("discuzq.ok"):null,X=t.loadStatus&&t.popupStatus&&"pay"!==t.setType?t.i18n.t("discuzq.ok"):null;t.$mp.data=Object.assign({},{$root:{g0:i,g1:s,g2:a,g3:o,g4:r,g5:n,g6:c,g7:u,g8:h,g9:d,g10:p,g11:l,g12:m,g13:f,m0:y,g14:g,g15:_,m1:v,g16:b,g17:w,m2:k,g18:S,g19:I,g20:T,g21:P,g22:x,g23:q,m4:A,m6:N,m8:C,l0:$,m10:z,m12:L,m14:V,l1:j,g24:B,g25:D,m15:O,m16:E,g26:F,g27:G,g28:U,g29:R,g30:M,g31:W,g32:H,g33:J,g34:Q,g35:Y,g36:Z,g37:K,g38:X}})},o=[]},b3b8:function(t,e,i){"use strict";var s=i("7773"),a=i.n(s);a.a}},[["5d85","common/runtime","common/vendor"]]]);