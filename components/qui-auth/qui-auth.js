(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/qui-auth/qui-auth"],{3456:function(e,t,r){"use strict";var n=r("956f"),i=r.n(n);i.a},6340:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return s})),r.d(t,"a",(function(){return n}));var n={quiIcon:function(){return r.e("components/qui-icon/qui-icon").then(r.bind(null,"d13f"))},quiButton:function(){return r.e("components/qui-button/qui-button").then(r.bind(null,"018a"))}},i=function(){var e=this,t=e.$createElement;e._self._c},s=[]},"8a3a":function(e,t,r){"use strict";r.r(t);var n=r("6340"),i=r("f9be");for(var s in i)"default"!==s&&function(e){r.d(t,e,(function(){return i[e]}))}(s);r("3456");var a,o=r("f0c5"),u=Object(o["a"])(i["default"],n["b"],n["c"],!1,null,"57343fb1",null,!1,n["a"],a);t["default"]=u.exports},"956f":function(e,t,r){},a1b8:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(r("7a36")),i=u(r("dc1b")),s=r("0f20"),a=r("e114"),o=u(r("c939"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){return h(e)||g(e,t)||f(e,t)||d()}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){if(e){if("string"===typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)if(r.push(a.value),t&&r.length===t)break}catch(u){i=!0,s=u}finally{try{n||null==o["return"]||o["return"]()}finally{if(i)throw s}}return r}}function h(e){if(Array.isArray(e))return e}var m={mixins:[n.default,i.default,o.default],data:function(){return{canIUseGetUserProfile:!1}},computed:{t:function(){return this.i18n.t("auth")}},created:function(){wx.getUserProfile&&(this.canIUseGetUserProfile=!0)},methods:{checkIsNeedRegister:function(){var t=this;!t.$store.getters["session/get"]("isLogin")&&t.forums&&t.forums.set_reg&&2===t.forums.set_reg.register_type&&(e.setStorageSync("isSend",!0),e.setStorageSync("register",1))},handleGetUserProfile:function(){var t=this,r=function(r){var n=r.encryptedData,i=r.iv,s=!n||!i;if(s)e.showToast({icon:"none",title:"请升级您的微信到最新版，当前版本不支持微信登录功能",duration:3e3});else{t.checkIsNeedRegister();var a=e.getStorageSync("register");t.getmpParams({register:a,encryptedData:n,iv:i})}};wx.getUserProfile({desc:"用于完成注册、登录用户信息",success:function(e){r(e)}})},handleGetUserInfo:function(t){var r=this;if("getUserInfo:ok"===t.detail.errMsg){var n=e.getStorageSync("register"),i=t.detail,s=i.iv,a=i.encryptedData;r.checkIsNeedRegister(),r.getmpParams({register:n,iv:s,encryptedData:a})}else r.$emit("login")},getmpParams:function(t){var r=this,n=t.register,i=void 0===n?0:n,s=t.encryptedData,a=t.iv;return new Promise((function(t){e.login({success:function(e){if("login:ok"===e.errMsg){var n=e.code,o={data:{attributes:{js_code:n,iv:a,encryptedData:s,register:i}}};r.$store.dispatch("session/setParams",o),r.getParams(),t()}}})}))},getParams:function(){var t={data:{attributes:{}}},r=this.$store.getters["session/get"]("params");r&&r.data&&r.data.attributes&&(t.data.attributes.js_code=r.data.attributes.js_code,t.data.attributes.iv=r.data.attributes.iv,t.data.attributes.encryptedData=r.data.attributes.encryptedData,t.data.attributes.register=r.data.attributes.register);var n=e.getStorageSync("inviteCode");""!==n&&(t.data.attributes.code=n);var i=e.getStorageSync("isSend");i&&this.noSenseLogin(t)},handleNoBindUser:function(t){var r={headimgurl:t.user.headimgurl,username:t.user.username};e.setStorageSync("token",t.token),e.setStorageSync("userInfo",r),e.setStorageSync("isBind",!0),this.forums&&this.forums.set_reg&&0===this.forums.set_reg.register_type&&this.jump2RegisterBindPage(),this.forums&&this.forums.set_reg&&1===this.forums.set_reg.register_type&&this.jump2RegisterBindPhonePage()},handleMpLoginError:function(t){var r=c(t,1),n=r[0];switch(n.code){case"register_validate":e.showToast({icon:"none",title:this.i18n.t("core.register_validate"),duration:2e3}),this.$store.commit("session/SET_AUDIT_INFO",{errorCode:"register_validate",username:n.data.userName}),e.redirectTo({url:"/pages/user/warning"});break;case"permission_denied":this.login();break;case"validate_reject":e.showToast({icon:"none",title:this.i18n.t("core.validate_reject"),duration:2e3}),this.$store.commit("session/SET_AUDIT_INFO",{errorCode:"validate_reject",reason:n.data.rejectReason,username:n.data.userName}),e.redirectTo({url:"/pages/user/warning"});break;case"ban_user":e.showToast({icon:"none",title:this.i18n.t("core.ban_user"),duration:2e3}),this.$store.dispatch("forum/setError",{loading:!1,code:"ban_user"});break;case"no_bind_user":this.handleNoBindUser(n);break;case"register_close":e.showToast({icon:"none",title:this.i18n.t("core.register_close"),duration:2e3}),e.redirectTo({url:"/pages/site/info"});break;default:e.redirectTo({url:"/pages/site/info"})}},noSenseLogin:function(t){var r=this,n=!1,i=getCurrentPages(),o=i[i.length-1].route;"pages/user/partner-invite"===o||"pages/user/login"===o||"pages/user/phone-login"===o||"pages/user/phone-login-register"===o?i.length>2?n=!0:e.setStorageSync("page","/pages/home/index"):e.setStorageSync("page",(0,a.getCurUrl)()),this.$store.dispatch("session/noSenseMPLogin",t).then((function(t){if(console.log(t,"微信无感"),r.forums&&r.forums.set_site&&"1"===r.forums.set_site.open_ext_fields&&t&&t.new_user)r.jump2RegisterExtendPage();else if(t&&t.data){if(r.$emit("login"),t.data.data&&t.data.data.id){if(r.logind(),r.forums&&r.forums.set_site&&r.forums.set_site.site_mode!==s.SITE_PAY)try{var i=e.getStorageSync("page");if(-1!==i.indexOf("/login"))return void e.redirectTo({url:"/pages/home/index"});var a=e.getStorageSync("isBind");a?e.showToast({title:"绑定成功",duration:2e3}):e.showToast({title:"登录成功",duration:2e3}),n?e.navigateBack({delta:1}):e.redirectTo({url:i,fail:function(){e.redirectTo({url:"/pages/home/index"})}})}catch(o){e.showToast({title:"登录失败"})}r.forums&&r.forums.set_site&&r.forums.set_site.site_mode===s.SITE_PAY&&r.user&&!r.user.paid&&(e.redirectTo({url:"/pages/site/info"}),e.getStorage({key:"isBind",success:function(t){t.data?e.showToast({title:"绑定成功",duration:2e3}):e.showToast({title:"登录成功",duration:2e3})}}))}t.data.errors&&r.handleMpLoginError(t.data.errors)}})).catch((function(e){console.log(e)}))},close:function(){this.$emit("close")}}};t.default=m}).call(this,r("543d")["default"])},f9be:function(e,t,r){"use strict";r.r(t);var n=r("a1b8"),i=r.n(n);for(var s in n)"default"!==s&&function(e){r.d(t,e,(function(){return n[e]}))}(s);t["default"]=i.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/qui-auth/qui-auth-create-component',
    {
        'components/qui-auth/qui-auth-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("8a3a"))
        })
    },
    [['components/qui-auth/qui-auth-create-component']]
]);
