(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/qui-uploader/qui-uploader"],{"2fbb":function(e,t,a){"use strict";a.r(t);var o=a("e7d9"),n=a.n(o);for(var i in o)"default"!==i&&function(e){a.d(t,e,(function(){return o[e]}))}(i);t["default"]=n.a},"3d87":function(e,t,a){},a949:function(e,t,a){"use strict";var o=a("3d87"),n=a.n(o);n.a},bb64:function(e,t,a){"use strict";a.r(t);var o=a("df98"),n=a("2fbb");for(var i in n)"default"!==i&&function(e){a.d(t,e,(function(){return n[e]}))}(i);a("a949");var r,u=a("f0c5"),d=Object(u["a"])(n["default"],o["b"],o["c"],!1,null,"5b8018ea",null,!1,o["a"],r);t["default"]=d.exports},df98:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return o}));var o={quiIcon:function(){return a.e("components/qui-icon/qui-icon").then(a.bind(null,"d13f"))}},n=function(){var e=this,t=e.$createElement,a=(e._self._c,e.__map(e.uploadBeforeList,(function(t,a){var o=e.__get_orig(t),n=e.numberdata[a]&&e.numberdata[a].state<100?e.i18n.t("discuzq.image.imageUploading"):null;return{$orig:o,g0:n}})));e.$mp.data=Object.assign({},{$root:{l0:a}})},i=[]},e7d9:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(a("a34a")),n=a("35a3"),i=r(a("b1e8"));function r(e){return e&&e.__esModule?e:{default:e}}function u(e,t,a,o,n,i,r){try{var u=e[i](r),d=u.value}catch(s){return void a(s)}u.done?t(d):Promise.resolve(d).then(o,n)}function d(e){return function(){var t=this,a=arguments;return new Promise((function(o,n){var i=e.apply(t,a);function r(e){u(i,o,n,r,d,"next",e)}function d(e){u(i,o,n,r,d,"throw",e)}r(void 0)}))}}var s=0,l={name:"QuiUploader",props:{chooseType:{default:1,type:Number},url:{default:"",type:String},type:{default:"image",type:String},formData:{default:Object,type:Object},name:{default:"file",type:String},count:{default:9,type:[Number,String]},asyncClear:{default:!1,type:Boolean},filePreview:{type:Array,default:function(){return[]}},delayTime:{default:500,type:Number},deleteType:{default:1,type:Number},loginStatus:{default:1,type:Number},extendIndex:{default:0,type:Number}},data:function(){return{uploadBeforeList:[],uploadList:[],uploadIndex:"",formDataAppend:{},lastOrder:0,numberdata:[],indexs:"",erroindex:"",number:0,detailindex:[],newindex:[],cunmumber:1,uploadType:"",header:{},dataCount:this.count,chooseLength:0,uploadCount:0}},watch:{formData:{handler:function(e){this.formData=e,this.uploadStatus=!0},deep:!0,immediate:!0},uploadList:{handler:function(e){this.uploadList=e,this.$emit("change",this.uploadList,!0)},deep:!0,immediate:!0}},created:function(){var e=this;return d(o.default.mark((function t(){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:setTimeout((function(){e.uploadBeforeList=e.uploadBeforeList.concat(e.filePreview),e.uploadList.concat(e.filePreview).forEach((function(t){0===e.uploadList.filter((function(e){return(0,i.default)(e,"id","u")===(0,i.default)(t,"id","i")})).length&&e.uploadList.push(t)})),e.uploadBeforeList.length>0&&e.uploadBeforeList.map((function(){return e.numberdata.push({state:100})}))}),e.delayTime),e.filePreview.length?e.lastOrder=e.filePreview[e.filePreview.length-1].order:e.lastOrder=0;case 2:case"end":return t.stop()}}),t)})))()},methods:{getValue:function(){return this.uploadList},uploadDelete:function(e){this.uploadList.sort(this.compare("order"));var t=this.uploadList[e];this.asyncClear?this.$emit("clear",t,e,this.extendIndex):(this.uploadBeforeList.splice(e,1),this.uploadList.splice(e,1),this.numberdata.splice(e,1),this.$emit("clear",this.uploadList,t))},clear:function(e){var t=this.uploadBeforeList[e];this.uploadList.sort(this.compare("order"));var a=this.uploadList[e];return this.uploadBeforeList=this.uploadBeforeList.filter((function(e){return e.id!==t.id})),this.uploadList=this.uploadList.filter((function(e){return e.id!==t.id})),this.numberdata=this.numberdata.filter((function(e){return e.id!==t.id})),a},previewPicture:function(t,a){for(var o=this,n=[],i=0,r=o.uploadBeforeList.length;i<r;i+=1)n.push(o.uploadBeforeList[i].path);e.previewImage({current:t,urls:n,indicator:"default"})},compare:function(e){return function(t,a){var o=t[e],n=a[e];return o-n}},uploadClick:function(){var t=this,a=t.uploadBeforeList.length;0===t.chooseType&&(t.uploadList=[],t.uploadBeforeList=[],t.dataCount=9,t.lastOrder=0,s=0),(t.uploadList.length<t.dataCount||"avatar"===t.name)&&wx.chooseImage({count:t.dataCount-t.uploadBeforeList.length,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(o){t.chooseLength=o.tempFiles.length,e.$emit("uploadLength",t.chooseLength),t.$emit("uploadClick",!1),t.$emit("chooseSuccess");var n=o.tempFiles.map((function(e,n){return t.lastOrder+=1,new Promise((function(e,i){o.tempFiles[n].uploadPercent=0,o.tempFiles[n].uploadStatus=!1,t.uploadBeforeList.push(o.tempFiles[n]),t.numberdata.push({state:0}),t.newindex.push(o.tempFiles[n]),t.upload(o.tempFilePaths[n],t.uploadBeforeList.length-1,a,t.lastOrder,e,i)}))}));Promise.race(n).then((function(){if(t.uploadBeforeList.length>t.dataCount){var e=t.uploadList.slice(0,t.dataCount);t.uploadList.splice(0),e.forEach((function(e){t.uploadList.push(e)}))}t.$emit("change",t.uploadList,!0,t.extendIndex)}))}})},upload:function(t,a,i,r,u,l){var p=this,c=e.getStorageSync("access_token");1!==p.loginStatus&&0!==p.loginStatus||(p.header={authorization:"Bearer ".concat(c)}),0===p.chooseType&&e.showLoading({title:p.i18n.t("core.loading"),mask:!0});var f={type:p.formData.type,order:r};p.formDataAppend={};var h=e.uploadFile({url:p.url,fileType:p.type,filePath:t,header:p.header,name:p.name,formData:f,success:function(t){if(!(t.statusCode>=200&&t.statusCode<300)){p.number+=1;var o=JSON.parse(t.data);if(o.errors[0].detail?e.showToast({icon:"none",title:"".concat(n.i18n.t("core.".concat(o.errors[0].code)),"\n").concat(o.errors[0].detail[0])}):e.showToast({icon:"none",title:o.errors[0].code}),p.uploadBeforeList.length>1)for(var i=0;i<p.uploadBeforeList.length;i+=1)p.uploadBeforeList[i]===p.newindex[a]&&(p.uploadBeforeList.splice(i,1),p.uploadList.splice(i,1),p.numberdata.splice(i,1),p.erroindex=i);else p.uploadBeforeList.splice(0,1),p.uploadList.splice(0,1),p.numberdata.splice(0,1);return a>0&&a===p.uploadBeforeList.length?p.indexs=a-1:a>0&&a<p.uploadBeforeList.length?p.indexs=a:a>0&&a>=p.uploadBeforeList.length?p.indexs=a-p.number:0===a&&(p.indexs=0),p.$emit("uploadFail",t,p.uploadList),l(t)}return setTimeout((function(){if(s+=1,0===p.chooseType&&a<=8&&e.$emit("uploadOver",{data:JSON.parse(t.data),times:s}),a<p.uploadBeforeList.length&&(p.uploadBeforeList[a].uploadPercent=100,p.uploadBeforeList[a].id=JSON.parse(t.data).data.id,p.numberdata[a].state=100),""!==p.erroindex&&p.erroindex>=0&&p.erroindex<p.uploadBeforeList.length&&(p.uploadBeforeList[p.erroindex].uploadPercent=100,p.numberdata[p.erroindex].state=100),p.indexs>=0&&""!==p.indexs&&p.indexs<p.uploadBeforeList.length&&(p.uploadBeforeList[p.indexs].uploadPercent=100,p.numberdata[p.indexs].state=100),p.uploadList.push(JSON.parse(t.data).data),p.uploadList.length>p.dataCount){p.uploadList.sort(p.compare("order")),p.uploadBeforeList=p.uploadBeforeList.slice(0,p.count);var o=p.uploadList.slice(0,p.dataCount);p.uploadList.splice(0),o.forEach((function(e){p.uploadList.push(e)})),p.numberdata=p.numberdata.slice(0,p.dataCount),p.newindex=p.newindex.slice(0,p.dataCount)}p.newindex=[],p.formDataAppend={}}),500),p.formDataAppend={},p.$emit("uploadSuccess",t,p.uploadList),u(p.uploadList)},fail:function(e){return p.uploadBeforeList.splice(a,1),p.uploadList.splice(a,1),p.numberdata.splice(a,1),p.$emit("uploadFail",e,p.uploadList),l(e)},complete:function(t){0===p.chooseType&&JSON.parse(t.data).errors&&JSON.parse(t.data).errors.length>0&&(p.chooseLength=p.chooseLength>p.dataCount?p.dataCount:p.chooseLength,e.$emit("uploadFail",{data:JSON.parse(t.data)}))}});h.onProgressUpdate(function(){var e=d(o.default.mark((function e(t){var a,n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.progress;case 2:for(a=e.sent,n=i;n<p.uploadBeforeList.length;n+=1)a<100?(p.uploadBeforeList[n].uploadPercent=a,p.numberdata[n]&&(p.numberdata[n].state=p.uploadBeforeList[n].uploadPercent)):100===a&&(p.uploadBeforeList[n].uploadPercent=90,p.numberdata[n]&&(p.numberdata[n].state=p.uploadBeforeList[n].uploadPercent));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}};t.default=l}).call(this,a("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/qui-uploader/qui-uploader-create-component',
    {
        'components/qui-uploader/qui-uploader-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("bb64"))
        })
    },
    [['components/qui-uploader/qui-uploader-create-component']]
]);
