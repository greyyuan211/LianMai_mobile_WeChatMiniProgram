(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/qui-page-home/qui-page-home"],{3530:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return a}));var a={uniNavBar:function(){return i.e("components/uni-nav-bar/uni-nav-bar").then(i.bind(null,"a393"))},quiHeader:function(){return i.e("components/qui-header/qui-header").then(i.bind(null,"9dfa"))},quiIcon:function(){return i.e("components/qui-icon/qui-icon").then(i.bind(null,"d13f"))},uTabs:function(){return i.e("components/u-tabs/u-tabs").then(i.bind(null,"b9df"))},quiUparse:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-uparse/qui-uparse")]).then(i.bind(null,"11a7"))},quiContent:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-content/qui-content")]).then(i.bind(null,"0810"))},quiLoadMore:function(){return i.e("components/qui-load-more/qui-load-more").then(i.bind(null,"3fc9"))},quiFilterModal:function(){return i.e("components/qui-filter-modal/qui-filter-modal").then(i.bind(null,"8021"))},uniPopup:function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,"78fd"))},quiToast:function(){return i.e("components/qui-toast/qui-toast").then(i.bind(null,"b091"))}},n=function(){var e=this,t=e.$createElement,i=(e._self._c,e.$u.light()),a=e.$u.light(),n=e.i18n.t("home.sticky"),s=e.__map(e.threads,(function(t,i){var a=e.__get_orig(t),n=e.handleGroup(t.thread.extension&&t.thread.extension.question&&t.thread.extension.question.group);return{$orig:a,m0:n}})),r=e.i18n.t("home.copyright"),o=e.i18n.t("home.confirmText"),c=e.i18n.t("home.cancel"),h=e.i18n.t("home.cancel");e.$mp.data=Object.assign({},{$root:{g0:i,g1:a,g2:n,l0:s,g3:r,g4:o,g5:c,g6:h}})},s=[]},"3ec5":function(e,t,i){},"84a0":function(e,t,i){"use strict";i.r(t);var a=i("fc2d"),n=i.n(a);for(var s in a)"default"!==s&&function(e){i.d(t,e,(function(){return a[e]}))}(s);t["default"]=n.a},"91df":function(e,t,i){"use strict";i.r(t);var a=i("3530"),n=i("84a0");for(var s in n)"default"!==s&&function(e){i.d(t,e,(function(){return n[e]}))}(s);i("b357");var r,o=i("f0c5"),c=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],r);t["default"]=c.exports},b357:function(e,t,i){"use strict";var a=i("3ec5"),n=i.n(a);n.a},fc2d:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=d(i("a34a")),n=d(i("7a36")),s=d(i("dc1b")),r=d(i("c939")),o=i("2f62"),c=i("2ef0"),h=d(i("d654"));function d(e){return e&&e.__esModule?e:{default:e}}function l(e){return g(e)||p(e)||f(e)||u()}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){if(e){if("string"===typeof e)return m(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?m(e,t):void 0}}function p(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function g(e){if(Array.isArray(e))return m(e)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function v(e,t,i,a,n,s,r){try{var o=e[s](r),c=o.value}catch(h){return void i(h)}o.done?t(c):Promise.resolve(c).then(a,n)}function y(e){return function(){var t=this,i=arguments;return new Promise((function(a,n){var s=e.apply(t,i);function r(e){v(s,a,n,r,o,"next",e)}function o(e){v(s,a,n,r,o,"throw",e)}r(void 0)}))}}function T(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function b(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?T(Object(i),!0).forEach((function(t){I(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function I(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var x,w=function(){i.e("components/uni-popup/uni-popup-copy").then(function(){return resolve(i("f781"))}.bind(null,i)).catch(i.oe)},k=e.getSystemInfoSync();x=k.statusBarHeight+44;var S="translateY(-".concat(x,"px)"),_={components:{UniPopupCopy:w},mixins:[n.default,s.default,r.default],props:{navTheme:{type:String,default:""},homeCategoryId:{type:String,default:""},homeSearchIds:{type:String,default:""}},data:function(){return{searchIds:"",listItmeChildren:[],positionTop:"",currentdataInfoId:-2,currentClassification:-1,isActives:-1,navBarTransform:S,checkoutTheme:!1,threadType:"",threadEssence:0,threadFollow:0,show:!1,ifNeedConfirm:!0,top:500,filterSelected:{label:this.i18n.t("topic.whole"),value:""},loadingType:"more",hasMore:!1,pageSize:20,pageNum:1,isLiked:!1,showSearch:!0,navbarHeight:x,headerShow:!0,navTop:128,navHeight:0,nowThreadId:"",filterTop:"",shareShow:!1,shareTitle:"",isWeixin:"",filterList:[{title:this.i18n.t("home.filterPlate"),data:[]},{title:this.i18n.t("home.filterType"),data:[{label:this.i18n.t("home.all"),value:"",selected:!0},{label:this.i18n.t("home.text"),value:"0",selected:!1},{label:this.i18n.t("home.invitation"),value:"1",selected:!1},{label:this.i18n.t("home.video"),value:"2",selected:!1},{label:this.i18n.t("home.picture"),value:"3",selected:!1},{label:this.i18n.t("home.audio"),value:"4",selected:!1},{label:this.i18n.t("home.questions"),value:"5",selected:!1},{label:this.i18n.t("home.goods"),value:"6",selected:!1}]},{title:this.i18n.t("home.confirmText"),data:[{label:this.i18n.t("home.all"),value:"",selected:!0},{label:this.i18n.t("home.essence"),value:"1",selected:!1},{label:this.i18n.t("home.followed"),value:"2",selected:!1}]}],threads:[],location:{},sticky:[],shareBtn:"icon-share1",tabIndex:0,isResetList:!1,bottomData:[{text:this.i18n.t("home.generatePoster"),icon:"icon-poster",name:"wx",id:1},{text:this.i18n.t("home.wxShare"),icon:"icon-wx-friends",name:"wx",id:2}],threadsStatusId:0,categories:[],playIndex:null,scrollTop:0,surl:"",observer:null,scrollnumber:"",scrollindex:"",switchscroll:!1,rollingHeight:0,follow:!0}},computed:b(b({},(0,o.mapState)({categoryId:function(e){return e.session.categoryId},categoryIndex:function(e){return e.session.categoryIndex},footerIndex:function(e){return e.footerTab.footerIndex?parseInt(e.footerTab.footerIndex,10):0}})),{},{setIndex:{get:function(){var e=this.$store.state.footerTab.footerIndex;return e},set:function(e){1!==e&&2!==e||(this.headerShow=!0)}},userId:function(){return this.$store.getters["session/get"]("userId")}}),created:function(){var t=this;this.preThreadsData=null,this.preThreadsLoading=!1,this.homeSearchIds||(1===this.forums.set_site.site_open_sort?this.searchIds=0:this.searchIds=-1),this.$u.event.$on("refreshHome",(function(){t.isResetList=!0,t.pageNum=1,t.preThreadsData=null,t.loadThreadsSticky(),t.loadThreads()})),this.$u.event.$on("deleteThread",(function(){t.threads=[],t.isResetList=!0,t.pageNum=1,t.preThreadsData=null,t.loadThreadsSticky(),t.loadThreads()})),this.$u.event.$on("deletedImg",(function(e){t.threads.forEach((function(t){t.thread.pid===e.threadId&&t.attachment.splice(e.index,1)}))})),this.$u.event.$on("stickyThread",(function(e){t.loadThreadsSticky(),t.threads.forEach((function(i,a){i.thread.pid===e._jv.id&&t.threads.splice(a,1)}))})),this.$u.event.$on("refreshImg",(function(e){for(var i in t.threads)if(t.threads[i].thread.pid===e.threadId){var a=function(){var a=[];return e.images.data&&e.images.data.forEach((function(e){a.push(t.$store.getters["jv/get"]("attachments/".concat(e.id)))})),t.threads[i].attachment=a,t.$forceUpdate(),"break"}();if("break"===a)break}})),this.$u.event.$on("refreshGoods",(function(e){for(var i in t.threads)if(t.threads[i].thread.pid===e.threadId){t.threads[i].thread.postGoods=e.goods,t.$forceUpdate();break}})),this.$u.event.$on("updateLocation",(function(e,i){t.threads.forEach((function(a,n){a.thread.pid===e&&(t.threads[n].latitude=i.latitude||"",t.threads[n].location=i.location||"",t.threads[n].longitude=i.longitude||"",t.threads[n].address=i.address||"")}))})),this.ontrueGetList(),e.$on("logind",(function(){t.ontrueGetList()}))},destroyed:function(){e.$off("logind")},mounted:function(){var t=this;this.$u.event.$on("tagClick",(function(e,i,a){t.pageNum=1,t.searchIds=a,t.isResetList=!0,t.loadCategories(),t.setCategoryId(e),t.handleClickSearch(i),t.setCategoryIndex(t.getCategorieIndex(e)),t.loadThreadsSticky(),t.loadThreads()})),0===this.footerIndex&&this.$uGetRect("#navId").then((function(e){t.navTop=e.top,t.navHeight=e.height})),this.forums.set_site&&this.forums.set_site.site_title?e.setNavigationBarTitle({title:"".concat(this.forums.set_site.site_title)}):this.forums.set_site&&e.setNavigationBarTitle({title:"".concat(this.forums.set_site.site_name)})},methods:b(b({handleClickSearch:function(e){var t=this;this.isActives=e,this.listItmeChildren.forEach((function(i){i.searchIds===e&&t.$refs.clickOpenList.close()}));var i={page:this.pageNum,perPage:10,filter:{sticky:0,essence:this.threadEssence||0,categoryids:[e],attention:this.threadFollow}};(this.threadType||0===this.threadType)&&(i.filter.types=[this.threadType]),h.default.readThreadList({params:i}).then((function(e){e.Data&&(t.loadingType=e.Data.currentPage<e.Data.totalPage?"more":"nomore"),t.threads=[],t.$nextTick((function(){t.threads=e.Data.pageData}))}))},handleClickOpenList:function(e){var t=this;wx.createSelectorQuery().in(this).select("#navId").boundingClientRect((function(e){t.positionTop="".concat(2*e.bottom,"rpx")})).exec();var i=parseInt(e.id,10);this.isActives=-1,0!==i?this.categories.forEach((function(e){parseInt(e._jv.id,10)===i&&(t.listItmeChildren=e.children||[],0===t.listItmeChildren.length?t.$refs.clickOpenList.close():t.$refs.clickOpenList.open())})):this.$refs.clickOpenList.close()}},(0,o.mapMutations)({setCategoryId:"session/SET_CATEGORYID",setCategoryIndex:"session/SET_CATEGORYINDEX"})),{},{topMargin:function(){return";"},handleGroup:function(e){var t=[e];return t.length>0&&(t=t.filter((function(e){return e&&e.isDisplay}))),t[0]?[t[0]]:[]},scrpllsip:function(e,t){this.scrollnumber=e,this.scrollindex=t,this.switchscroll=!0,this.scrollTop=this.rollingHeight},isChangeScroll:function(e){this.$emit("changeScroll",e)},scroll:function(e){this.preLoadThreads(),this.follow&&(this.rollingHeight=e.scrollTop),this.switchscroll&&0!==e.scrollTop&&(this.scrollTop>this.num||this.scrollTop<this.num)&&(this.$refs["myVideo".concat(this.scrollindex)][0].pauseVideo(),this.switchscroll=!1),this.navbarHeight&&(e.scrollTop+this.navbarHeight+20>=this.navTop?(this.headerShow=!1,this.navBarTransform="none"):(this.headerShow=!0,this.navBarTransform="translate3d(0, -".concat(this.navbarHeight,"px, 0)")))},scrollsetups:function(){var t=this;this.scrollTop=this.rollingHeight,e.setStorage({key:"scroll_top",data:t.scrollTop})},screenplayback:function(t){var i=this,a=0;this.follow=t,e.getStorage({key:"scroll_top",success:function(e){a=e.data,i.num=e.data}});var n=setTimeout((function(){e.pageScrollTo({duration:0,scrollTop:a,success:function(){i.follow=!0}}),clearTimeout(n)}),100)},toUpper:function(){this.headerShow=!0},getCategorieIndex:function(e){for(var t=0,i=this.categories.length;t<i;t+=1){var a=this.categories[t]._jv.id;if(a instanceof Array){var n=a.map((function(e){return"".concat(e)})).indexOf("".concat(e));if(-1!==n)return t}else if("".concat(a)==="".concat(e))return t}},toggleTab:function(t){var i=this;return y(a.default.mark((function n(){return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t||!t.item){a.next=18;break}return i.searchIds=t.item.searchIds,i.isResetList=!0,i.pageNum=1,i.checkoutTheme=!0,i.threadEssence=0,i.threadFollow=0,"number"===typeof t.id?i.setCategoryId(t.id):i.setCategoryId(t.id[0]),i.setCategoryIndex(t.index),i.filterList[0].data.map((function(e){e.selected=!1})),1===i.forums.set_site.site_open_sort?0===t.index?i.filterList[0].data[t.index].selected=!0:i.filterList[0].data[t.index-1].selected=!0:i.filterList[0].data[t.index].selected=!0,i.preThreadsData=null,i.loadThreadsSticky(),i.threads=[],a.next=16,i.loadThreads();case 16:i.checkoutTheme=!1,0!==t.id?e.setNavigationBarTitle({title:"".concat(t.name," - ").concat(i.forums.set_site.site_name)}):i.forums.set_site&&i.forums.set_site.site_title?e.setNavigationBarTitle({title:"".concat(i.forums.set_site.site_title)}):e.setNavigationBarTitle({title:"".concat(i.forums.set_site.site_name)});case 18:case"end":return a.stop()}}),n)})))()},searchClick:function(){e.navigateTo({url:"/pages/site/search"}),this.show=!1},stickyClick:(0,c.throttle)((function(t){e.navigateTo({url:"/topic/index?id=".concat(t)})}),1e3),commentClick:(0,c.throttle)((function(t){e.navigateTo({url:"/topic/index?id=".concat(t)})}),1e3),contentClick:(0,c.throttle)((function(t){t.thread.canViewPost?e.navigateTo({url:"/topic/index?id=".concat(t.thread.pid)}):this.$refs.toast.show({message:this.i18n.t("home.noPostingTopic")})}),1e3),headClick:function(t){!t||t<=0||e.navigateTo({url:"/pages/profile/index?userId=".concat(t)})},answeClick:function(t){t<=0||e.navigateTo({url:"/pages/profile/index?userId=".concat(t)})},beAskClick:function(t){t<=0||e.navigateTo({url:"/pages/profile/index?userId=".concat(t)})},headAnswerClick:function(t){t<=0||e.navigateTo({url:"/pages/profile/index?userId=".concat(t)})},open:function(){this.$store.getters["session/get"]("isLogin")||(e.setStorage({key:"page",data:"/pages/home/index"}),this.mpLoginMode()),this.$refs.popupHead.open(),"pay"===this.forums.set_site.site_mode&&(this.bottomData=[{text:this.i18n.t("home.generatePoster"),icon:"icon-poster",name:"wx",id:1}])},shareHead:function(t){0===t&&(this.$store.getters["session/get"]("isLogin")||(e.setStorage({key:"page",data:"/pages/home/index"}),this.mpLoginMode()),e.navigateTo({url:"/pages/share/site"})),this.cancel()},cancel:function(){this.$refs.popupContent.close(),this.$refs.popupHead.close()},close:function(){this.$refs.auth.close()},confirm:function(e,t,i){this.isResetList=!0,this.pageNum=1;var a=b({},e);switch(this.searchIds=t||e[0].data.value,1===this.forums.set_site.site_open_sort?this.setCategoryIndex(i+1):this.setCategoryIndex(i),this.threadType=a[1].data.value,a[2].data.value){case"1":this.threadEssence=1,this.threadFollow=0;break;case"2":this.threadEssence=0,this.threadFollow=1;break;default:this.threadEssence=0,this.threadFollow=0;break}this.preThreadsData=null,this.loadThreadsSticky(),this.threads=[],this.loadThreads()},changeType:function(e){this.filterList=e},showFilter:function(){var e=this;wx.createSelectorQuery().in(this).select("#navId").boundingClientRect((function(t){e.filterTop="".concat(2*t.bottom,"rpx")})).exec(),this.show=!this.show,this.$refs.filter.setData()},handleClickShare:function(t){this.$store.getters["session/get"]("isLogin")||(e.setStorage({key:"page",data:"/pages/home/index"}),this.mpLoginMode()),this.$emit("handleClickShare",t.thread.pid),this.nowThreadId=t.thread.pid,this.$refs.popupContent.open(),"pay"===this.forums.set_site.site_mode&&(this.bottomData=[{text:this.i18n.t("home.generatePoster"),icon:"icon-poster",name:"wx",id:1}])},shareContent:function(t){0===t&&e.navigateTo({url:"/pages/share/topic?id=".concat(this.nowThreadId)}),this.cancel()},loadCategories:function(){var e=this;h.default.readCategories().then((function(t){e.$store.dispatch("categories/setCategories",(0,c.get)(t,"Data",[]));var i=t.Data.map((function(e){var t=e;return t._jv={id:e.searchIds},t}));1===e.forums.set_site.site_open_sort?e.categories=[{_jv:{id:0},name:"默认",searchIds:0},{_jv:{id:-1},name:e.i18n.t("home.all"),searchIds:-1}].concat(l(i)):e.categories=[{_jv:{id:-1},name:e.i18n.t("home.all"),searchIds:-1}].concat(l(i));var a=[{label:e.i18n.t("home.all"),value:-1,selected:!0}];i.forEach((function(e){a.push({label:e.name,value:e._jv.id,selected:!1,searchIds:e.searchIds})})),e.filterList[0].data=a}))},loadThreadsSticky:function(){var e=this,t="";t=-1===this.searchIds?0:this.searchIds;var i={},a=[];a=t||0===t?t instanceof Array?this.searchIds:[t]:[],a.length>0&&0!==t&&(i.categoryids=a),h.default.readStickList({params:i}).then((function(t){e.sticky=l(t.Data)}))},loadThreads:function(){var e=this;return y(a.default.mark((function t(){var i,n,s;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i="",i=e.searchIds||0===e.searchIds?e.searchIds instanceof Array?e.searchIds:[e.searchIds]:[],n={page:e.pageNum,perPage:10,filter:{sticky:0,essence:e.threadEssence||0,attention:e.threadFollow}},i.length>0&&-1!==e.searchIds&&0!==e.searchIds&&(n.filter.categoryids=i),0===e.searchIds&&(n.homeSequence=1),(e.threadType||0===e.threadType)&&(n.filter.types=[e.threadType]),t.prev=6,!e.preThreadsData||!e.preThreadsData[e.pageNum]){t.next=12;break}s=e.preThreadsData[e.pageNum],e.preThreadsData=null,t.next=16;break;case 12:return e.preThreadsData=null,t.next=15,h.default.readThreadList({params:n});case 15:s=t.sent;case 16:s.Data&&(e.loadingType=s.Data.currentPage<s.Data.totalPage?"more":"nomore"),e.isResetList?e.threads=s.Data.pageData:e.threads=[].concat(l(e.threads),l(s.Data.pageData)),e.isResetList=!1,t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](6),console.log(t.t0);case 24:case"end":return t.stop()}}),t,null,[[6,21]])})))()},preLoadThreads:function(){var e=this;if(!this.preThreadsData&&!this.preThreadsLoading){this.preThreadsLoading=!0;var t="";t=this.searchIds||0===this.searchIds?this.searchIds instanceof Array?this.searchIds:[this.searchIds]:[];var i={page:this.pageNum+1,perPage:10,filter:{sticky:0,essence:this.threadEssence||0,attention:this.threadFollow}};return t.length>0&&-1!==this.searchIds&&0!==this.searchIds&&(i.filter.categoryids=t),0===this.searchIds&&(i.homeSequence=1),(this.threadType||0===this.threadType)&&(i.filter.types=[this.threadType]),h.default.readThreadList({params:i}).then((function(t){e.preThreadsData=I({},i.page,t)})).catch((function(){e.preThreadsData=null})).finally((function(){e.preThreadsLoading=!1}))}},handleIsGreat:function(t,i,a,n,s){var r=s;this.$store.getters["session/get"]("isLogin")||(e.setStorage({key:"page",data:"/pages/home/index"}),this.mpLoginMode());var o={pid:t,data:{attributes:{isLiked:!0!==a}}};h.default.updatePosts({data:o}).then((function(e){r.isLiked=e.Data.isLiked,r.likedCount=e.Data.likeCount}))},pullDown:function(){0===this.footerIndex&&"more"===this.loadingType&&(this.pageNum+=1,this.loadThreads())},handleVideoPlay:function(e,t){this.switchscroll=t,this.playIndex!==e&&null!==this.playIndex&&this.$refs["myVideo".concat(this.playIndex)][0].pauseVideo(),this.playIndex=e},ontrueGetList:function(){this.headerShow=!0,this.isResetList=!0,this.loadCategories(),this.loadThreadsSticky(),this.loadThreads()},getQueryString:function(e){var t=new RegExp("(^|&)".concat(e,"([^&]*)(&|$)")),i=window.location.search.substr(1).match(t);return null!=i?i[2].substring(1):null}})};t.default=_}).call(this,i("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/qui-page-home/qui-page-home-create-component',
    {
        'components/qui-page-home/qui-page-home-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("91df"))
        })
    },
    [['components/qui-page-home/qui-page-home-create-component']]
]);
