(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/site/index"],{"0083":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n("0f20"),o=n("2f62"),r=u(n("7a36")),s=u(n("dc1b")),a=u(n("c939"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){n.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(n("ba2b"))}.bind(null,n)).catch(n.oe)},f=null,h={name:"Post",components:{uniPopupDialog:l},mixins:[r.default,s.default,a.default],data:function(){return{browser:0,version:i.VERSION,title:this.i18n.t("manage.circleinfo"),shareBtn:"icon-share1",isWeixin:"",shareShow:!1,isPhone:!1,wechatTip:this.i18n.t("discuzq.wechatBind"),payShowStatus:!1,qrcodeShow:!1,isAnonymous:"0",payTypeData:[{name:this.i18n.t("pay.wxPay"),icon:"icon-wxPay",color:"#09bb07",value:"0"},{name:"钱包支付",icon:"icon-walletPay",color:"#1878f3",value:"1"}]}},onLoad:function(){this.getSiteInfo(),this.getPermissions(),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onShareAppMessage:function(e){return e.from,{title:this.forums.set_site.site_name}},onShareTimeline:function(){return{title:this.forums.set_site.site_name,query:""}},computed:d({pay:function(){return this.i18n.t("pay")},currentLoginId:function(){var e=this.$store.getters["session/get"]("userId");return parseInt(e,10)},siteInfo:function(){var e=this.$store.getters["jv/get"]("forums/1");return e&&e.other&&(e.count_users=e.other.count_users,e.count_threads=e.other.count_threads),e&&e.set_site&&(e.site_introduction=e.set_site.site_introduction,e.set_site.site_install&&(e.createdAt=e.set_site.site_install.slice(0,10))),e&&e.set_site&&e.set_site.site_author&&(e.avatar=e.set_site.site_author.avatar,e.username=e.set_site.site_author.username,e.userId=e.set_site.site_author.id),e},userInfo:function(){var e=this.$store.getters["jv/get"]("users/".concat(this.currentLoginId));return e&&e.joinedAt&&(e.joinedTime=e.joinedAt.slice(0,10)),e&&e.expiredAt?e.expiredTime="".concat(e.expiredAt.substr(0,10)," "):e.expiredTime=this.i18n.t("site.permanent"),e&&e.groups&&e.groups.length>0&&(e.groupName=e.groups[0].name),e},day:function(){var e=this.$store.getters["jv/get"]("forums/1");return e&&e.set_site&&e.set_site.site_expire?e.set_site.site_expire:""},permissionInfo:function(){var e=[],t=this.$store.getters["jv/get"]("users/".concat(this.currentLoginId));if(t&&t.groups){var n=t.groups[0];e=n.permission.map((function(e){return e.permission}))}return e}},(0,o.mapState)({footerIndex:function(e){return e.footerTab.footerIndex}})),methods:d(d({handlePermission:function(e){return e.includes("canBeAsked.money")?this.$t("permission.canBeAsked_money",{lowPrice:e.match(/\d+$/)[0]}):this.$t("permission.".concat(e.replace(/\./g,"_")))},getSiteInfo:function(){var e={include:["users"]};this.$store.dispatch("jv/get",["forum",{params:e}]).then((function(e){console.log(e)}))},getPermissions:function(){var e={"filter[type]":"invite",include:["permission"]};this.$store.dispatch("jv/get",["groups",{params:e}]).then((function(e){console.log(e)}))},open:function(){this.$refs.popupHead.open()},closeShare:function(){this.shareShow=!1},cancel:function(){this.$refs.popupHead.close()}},(0,o.mapMutations)({setFooterIndex:"footerTab/SET_FOOTERINDEX"})),{},{logoClick:function(){this.setFooterIndex(parseInt(0,10)),e.redirectTo({url:"/pages/home/index"})},jumpUserPage:function(t){t&&e.navigateTo({url:"/pages/profile/index?userId=".concat(t)})},renewal:function(){var e=this;this.payStatus=!1,this.payShowStatus=!0,this.$nextTick((function(){e.$refs.payShow.payClickShow()}))},handleWechatClickOk:function(){this.mpLogin()},handleWechatClickCancel:function(){this.$refs.wechatPopup.close()},onInput:function(e){this.forums.paycenter.wxpay_close?this.value=e:this.value=1,this.creatOrder(this.price,8,this.value,1)},paysureShow:function(t){if(e.setStorage({key:"page",data:"/pages/site/index"}),0===t){if(void 0===this.user.wechat||this.user.wechat&&""===this.user.wechat.min_openid)return void this.$refs.wechatPopup.open();this.creatOrder(this.price,8,this.value,t)}},creatOrder:function(e,t,n,i){var o=this,r={_jv:{type:"orders"},type:t,amount:e,is_anonymous:this.isAnonymous};this.$store.dispatch("jv/post",r).then((function(e){o.orderSn=e.order_sn,0===i?0===o.browser?o.orderPay(13,n,o.orderSn,i,"0"):o.isWeixin&&o.isPhone?o.orderPay(12,n,o.orderSn,i,"1"):o.isPhone?o.orderPay(11,n,o.orderSn,i,"2"):o.orderPay(10,n,o.orderSn,i,"3"):1===i&&o.orderPay(20,n,o.orderSn,i)})).catch((function(e){console.log(e)}))},orderPay:function(t,n,i,o,r){var s=this,a={};0===o?a={_jv:{type:"trade/pay/order/".concat(i)},payment_type:t}:1===o&&(a={_jv:{type:"trade/pay/order/".concat(i)},payment_type:t,pay_password:n}),this.$store.dispatch("jv/post",a).then((function(t){if(s.wxRes=t,0===o)"0"===r?s.wechatPay(t.wechat_js.timeStamp,t.wechat_js.nonceStr,t.wechat_js.package,t.wechat_js.signType,t.wechat_js.paySign):"1"===r?"undefined"===typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",s.onBridgeReady(t),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",s.onBridgeReady(t)),document.attachEvent("onWeixinJSBridgeReady",s.onBridgeReady(t))):s.onBridgeReady(t):"2"===r?(payPhone=setInterval((function(){1!==s.payStatus?s.getOrderStatus(i,r):clearInterval(payPhone)}),3e3),window.location.href=t.wechat_h5_link):"3"===r&&t&&(s.codeUrl=t.wechat_qrcode,s.payShowStatus=!1,s.$refs.codePopup.open(),s.qrcodeShow=!0,f=setInterval((function(){1!==s.payStatus?(s.getOrderStatus(s.orderSn,r),e.hideLoading()):clearInterval(f)}),3e3));else if(1===o){"success"===t.wallet_pay.result&&(s.$store.dispatch("jv/get",["users/".concat(s.currentLoginId),{}]),e.showToast({icon:"none",title:s.i18n.t("site.renewalSuccessfully"),duration:2e3}),s.payShowStatus=!1,s.coverLoading=!1),s.coverLoading=!1}})).catch((function(e){0!==o&&s.$refs.payShow.clearPassword()}))},wechatPay:function(t,n,i,o,r){var s=this;e.requestPayment({provider:"wxpay",timeStamp:t,nonceStr:n,package:i,signType:o,paySign:r,success:function(e){s.coverLoading=!0,f=setInterval((function(){1!==s.payStatus?s.getOrderStatus(s.orderSn):clearInterval(f)}),3e3)},fail:function(e){s.payShowStatus=!1,s.coverLoading=!1,s.$refs.toast.show({message:s.p.payFail})}})},onBridgeReady:function(e){var t=this;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.wechat_js.appId,timeStamp:e.wechat_js.timeStamp,nonceStr:e.wechat_js.nonceStr,package:e.wechat_js.package,signType:"MD5",paySign:e.wechat_js.paySign},(function(e){"get_brand_wcpay_request:ok"==e.err_msg||("get_brand_wcpay_request:cancel"==e.err_msg||"get_brand_wcpay_request:fail"==e.err_msg)&&(clearInterval(f),resolve)})),f=setInterval((function(){1!==t.payStatus?t.getOrderStatus(t.orderSn):clearInterval(f)}),3e3)},getOrderStatus:function(t,n){var i=this;this.$store.dispatch("jv/get",["orders/".concat(t),{custom:{loading:!1}}]).then((function(t){i.payStatus=t.status,1===i.payStatus&&(i.payShowStatus=!1,i.coverLoading=!1,"3"===n&&(i.$refs.codePopup.close(),i.qrcodeShow=!1,e.showToast({icon:"none",title:"用户组购买成功",duration:2e3})),i.$refs.toast.show({message:i.p.paySuccess}))})).catch((function(e){i.coverLoading=!1,i.$refs.toast.show({message:i.p.payFail})}))}})};t.default=h}).call(this,n("543d")["default"])},"2e9d":function(e,t,n){"use strict";var i=n("5141"),o=n.n(i);o.a},5141:function(e,t,n){},"6ac3":function(e,t,n){"use strict";(function(e){n("8d7e");i(n("66fd"));var t=i(n("f622"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"6ea5":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i}));var i={quiPage:function(){return Promise.all([n.e("common/vendor"),n.e("components/qui-page/qui-page")]).then(n.bind(null,"a983"))},quiHeader:function(){return n.e("components/qui-header/qui-header").then(n.bind(null,"9dfa"))},uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"78fd"))},quiShare:function(){return n.e("components/qui-share/qui-share").then(n.bind(null,"8859"))},quiCellItem:function(){return n.e("components/qui-cell-item/qui-cell-item").then(n.bind(null,"60f4"))},quiAvatar:function(){return Promise.all([n.e("common/vendor"),n.e("components/qui-avatar/qui-avatar")]).then(n.bind(null,"7a5a"))},quiPay:function(){return Promise.all([n.e("common/vendor"),n.e("components/qui-pay/qui-pay")]).then(n.bind(null,"2751"))},quiIcon:function(){return n.e("components/qui-icon/qui-icon").then(n.bind(null,"d13f"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.i18n.t("home.theme")),i=e.$u.light(),o=e.i18n.t("manage.siteintroduction"),r=e.i18n.t("manage.creationtime"),s=e.i18n.t("manage.circlemode"),a=e.siteInfo.set_site&&"public"===e.siteInfo.set_site.site_mode?e.i18n.t("manage.publicmode"):null,u=e.siteInfo.set_site&&"public"===e.siteInfo.set_site.site_mode?null:e.i18n.t("manage.paymentmode"),c=e.i18n.t("manage.circlemaster"),d={username:e.siteInfo.username,avatarUrl:e.siteInfo.avatar},p=e.i18n.t("home.theme"),l=e.i18n.t("manage.myRole"),f=e.siteInfo.set_site&&"pay"===e.siteInfo.set_site.site_mode&&e.userInfo.joinedAt?e.i18n.t("manage.joinedTime"):null,h=e.siteInfo.set_site&&"pay"===e.siteInfo.set_site.site_mode?e.i18n.t("manage.periodvalidity"):null,m=e.siteInfo.set_site&&"pay"===e.siteInfo.set_site.site_mode&&"永久有效"!==e.userInfo.expiredTime&&""===e.day?e.i18n.t("manage.renewal"):null,g=e.siteInfo.set_site&&"pay"===e.siteInfo.set_site.site_mode&&"永久有效"!==e.userInfo.expiredTime&&""!==e.day?e.i18n.t("manage.renewalTime",{day:e.day}):null,y=e.i18n.t("manage.version"),_=e.i18n.t("site.myauthority"),v=e.__map(e.permissionInfo,(function(t,n){var i=e.__get_orig(t),o=e.handlePermission(t);return{$orig:i,m0:o}})),S=e.payShowStatus?e.forums.set_site&&parseFloat(e.forums.set_site.site_price):null,w=e.payShowStatus?Number(e.userInfo.walletBalance):null;e.$mp.data=Object.assign({},{$root:{g0:n,g1:i,g2:o,g3:r,g4:s,g5:a,g6:u,g7:c,a0:d,g8:p,g9:l,g10:f,g11:h,g12:m,g13:g,g14:y,g15:_,l0:v,m1:S,m2:w}})},r=[]},bc8d:function(e,t,n){"use strict";n.r(t);var i=n("0083"),o=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=o.a},f622:function(e,t,n){"use strict";n.r(t);var i=n("6ea5"),o=n("bc8d");for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);n("2e9d");var s,a=n("f0c5"),u=Object(a["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);t["default"]=u.exports}},[["6ac3","common/runtime","common/vendor"]]]);