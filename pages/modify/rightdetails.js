(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/modify/rightdetails"],{"11ca":function(e,t,n){"use strict";n.r(t);var i=n("4155"),a=n("603a");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("b5b4");var o,s=n("f0c5"),u=Object(s["a"])(a["default"],i["b"],i["c"],!1,null,"5ebeaf70",null,!1,i["a"],o);t["default"]=u.exports},"2a5c":function(e,t,n){},4155:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i}));var i={quiPage:function(){return Promise.all([n.e("common/vendor"),n.e("components/qui-page/qui-page")]).then(n.bind(null,"a983"))},quiCellItem:function(){return n.e("components/qui-cell-item/qui-cell-item").then(n.bind(null,"60f4"))},quiToast:function(){return n.e("components/qui-toast/qui-toast").then(n.bind(null,"b091"))},quiPay:function(){return Promise.all([n.e("common/vendor"),n.e("components/qui-pay/qui-pay")]).then(n.bind(null,"2751"))},quiLoadingCover:function(){return n.e("components/qui-loading-cover/qui-loading-cover").then(n.bind(null,"12a6"))},uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"78fd"))},quiIcon:function(){return n.e("components/qui-icon/qui-icon").then(n.bind(null,"d13f"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.i18n.t("modify.haveauthority")),i=e.__map(e.paidusergroup,(function(t,n){var i=e.__get_orig(t),a=e.i18n.t("permission."+t.permission.replace(/\./g,"_"));return{$orig:i,g1:a}})),a=e.i18n.t("modify.termofvalidity"),r=e.oder?e.i18n.t("modify.purchase"):null,o=e.oder?e.i18n.t("modify.daysafter"):null,s=e.oder?null:e.fun(e.expirationTime),u=e.oder?null:e.sun(e.expirationTime),c=e.oder&&e.forums.paycenter.wxpay_close&&e.paydiisplay?e.pricefun(e.paidusergrouplist.fee):null,p=e.oder&&e.forums.paycenter.wxpay_close&&e.paydiisplay?e.i18n.t("modify.termofvalidity"):null,d=e.oder&&e.forums.paycenter.wxpay_close&&e.paydiisplay?e.i18n.t("modify.days"):null,l=e.oder&&e.forums.paycenter.wxpay_close&&e.paydiisplay?e.i18n.t("modify.immediately"):null,f=e.payShowStatus?Number(e.user.walletBalance):null,h=e.payShowStatus?e.i18n.t("modify.purchaseuser"):null;e.$mp.data=Object.assign({},{$root:{g0:n,l0:i,g2:a,g3:r,g4:o,m0:s,m1:u,m2:c,g5:p,g6:d,g7:l,m3:f,g8:h}})},r=[]},"44f3":function(e,t,n){"use strict";(function(e){n("8d7e");i(n("66fd"));var t=i(n("11ca"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"603a":function(e,t,n){"use strict";n.r(t);var i=n("df7e"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},b5b4:function(e,t,n){"use strict";var i=n("2a5c"),a=n.n(i);a.a},df7e:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("dc1b")),a=o(n("7a36")),r=o(n("c939"));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){n.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(n("ba2b"))}.bind(null,n)).catch(n.oe)},u=null,c=null,p={components:{uniPopupDialog:s},mixins:[i.default,a.default,r.default],data:function(){return{typenum1:!0,typenum2:!1,payShowStatus:!1,coverLoading:!1,payTypeData:[{name:"微信支付",icon:"icon-wxPay",color:"#09bb07",value:"0"},{name:"钱包支付",icon:"icon-walletPay",color:"#1878f3",value:"1"}],payTypeVal:1,value:"",price:"",orderSn:"",browser:0,isWeixin:!1,isPhone:!1,codeUrl:"",qrcodeShow:!1,groupId:"",paidusergroup:[],oder:"",paidusergrouplist:"",pwdVal:"",expirationTime:"",payingusers:"",rightsice:"",wechatTip:this.i18n.t("discuzq.wechatBind"),paydiisplay:!1}},onLoad:function(t){var n=e.getSystemInfoSync();"ios"===n.platform&&this.forums.paycenter.wxpay_ios||"ios"!==n.platform||this.forums.paycenter.wxpay_ios?this.paydiisplay=!0:this.paydiisplay=!1,this.rightsice=t.sice,this.groupId=t.groups,this.payingusers=t.index,"1"===t.sice?this.oder=!0:(this.oder=!1,this.grouplist()),this.allusergroups()},computed:{p:function(){return this.i18n.t("pay")},currentLoginId:function(){var e=this.$store.getters["session/get"]("userId");return parseInt(e,10)},usersid:function(){return this.$store.getters["session/get"]("userId")}},methods:{fun:function(e){var t=e.replace(/T/," ").replace(/Z/,"");if(e)return"".concat(t.substring(0,10).replace(/-/,"年").replace(/-/,"月"),"日")},sun:function(e){var t=new Date,n=new Date(e),i=n-t;if(i>864e5){var a=Math.ceil(i/1e3/60/60/24);return"距离过期还有".concat(a,"天")}if(i<864e5&&i>36e5){var r=parseInt(i/1e3/60/60,0);return"距离过期还有".concat(r,"小时")}if(i<36e5){var o=parseInt(i/1e3/60,0);return"距离过期还有".concat(o,"分钟")}},pricefun:function(e){if(e){var t=e.toFixed(2);return"¥".concat(t,"元")}},allusergroups:function(){var e=this,t={include:"permission"};this.$store.dispatch("jv/get",["groups/".concat(this.groupId),{params:t}]).then((function(t){e.paidusergroup=t.permission,e.paidusergrouplist=t,e.price=t.fee}))},grouplist:function(){var e=this,t={sort:"created_at","filter[user]":this.usersid,"filter[delete_type]":0,include:"group"};this.$store.dispatch("jv/get",["groups/paid",{params:t}]).then((function(t){t.forEach((function(t){Number(e.groupId)===t.group_id&&(e.expirationTime=t.expiration_time)}))}))},purchase:function(){var e=this;this.payShowStatus=!0,this.payTypeVal=4,this.$nextTick((function(){e.$refs.payShow.payClickShow(e.payTypeVal)}))},radioMyHead:function(e){this.isAnonymous=!e},handleWechatClickOk:function(){this.mpLogin()},handleWechatClickCancel:function(){this.$refs.wechatPopup.close()},onInput:function(e){this.forums.paycenter.wxpay_close?this.value=e:this.value=1,this.creatOrder(this.price,4,this.value,1)},paysureShow:function(t){if(e.setStorage({key:"page",data:"/pages/modify/rightdetails?sice=".concat(this.rightsice,"&groups=").concat(this.groupId,"&index=").concat(this.payingusers)}),0===t){if(void 0===this.user.wechat||this.user.wechat&&""===this.user.wechat.min_openid)return void this.$refs.wechatPopup.open();this.creatOrder(this.price,4,this.value,t)}},allusergroupsusers:function(){var e=this,t={sort:"created_at","filter[user]":this.usersid,"filter[delete_type]":0,include:"group"};this.$store.dispatch("jv/get",["groups/paid",{params:t}]).then((function(){e.oder=!1,e.grouplist()}))},creatOrder:function(e,t,n,i){var a=this,r={_jv:{type:"orders"},type:t,group_id:this.groupId,amount:e,is_anonymous:this.isAnonymous};this.$store.dispatch("jv/post",r).then((function(e){a.orderSn=e.order_sn,0===i?0===a.browser?a.orderPay(13,n,a.orderSn,i,"0"):a.isWeixin&&a.isPhone?a.orderPay(12,n,a.orderSn,i,"1"):a.isPhone?a.orderPay(11,n,a.orderSn,i,"2"):a.orderPay(10,n,a.orderSn,i,"3"):1===i&&a.orderPay(20,n,a.orderSn,i)})).catch((function(e){console.log(e)}))},orderPay:function(t,n,i,a,r){var o=this,s={};0===a?s={_jv:{type:"trade/pay/order/".concat(i)},payment_type:t}:1===a&&(s={_jv:{type:"trade/pay/order/".concat(i)},payment_type:t,pay_password:n}),this.$store.dispatch("jv/post",s).then((function(t){if(o.wxRes=t,0===a)"0"===r?o.wechatPay(t.wechat_js.timeStamp,t.wechat_js.nonceStr,t.wechat_js.package,t.wechat_js.signType,t.wechat_js.paySign):"1"===r?"undefined"===typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",o.onBridgeReady(t),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",o.onBridgeReady(t)),document.attachEvent("onWeixinJSBridgeReady",o.onBridgeReady(t))):o.onBridgeReady(t):"2"===r?(c=setInterval((function(){1!==o.payStatus?o.getOrderStatus(i,r):clearInterval(c)}),3e3),window.location.href=t.wechat_h5_link):"3"===r&&t&&(o.codeUrl=t.wechat_qrcode,o.payShowStatus=!1,o.$refs.codePopup.open(),o.qrcodeShow=!0,u=setInterval((function(){1!==o.payStatus?(o.getOrderStatus(o.orderSn,r),e.hideLoading()):clearInterval(u)}),3e3));else if(1===a){var n=o;"success"===t.wallet_pay.result&&(o.$store.dispatch("jv/get",["users/".concat(o.currentLoginId),{}]),e.showToast({icon:"none",title:o.i18n.t("modify.purchasedSuccessfully"),duration:2e3}),setTimeout((function(){n.allusergroupsusers()}),1500),o.payShowStatus=!1,o.coverLoading=!1),o.coverLoading=!1}})).catch((function(e){o.$refs.payShow.clearPassword()}))},wechatPay:function(t,n,i,a,r){var o=this;e.requestPayment({provider:"wxpay",timeStamp:t,nonceStr:n,package:i,signType:a,paySign:r,success:function(e){o.coverLoading=!0,u=setInterval((function(){1!==o.payStatus?o.getOrderStatus(o.orderSn):clearInterval(u)}),3e3)},fail:function(e){o.payShowStatus=!1,o.coverLoading=!1,o.$refs.toast.show({message:o.p.payFail})}})},onBridgeReady:function(e){var t=this;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.wechat_js.appId,timeStamp:e.wechat_js.timeStamp,nonceStr:e.wechat_js.nonceStr,package:e.wechat_js.package,signType:"MD5",paySign:e.wechat_js.paySign},(function(e){"get_brand_wcpay_request:ok"==e.err_msg||("get_brand_wcpay_request:cancel"==e.err_msg||"get_brand_wcpay_request:fail"==e.err_msg)&&(clearInterval(u),resolve)})),u=setInterval((function(){1!==t.payStatus?t.getOrderStatus(t.orderSn):clearInterval(u)}),3e3)},getOrderStatus:function(t,n){var i=this;this.$store.dispatch("jv/get",["orders/".concat(t),{custom:{loading:!1}}]).then((function(t){if(i.payStatus=t.status,1===i.payStatus){if(i.payShowStatus=!1,i.coverLoading=!1,"4"===n||"3"===n&&(i.$refs.codePopup.close(),i.qrcodeShow=!1,e.showToast({icon:"none",title:"用户组购买成功",duration:2e3}),setTimeout((function(){_this.allusergroupsusers()}),1500)),4===i.payTypeVal){var a=i;a.allusergroupsusers()}i.$refs.toast.show({message:i.p.paySuccess})}})).catch((function(e){i.coverLoading=!1,i.$refs.toast.show({message:i.p.payFail})}))}}};t.default=p}).call(this,n("543d")["default"])}},[["44f3","common/runtime","common/vendor"]]]);